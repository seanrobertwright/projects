<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-us" dir="ltr"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Step 7: Adding a Comments Section</title><link rel="icon" href="themes/sap-default/img/favicon.ico" type="image/x-icon"><link rel="shortcut icon" href="themes/sap-default/img/favicon.ico"><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="abstract" content="In this step, we extend the product detail view by adding a feature allowing to add comments to the product."><meta name="description" content="In this step, we extend the product detail view by adding a feature allowing to add comments to the product."><meta name="content category" content="development"><script type="text/javascript">var d4p = {"relativePath":'',"dev":false,"debug":false,"draft":false,"nextTopicHref":"c4de2df385174e58a689d9847c7553bd.html","previousTopicHref":"b561d146f9114b029bd60fa26df09c6b.html"}</script><link rel="stylesheet" type="text/css" media="screen, projection" href="themes/sap-default/css/style.css"><script type="text/javascript">
      
        d4p.cssGridPath = d4p.dev ? 'html5-themes/modules/960-Responsive-Grid/css/' : 'themes/dita-d4p-classic/css/';
        var ADAPT_CONFIG = {
          // Where is your CSS?
          path: d4p.relativePath + d4p.cssGridPath,

          // false = Only run once, when page first loads.
          // true = Change on window resize and page tilt.
          dynamic: true,

          // Optional callback... myCallback(i, width)
          callback: doc_resize,

          // First range entry is the minimum.
          // Last range entry is the maximum.
          // Separate ranges by "to" keyword.
          range: [
             // small (size-0)
            '0px    to 760px  =',
             // medium (size-1, size-2)
            '760px  to 980px  = ',
            '980px  to 1270px = ',
             // large (size-3, size-5)
            '1270px to 1600px = ',
            '1600px to 1940px = ',
             // extra large (size-6)
            '1940px to 2540px = ',
            '2540px           = '
          ]
        };

        function doc_resize(i, width)
        {
          d4p.setBodyClassfunction(i, width);
        }


        
      </script><script type="text/javascript" src="toc-info.js"></script><script type="text/javascript" src="themes/sap-default/js/script.js"></script>
		<!--[if lt IE 9]>
			<script>
			  var e = ("abbr,article,aside,audio,canvas,datalist,details," +
			    "figure,footer,header,hgroup,mark,menu,meter,nav,output," +
			    "progress,section,time,video").split(',');
			  for (var i = 0; i < e.length; i++) {
			    document.createElement(e[i]);
			  }
			</script>
		<![endif]-->
        
    <script>
      function addLoadEvent(func) {
        var oldonload = window.onload;
        if (typeof window.onload != 'function') {
          window.onload = func;
        } else {
          window.onload = function() {
            if (oldonload) {
              oldonload();
        }
        func();
       }
     }
     }
      
    addLoadEvent(function() { prettyPrint();
if ($('#local-navigation').length) {
        $('#local-navigation').navigation();
    }


});
      
    </script>
     <script type="text/javascript" src="js/prettify.js"> </script><script id="search-processing" type="text/javascript" src="js/search-processing.js"> </script><script>function handleAreaClick(oArea) {window.parent.location.href = oArea.href;}</script><link type="text/css" rel="stylesheet" href="css/overrides.css"></head><body class="en-us sap-default centered navigation-default toc-injection enumeration-disabled" style="font-family: &apos;72&apos;, Arial, Helvetica, sans-serif;"><div id="d4h5-main-container" class="container_12" role="application"><ul id="page-links" class="hidden"><li><a id="skip-to-content" href="#d4h5-main-content">Skip to content</a></li><li><a id="skip-to-localnav" href="#local-navigation">Skip to navigation</a></li><li><a id="skip-to-footer" href="#footer-container">Skip to footer</a></li></ul><div id="d4h5-section-container" class="grid_12" style="padding-top: 0;"><div id="d4h5-main-content" class="grid_8 alpha omega" style="margin: 0 0.5em;"><section><div id="content-toolbar" class="toolbar hide-for-small"><div class="familylinks"><div class="parentlink"><br><strong>Parent topic: </strong><a class="link" href="../../#/topic/6a6a621c978145ad9eef2b221d2cf21d.html" title="In this tutorial we will build an app using OpenUI5 that, for example, a shop owner can use to manage his product stock levels." target="_top">Worklist App</a><br></div><div class="previouslink"><br><strong>Previous: </strong><a class="link" href="../../#/topic/b561d146f9114b029bd60fa26df09c6b.html" title="In this step, we will extend the detail page of our app to show more information of a given product with various UI controls. We will enrich the header area and display further attributes in an info panel for information about the supplier." target="_top">Step 6: Extending the Detail Page</a><br></div></div></div><div class="page concept  - topic-topic concept-concept " id="loioc73dfe312f104664954749c5c36faf27"><h1 class="title topictitle1" hidden>Step 7: Adding a Comments Section</h1><div class="body conbody"><p class="shortdesc" hidden>In this step, we extend the product detail view by adding a feature allowing to add
comments to the product.</p>
<div class="section"><section class="section" type="Preview"><h2 class="section_title" style="font-size: 1.15em;">Preview</h2>

<div class="fig fignone" id="loioc73dfe312f104664954749c5c36faf27__fig_apx_45y_c5"><div class="figbody">

<img class="inline" id="loioc73dfe312f104664954749c5c36faf27__image_f2w_sz1_tdb" src="loioa517fe596aa04b4d8d080fbf6168cf40_LowRes.jpg">
</div><span class="figcap">Comments section added to the detail page</span></div>
</section></div>
<div class="section"><section class="section" type="Coding"><h2 class="section_title" style="font-size: 1.15em;">Coding</h2>

<p class="p">You can view and download all files in the <span class="ph uicontrol">Samples</span> in the
Demo Kit <span class="ph">at
<a class="xref" href="../../#/sample/sap.m.tutorial.worklist.07/preview" target="_top" alt="#/sample/sap.m.tutorial.worklist.07/preview" title="#/sample/sap.m.tutorial.worklist.07/preview">Worklist App - Step 7</a></span>
.</p>
<div class="sectiondiv subsection">
<p class="p subsectiontitle">webapp/view/Object.view.xml</p>
<pre class="pre codeblock prettyprint lang-xml">
&lt;mvc:View
    controllerName=&quot;mycompany.myapp.MyWorklistApp.controller.Object&quot;
    xmlns=&quot;sap.m&quot;
    xmlns:mvc=&quot;sap.ui.core.mvc&quot;
    xmlns:semantic=&quot;sap.f.semantic&quot;
    xmlns:form=&quot;sap.ui.layout.form&quot;
    <span class="ph emphasis emphasis">xmlns:l=&quot;sap.ui.layout&quot;&gt;</span>

...

        &lt;semantic:content&gt;
            <span class="ph emphasis emphasis">&lt;l:VerticalLayout width=&quot;100%&quot;&gt;</span>
            &lt;Panel
                <span class="ph emphasis emphasis">backgroundDesign=&quot;Transparent&quot;</span>
                headerText=&quot;{i18n&gt;ObjectSupplierTabTitle}&quot;&gt;

...
            &lt;/Panel&gt;
                <span class="ph emphasis emphasis">&lt;Panel
                    backgroundDesign=&quot;Transparent&quot;
                    headerText=&quot;{i18n&gt;ObjectCommentsTabTitle}&quot;&gt;
                    &lt;content&gt;
                        &lt;FeedInput post=&quot;.onPost&quot;/&gt;
                        &lt;List
                            id=&quot;idCommentsList&quot;
                            noDataText=&quot;{i18n&gt;ObjectCommentNoData}&quot;
                            showSeparators=&quot;Inner&quot;
                            items=&quot;{
                                path: &apos;productFeedback&gt;/productComments&apos;,
                                sorter: {
                                    path: &apos;date&apos;,
                                    descending: true
                                }
                            }&quot;&gt;
                            &lt;FeedListItem
                                info=&quot;{productFeedback&gt;type}&quot;
                                text=&quot;{productFeedback&gt;comment}&quot;
                                timestamp=&quot;{productFeedback&gt;date}&quot;/&gt;
                        &lt;/List&gt;
                    &lt;/content&gt;
                &lt;/Panel&gt;
            &lt;/l:VerticalLayout&gt;</span>
        &lt;/semantic:content&gt;</pre>
<p class="p">Below the already existing panel, we add another panel that will serve as a container for our comments section. We put both panels inside a
vertical layout, because <samp class="ph codeph">sap.f.semanticPage</samp> allows only one control for content aggregation. Within the new
panel, we add a <samp class="ph codeph">sap.m.FeedInput</samp> control and attach an event handler <samp class="ph codeph">onPost</samp> for the
<samp class="ph codeph">post</samp> event. This control will render an input field and a button, which allow users to post comments. The
event handler we registered will be implemented below.</p>
<p class="p">Below the <samp class="ph codeph">FeedInput</samp> control, we add a list with all existing
comments. The <samp class="ph codeph">items</samp> aggregation of the list is bound to the
<samp class="ph codeph">/productComments</samp> property of the named model
<samp class="ph codeph">productFeedback</samp> that we will create below. All comments shall
be displayed in descending order based on their publishing date. Therefore, we also
configure a sorter for our items in the list.</p>
<p class="p">The template for each row is a <samp class="ph codeph">FeedListItem</samp> control. We configure
the <samp class="ph codeph">FeedListItem</samp> to simply display the date of the post, the text
of the post itself, and the type of the post.</p>
</div>
<div class="sectiondiv subsection">
<p class="p subsectiontitle">webapp/controller/Object.controller.js</p>
<pre class="pre codeblock prettyprint lang-js">...
/*global location*/
sap.ui.define([
   &quot;myCompany/myApp/controller/BaseController&quot;,
   &quot;sap/ui/model/json/JSONModel&quot;,
   &quot;sap/ui/core/routing/History&quot;,
   &quot;myCompany/myApp/model/formatter&quot;<span class="ph emphasis emphasis">,
   &quot;sap/ui/core/format/DateFormat&quot;,
   &quot;sap/ui/model/Filter&quot;,
   &quot;sap/ui/model/FilterOperator&quot;
</span>
], function(BaseController, JSONModel, History, formatter<span class="ph emphasis emphasis">, DateFormat, Filter, FilterOperator</span>) {
   &quot;use strict&quot;;
   return BaseController.extend(&quot;myCompany.myApp.controller.Object&quot;, {
      formatter: formatter,
      ...
      _onBindingChange: function(oEvent) {
         ...
 <span class="ph emphasis emphasis">        // Update the comments in the list
         var oList = this.byId(&quot;idCommentsList&quot;);
         var oBinding = oList.getBinding(&quot;items&quot;);
         oBinding.filter(new Filter(&quot;productID&quot;, FilterOperator.EQ, sObjectId));
      },
      /**
      * Updates the model with the user comments on Products.
      * @function
      * @param {sap.ui.base.Event} oEvent object of the user input
      */
      onPost: function (oEvent) {
         var oFormat = DateFormat.getDateTimeInstance({style: &quot;medium&quot;});
         var sDate = oFormat.format(new Date());
         var oObject = this.getView().getBindingContext().getObject();
         var sValue = oEvent.getParameter(&quot;value&quot;);
         var oEntry = {
             productID: oObject.ProductID,
             type: &quot;Comment&quot;,
             date: sDate,
             comment: sValue
         };        
         // update model
         var oFeedbackModel = this.getModel(&quot;productFeedback&quot;);
         var aEntries = oFeedbackModel.getData().productComments;
         aEntries.push(oEntry);
         oFeedbackModel.setData({
            productComments : aEntries
         });
      }</span>
   });
});</pre>
<p class="p"> First, we add three new dependencies to the controller. We need these dependencies
because we want to create a filter for the list and because we format the date and
time of each post.</p>
<p class="p">Whenever the binding of the detail view changes, we want to make sure that the comments for the current product are displayed. Therefore, we
change the private function <samp class="ph codeph">_onBindingChange</samp> and update the filter of the list that displays the comments by
getting a reference to the binding of the <samp class="ph codeph">items</samp> aggregation of our list and calling the <samp class="ph codeph">filter()</samp>
API afterwards. The filter is passed on to the <samp class="ph codeph">filter()</samp> API. We use the <samp class="ph codeph">productID</samp> as filter
criterion, because we only want comments for a specific product.</p>
<p class="p">Next, the event handler for the <samp class="ph codeph">post</samp> event of the
<samp class="ph codeph">FeedInput</samp> is implemented. In the <samp class="ph codeph">onPost</samp>
handler, we create a new <samp class="ph codeph">entry</samp> object that contains all data we
want to store in our model. This data is the <samp class="ph codeph">productId</samp>, the
<samp class="ph codeph">type</samp> of the post (hard-coded in our example), the current
<samp class="ph codeph">date</samp> in a medium date format, and the <samp class="ph codeph">comment</samp>
itself. The comment is retrieved from the event object. The
<samp class="ph codeph">productId</samp> is determined by calling <samp class="ph codeph">getObject()</samp>
on the view&#x2019;s binding context.</p>
<p class="p">Finally, the new entry is added to the named model called
<samp class="ph codeph">productFeedback</samp>. This model does not exist yet, so let&#x2019;s create
it next. </p>
</div>
<div class="sectiondiv subsection">
<p class="p subsectiontitle">webapp/model/models.js</p>
<pre class="pre codeblock prettyprint lang-js">sap.ui.define([
   &quot;sap/ui/model/json/JSONModel&quot;,
   &quot;sap/ui/Device&quot;
], function(JSONModel, Device) {
   &quot;use strict&quot;;
   return {
      createDeviceModel: function() {
         var oModel = new JSONModel(Device);
         oModel.setDefaultBindingMode(&quot;OneWay&quot;);
         return oModel;
      }<span class="ph emphasis emphasis">,   
      createCommentsModel: function() {
         return new JSONModel({ productComments : [] });
      }</span>
   };
});</pre>
<p class="p">In both the object view (detail page) as well as in the corresponding controller we
used a named model called <samp class="ph codeph">productFeedback</samp>. In our example this
model is a simple <samp class="ph codeph">JSONModel</samp>. It is created in the function
<samp class="ph codeph">createCommentsModel()</samp> in the<span class="ph filepath"> model.js</span>
file. As you can see above, the function simply returns a new instance of a
<samp class="ph codeph">JSONModel</samp> with a simple data object. The property
<samp class="ph codeph">productComments</samp> is an empty array and it will be updated every
time someone posts a new comment.</p>
<p class="p">However, this model is not yet accessible throughout our app. Let&#x2019;s fix this next. </p>
</div>
<div class="sectiondiv subsection">
<p class="p subsectiontitle">webapp/Component.js</p>
<pre class="pre codeblock prettyprint lang-js">sap.ui.define([
   &quot;sap/ui/core/UIComponent&quot;,
   &quot;sap/ui/Device&quot;,
   &quot;./model/models&quot;,
   &quot;./controller/ErrorHandler&quot;
], function(UIComponent, Device, models, ErrorHandler) {
   &quot;use strict&quot;;
   return UIComponent.extend(&quot;myCompany.myApp.Component&quot;, {
      ...
      init: function() {
         // call the base component&apos;s init function
         UIComponent.prototype.init.apply(this, arguments);

         // initialize the error handler with the component
         this._oErrorHandler = new ErrorHandler(this);

         // set the device model
         this.setModel(models.createDeviceModel(), &quot;device&quot;);
         
         <span class="ph emphasis emphasis">// set the product feedback model
         this.setModel(models.createCommentsModel(), &quot;productFeedback&quot;);
</span>

         // create the views based on the url/hash
         this.getRouter().initialize();
      },
      ...
   });
});</pre>
<p class="p">Now it&#x2019;s time to make the named model <samp class="ph codeph">productFeedback</samp> available to
our app. Therefore, just change the <samp class="ph codeph">init</samp> function of our
<span class="ph filepath">Component.js</span> file by calling our
<samp class="ph codeph">createCommentsModel()</samp> method and setting the returned model on
the component. After this, our model is accessible in our app.</p>
</div>
<div class="sectiondiv subsection">
<p class="p subsectiontitle">webapp/i18n/i18n.properties</p>
<pre class="pre codeblock prettyprint lang-prefs">...
<span class="ph emphasis emphasis">#Comments tab title
ObjectCommentsTabTitle=Comments

#No comments text
ObjectCommentNoData=No Comments
</span>

#~~~ Footer Options ~~~~~~~~~~~~~~~~~~~~~~~
...</pre>
<p class="p">Now add the new texts to our <span class="ph filepath">i18n.properties</span> file and you&#x2019;re
done.</p>
<p class="p">You can test the new features by navigating to the details page of any given product.
After that, just create a new comment for that product and post it.</p>
</div>
</section></div>
<div class="section" id="loioc73dfe312f104664954749c5c36faf27__section_jvq_kgt_qbb"><section class="section" type="Summary"><h2 class="section_title" style="font-size: 1.15em;">Summary</h2>

<p class="p">You have learned how to use <span class="ph pname">SAP Web IDE</span> to create a simple
worklist app from a template and you know where to find the code in the
<span class="ph uicontrol">Samples</span>. Based on the initial app you have seen how easy
it can be to generate or download initial code and to extend it according to your
own requirements. This tutorial also illustrated how to communicate easily with an
OData back end using the OData V2 model. Furthermore, it illustrated how to use the
mock server with both generated mock data and more realistic data.</p>
</section></div>
</div><div class="related-links"> <div class="familylinks"><div class="parentlink"><br><strong>Parent topic: </strong><a class="link" href="../../#/topic/6a6a621c978145ad9eef2b221d2cf21d.html" title="In this tutorial we will build an app using OpenUI5 that, for example, a shop owner can use to manage his product stock levels." target="_top">Worklist App</a><br></div><div class="previouslink"><br><strong>Previous: </strong><a class="link" href="../../#/topic/b561d146f9114b029bd60fa26df09c6b.html" title="In this step, we will extend the detail page of our app to show more information of a given product with various UI controls. We will enrich the header area and display further attributes in an info panel for information about the supplier." target="_top">Step 6: Extending the Detail Page</a><br></div></div></div></div></section><div class="clear"></div>
</div><div class="clearfix"></div></div></div><div class="clearfix"></div><div id="footer-container" class="grid_12"><footer>
	<div id="custom-footerSpacer"></div>
	
</footer>
</div></body></html>