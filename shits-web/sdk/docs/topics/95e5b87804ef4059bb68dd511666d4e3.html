<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-us" dir="ltr"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Step 4: Calling a Function Import</title><link rel="icon" href="themes/sap-default/img/favicon.ico" type="image/x-icon"><link rel="shortcut icon" href="themes/sap-default/img/favicon.ico"><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="abstract" content="We only want to display the upcoming meetings and hide the meetings happened in the past in our app. By using a function import that calculates these items on the back end we do not need to do the calculation on the client. The mock server will be instructed to do the calculation locally for testing purposes."><meta name="description" content="We only want to display the upcoming meetings and hide the meetings happened in the past in our app. By using a function import that calculates these items on the back end we do not need to do the calculation on the client. The mock server will be instructed to do the calculation locally for testing purposes."><meta name="content category" content="development"><script type="text/javascript">var d4p = {"relativePath":'',"dev":false,"debug":false,"draft":false,"nextTopicHref":"6a6a621c978145ad9eef2b221d2cf21d.html","previousTopicHref":"46c1ca4eb2804af6bfa371ad51c9b887.html"}</script><link rel="stylesheet" type="text/css" media="screen, projection" href="themes/sap-default/css/style.css"><script type="text/javascript">
      
        d4p.cssGridPath = d4p.dev ? 'html5-themes/modules/960-Responsive-Grid/css/' : 'themes/dita-d4p-classic/css/';
        var ADAPT_CONFIG = {
          // Where is your CSS?
          path: d4p.relativePath + d4p.cssGridPath,

          // false = Only run once, when page first loads.
          // true = Change on window resize and page tilt.
          dynamic: true,

          // Optional callback... myCallback(i, width)
          callback: doc_resize,

          // First range entry is the minimum.
          // Last range entry is the maximum.
          // Separate ranges by "to" keyword.
          range: [
             // small (size-0)
            '0px    to 760px  =',
             // medium (size-1, size-2)
            '760px  to 980px  = ',
            '980px  to 1270px = ',
             // large (size-3, size-5)
            '1270px to 1600px = ',
            '1600px to 1940px = ',
             // extra large (size-6)
            '1940px to 2540px = ',
            '2540px           = '
          ]
        };

        function doc_resize(i, width)
        {
          d4p.setBodyClassfunction(i, width);
        }


        
      </script><script type="text/javascript" src="toc-info.js"></script><script type="text/javascript" src="themes/sap-default/js/script.js"></script>
		<!--[if lt IE 9]>
			<script>
			  var e = ("abbr,article,aside,audio,canvas,datalist,details," +
			    "figure,footer,header,hgroup,mark,menu,meter,nav,output," +
			    "progress,section,time,video").split(',');
			  for (var i = 0; i < e.length; i++) {
			    document.createElement(e[i]);
			  }
			</script>
		<![endif]-->
        
    <script>
      function addLoadEvent(func) {
        var oldonload = window.onload;
        if (typeof window.onload != 'function') {
          window.onload = func;
        } else {
          window.onload = function() {
            if (oldonload) {
              oldonload();
        }
        func();
       }
     }
     }
      
    addLoadEvent(function() { prettyPrint();
if ($('#local-navigation').length) {
        $('#local-navigation').navigation();
    }


});
      
    </script>
     <script type="text/javascript" src="js/prettify.js"> </script><script id="search-processing" type="text/javascript" src="js/search-processing.js"> </script><script>function handleAreaClick(oArea) {window.parent.location.href = oArea.href;}</script><link type="text/css" rel="stylesheet" href="css/overrides.css"></head><body class="en-us sap-default centered navigation-default toc-injection enumeration-disabled" style="font-family: &apos;72&apos;, Arial, Helvetica, sans-serif;"><div id="d4h5-main-container" class="container_12" role="application"><ul id="page-links" class="hidden"><li><a id="skip-to-content" href="#d4h5-main-content">Skip to content</a></li><li><a id="skip-to-localnav" href="#local-navigation">Skip to navigation</a></li><li><a id="skip-to-footer" href="#footer-container">Skip to footer</a></li></ul><div id="d4h5-section-container" class="grid_12" style="padding-top: 0;"><div id="d4h5-main-content" class="grid_8 alpha omega" style="margin: 0 0.5em;"><section><div id="content-toolbar" class="toolbar hide-for-small"><div class="familylinks"><div class="parentlink"><br><strong>Parent topic: </strong><a class="link" href="../../#/topic/3a9728ec31f94ca18a7d543ce419d85d.html" title="In this tutorial, we will explore some advanced features of the mock server." target="_top">Mock Server</a><br></div><div class="previouslink"><br><strong>Previous: </strong><a class="link" href="../../#/topic/46c1ca4eb2804af6bfa371ad51c9b887.html" title="In this step, we add the functionality to interpret URL parameters in our local mock server configuration." target="_top">Step 3: Handling Custom URL Parameters</a><br></div></div></div><div class="page concept  - topic-topic concept-concept " id="loio95e5b87804ef4059bb68dd511666d4e3"><h1 class="title topictitle1" hidden>Step 4: Calling a Function Import</h1><div class="body conbody"><p class="shortdesc" hidden>We only want to display the upcoming meetings and hide the meetings happened in the past
in our app. By using a function import that calculates these items on the back end we do not
need to do the calculation on the client. The mock server will be instructed to do the
calculation locally for testing purposes.</p>
<div class="section"><section class="section" type="Preview"><h2 class="section_title" style="font-size: 1.15em;">Preview</h2>

<div class="fig fignone" id="loio95e5b87804ef4059bb68dd511666d4e3__fig_zrh_5mq_st"><div class="figbody">

<img class="inline" id="loio95e5b87804ef4059bb68dd511666d4e3__image_evz_xmq_st" src="loio8f2176b473a54bbd87e8287732e4eb8e_HiRes.png">
</div><span class="figcap">Only the upcoming meet-ups are shown</span></div>
</section></div>
<div class="section"><section class="section" type="Coding"><h2 class="section_title" style="font-size: 1.15em;">Coding</h2>

<p class="p">You can view and download all files in the Demo Kit <span class="ph">at <a class="xref" href="../../#/sample/sap.ui.core.tutorial.mockserver.04/preview" target="_top" alt="#/sample/sap.ui.core.tutorial.mockserver.04/preview" title="#/sample/sap.ui.core.tutorial.mockserver.04/preview">Mock Server - Step 4</a></span>.</p>
</section></div>
<div class="section"><section class="section" type="webapp/localService/metadata.xml"><h2 class="section_title" style="font-size: 1.15em;">webapp/localService/metadata.xml </h2>

<pre class="pre codeblock prettyprint lang-xml">... 
      &lt;EntityContainer Name=&quot;NerdMeetups&quot; m:IsDefaultEntityContainer=&quot;true&quot;&gt;
        &lt;EntitySet Name=&quot;Meetups&quot; EntityType=&quot;NerdMeetup.Models.Meetup&quot; /&gt;
        &lt;FunctionImport Name=&quot;FindUpcomingMeetups&quot; EntitySet=&quot;Meetups&quot; ReturnType=&quot;Collection(NerdMeetup.Models.Meetup)&quot; m:HttpMethod=&quot;GET&quot; /&gt;
      &lt;/EntityContainer&gt;
    &lt;/Schema&gt;
  &lt;/edmx:DataServices&gt;
&lt;/edmx:Edmx&gt;</pre>
<p class="p">The function import we are going to use is declared in the <span class="ph filepath">metadata.xml</span> file.</p>
</section></div>
<div class="section"><section class="section" type="webapp/view/App.view.xml"><h2 class="section_title" style="font-size: 1.15em;">webapp/view/App.view.xml</h2>

<pre class="pre codeblock prettyprint lang-xml">...
  <span class="ph emphasis emphasis">//Delete items=&quot;{/Meetups}&quot;</span>
	&lt;List id=&quot;list&quot; items=&quot;{/<span class="ph emphasis emphasis">FindUpcomingMeetups</span>}&quot; noDataText=&quot;{i18n&gt;noDataText}&quot;&gt; 
...</pre>
<p class="p">We change the binding of the list to a function import call that returns only upcoming meet-ups, instead of the call to the entire
meet-ups collection.</p>
<p class="p">After saving and running the app again, we should get the following result:</p>
<div class="fig fignone" id="loio95e5b87804ef4059bb68dd511666d4e3__fig_mm2_tnq_st"><div class="figbody">

<img class="inline" id="loio95e5b87804ef4059bb68dd511666d4e3__image_zh2_5nq_st" src="loio4992f37e491c432995eaae0712ba1a59_HiRes.png">
</div><span class="figcap">No data visible</span></div>
<div class="p">Since the function import call is not simulated automatically by the mock server, we do not see any data in list, and a failed network
call is issued in the developer tools of the browser.<aside class="note tip" aria-labelledby="note_0_title"><div class="title" id="note_0_title"><strong>Tip</strong></div>
<p class="p">In Google Chrome, mocked requests will appear in a debug level log of the console (both request and response) and not on the
<span class="ph uicontrol">Network</span> tab. If you do see them in the <span class="ph uicontrol">Network</span> tab, they are not mocked and
you need to check your code.</p></aside></div>
<p class="p">In order to simulate the function import call, we write our own (mocked) implementation, and add to the internal list of requests.</p>
</section></div>
<div class="section"><section class="section" type="webapp/localService/mockserver.js"><h2 class="section_title" style="font-size: 1.15em;">webapp/localService/mockserver.js </h2>

<pre class="pre codeblock prettyprint lang-js">sap.ui.define([
<span class="ph emphasis emphasis">	&quot;sap/ui/thirdparty/jquery&quot;,
</span>
	&quot;sap/ui/core/util/MockServer&quot;,
	&quot;sap/base/Log&quot;
], function(<span class="ph emphasis emphasis">jQuery, </span>MockServer, Log) {
	&quot;use strict&quot;;
	return {
		/**
		 * Initializes the mock server.
		 * You can configure the delay with the URL parameter &quot;serverDelay&quot;.
		 * The local mock data in this folder is returned instead of the real data for testing.
		 * @public
		 */
		init: function() {
			// create
			var oMockServer = new MockServer({
				rootUri: &quot;/&quot;
			});
			oMockServer.simulate(&quot;../localService/metadata.xml&quot;, {
				sMockdataBaseUrl: &quot;../localService/mockdata&quot;,
				bGenerateMissingMockData: true
			});

<span class="ph emphasis emphasis">			// handling mocking a function import call step
			var aRequests = oMockServer.getRequests();
			aRequests.push({
				method: &quot;GET&quot;,
				path: new RegExp(&quot;FindUpcomingMeetups(.*)&quot;),
				response: function(oXhr) {
					Log.debug(&quot;Incoming request for FindUpcomingMeetups&quot;);
					var today = new Date();
					today.setHours(0); // or today.toUTCString(0) due to timezone differences
					today.setMinutes(0);
					today.setSeconds(0);
					jQuery.ajax({
						url: &quot;/Meetups?$filter=EventDate ge &quot; + &quot;/Date(&quot; + today.getTime() + &quot;)/&quot;,
						dataType : &apos;json&apos;,
						async: false,
						success : function(oData) {
							oXhr.respondJSON(200, {}, JSON.stringify(oData));
						}
					});
					return true;
				}
			});
			oMockServer.setRequests(aRequests);</span>
			// handling custom URL parameter step
			var fnCustom = function(oEvent) {
				var oXhr = oEvent.getParameter(&quot;oXhr&quot;);
				if (oXhr &amp;&amp; oXhr.url.indexOf(&quot;first&quot;) &gt; -1) {
					oEvent.getParameter(&quot;oFilteredData&quot;).results.splice(3, 100);
				}
			};
			oMockServer.attachAfter(&quot;GET&quot;, fnCustom, &quot;Meetups&quot;);
			// start
			oMockServer.start();
			Log.info(&quot;Running the app with mock data&quot;);
		}
	};
});</pre>
<div class="p">We push a new request handler to mock the function import call as follows:<ol class="ol" id="loio95e5b87804ef4059bb68dd511666d4e3__ol_nrr_rqq_st">
<li class="li">
<p class="p">Fetch the array of requests from the <samp class="ph codeph">MockServer</samp>. The
mock server holds an internal list of requests that you have to get and
set if you want to modify. </p>
</li>
<li class="li">
<p class="p">Push a new request handler to handle the function import </p>
</li>
<li class="li">
<p class="p">Set the updated request array </p>
</li>
</ol></div>
<div class="p">The request handler has the following structure:<ul class="ul" id="loio95e5b87804ef4059bb68dd511666d4e3__ul_bzw_5qq_st">
<li class="li">
<p class="p"><samp class="ph codeph">method</samp>: The HTTP method of the mock request</p>
</li>
<li class="li">
<p class="p"><samp class="ph codeph">path</samp>: The relative path (appended to the
<samp class="ph codeph">rootUri</samp>) of the request.</p>
<p class="p">We can define the path as a regular expression, for example, to handle
URL parameters.</p>
</li>
<li class="li"><samp class="ph codeph">response</samp>: A response function that simulates the answer
from the server </li>
</ul>The <samp class="ph codeph">response</samp> function executes a request to the
<samp class="ph codeph">Meetups</samp> entity set with an OData <samp class="ph codeph">$filter</samp> query
that actually returns all meet-ups with <samp class="ph codeph">EventDate</samp> that is greater
than or equals today. We compose a date for the filter and send it to the
<samp class="ph codeph">server</samp> manually as a synchronous request.</div>
<p class="p">It is o.k. to use <samp class="ph codeph">jQuery.sap.sjax</samp> here, because the call will not
actually leave the client. It triggers a new request that again is intercepted and
processed by the mock server.</p>
<p class="p">We finally respond on the XHR object by calling the <samp class="ph codeph">respondJSON</samp> API.
It will add the proper content type header for the JSON format and send the result.
We provide the HTTP status code <samp class="ph codeph">200</samp> (success) and the &apos;stringified&apos;
response data as the arguments. Returning <samp class="ph codeph">true</samp> at the end of the
function indicates that we have completed the processing of the request in this
handler (no additional request handlers should be checked for that request).</p>
<p class="p">When you now start the app again you will see a list of upcoming meet-ups.</p>
</section></div>
<div class="section"><section class="section" type="Creating and Editing Mock Data in SAP Web IDE (Optional)"><h2 class="section_title" style="font-size: 1.15em;">Creating and Editing Mock Data in <span class="ph pname">SAP Web IDE</span> (Optional)</h2><div class="sectiondiv subsection">
<p class="p subsectiontitle">webapp/localService/mockserver.js </p>
<pre class="pre codeblock prettyprint lang-js">...
oMockServer.simulate(&quot;localService/metadata.xml&quot;, {
	sMockdataBaseUrl : &quot;<span class="ph emphasis emphasis">localService/mockdata</span>&quot;,
	bGenerateMissingMockData : true
});
...</pre>
<div class="p">The path we gave in the simulate function for mock data is where we want to store the .json file(s). <ul class="ul" id="loio95e5b87804ef4059bb68dd511666d4e3__ul_cbs_cqq_st">
<li class="li">
<p class="p">Save it (in JSON format) from a real service</p>
</li>
<li class="li">
<p class="p">Create it manually</p>
</li>
<li class="li">
<p class="p">Generate it in <span class="ph pname">SAP Web IDE</span> by choosing <span class="ph uicontrol">Edit Mock Data</span> in the context menu of the
<span class="ph filepath">medatdata.xml</span> file. <span class="ph">For more information about <span class="ph pname">SAP Web IDE</span>,
see the documentation for <span class="ph pname">SAP Web IDE</span> on
the SAP Help Portal at <a class="xref" href="https://help.sap.com/viewer/p/SAP_Web_IDE" target="_blank" alt="https://help.sap.com/viewer/p/SAP_Web_IDE" title="https://help.sap.com/viewer/p/SAP_Web_IDE">https://help.sap.com/viewer/p/SAP_Web_IDE</a>.</span></p>
<div class="fig fignone" id="loio95e5b87804ef4059bb68dd511666d4e3__fig_l2f_bqd_tt"><div class="figbody">

<img class="inline" id="loio95e5b87804ef4059bb68dd511666d4e3__image_osp_hqd_tt" src="loio1117f6cfc5ca4f82904904479db79077_HiRes.png">
</div><span class="figcap">Editing mock data in <span class="ph pname">SAP Web IDE</span></span></div>
</li>
</ul></div>
</div></section></div>
</div><div class="related-links"> <div class="familylinks"><div class="parentlink"><br><strong>Parent topic: </strong><a class="link" href="../../#/topic/3a9728ec31f94ca18a7d543ce419d85d.html" title="In this tutorial, we will explore some advanced features of the mock server." target="_top">Mock Server</a><br></div><div class="previouslink"><br><strong>Previous: </strong><a class="link" href="../../#/topic/46c1ca4eb2804af6bfa371ad51c9b887.html" title="In this step, we add the functionality to interpret URL parameters in our local mock server configuration." target="_top">Step 3: Handling Custom URL Parameters</a><br></div></div></div></div></section><div class="clear"></div>
</div><div class="clearfix"></div></div></div><div class="clearfix"></div><div id="footer-container" class="grid_12"><footer>
	<div id="custom-footerSpacer"></div>
	
</footer>
</div></body></html>