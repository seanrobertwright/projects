<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-us" dir="ltr"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Step 5: Adding Actions to the Worklist</title><link rel="icon" href="themes/sap-default/img/favicon.ico" type="image/x-icon"><link rel="shortcut icon" href="themes/sap-default/img/favicon.ico"><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="abstract" content="Now we can easily spot shortages on our stock, but we would also like to take action and resolve it. Either we can decide to remove the product until the shortage is resolved or order new items of the product. In this step, we will add these actions to the footer of the worklist table."><meta name="description" content="Now we can easily spot shortages on our stock, but we would also like to take action and resolve it. Either we can decide to remove the product until the shortage is resolved or order new items of the product. In this step, we will add these actions to the footer of the worklist table."><meta name="content category" content="development"><script type="text/javascript">var d4p = {"relativePath":'',"dev":false,"debug":false,"draft":false,"nextTopicHref":"b561d146f9114b029bd60fa26df09c6b.html","previousTopicHref":"85ec3a9454ac4eb1a901745e773844d3.html"}</script><link rel="stylesheet" type="text/css" media="screen, projection" href="themes/sap-default/css/style.css"><script type="text/javascript">
      
        d4p.cssGridPath = d4p.dev ? 'html5-themes/modules/960-Responsive-Grid/css/' : 'themes/dita-d4p-classic/css/';
        var ADAPT_CONFIG = {
          // Where is your CSS?
          path: d4p.relativePath + d4p.cssGridPath,

          // false = Only run once, when page first loads.
          // true = Change on window resize and page tilt.
          dynamic: true,

          // Optional callback... myCallback(i, width)
          callback: doc_resize,

          // First range entry is the minimum.
          // Last range entry is the maximum.
          // Separate ranges by "to" keyword.
          range: [
             // small (size-0)
            '0px    to 760px  =',
             // medium (size-1, size-2)
            '760px  to 980px  = ',
            '980px  to 1270px = ',
             // large (size-3, size-5)
            '1270px to 1600px = ',
            '1600px to 1940px = ',
             // extra large (size-6)
            '1940px to 2540px = ',
            '2540px           = '
          ]
        };

        function doc_resize(i, width)
        {
          d4p.setBodyClassfunction(i, width);
        }


        
      </script><script type="text/javascript" src="toc-info.js"></script><script type="text/javascript" src="themes/sap-default/js/script.js"></script>
		<!--[if lt IE 9]>
			<script>
			  var e = ("abbr,article,aside,audio,canvas,datalist,details," +
			    "figure,footer,header,hgroup,mark,menu,meter,nav,output," +
			    "progress,section,time,video").split(',');
			  for (var i = 0; i < e.length; i++) {
			    document.createElement(e[i]);
			  }
			</script>
		<![endif]-->
        
    <script>
      function addLoadEvent(func) {
        var oldonload = window.onload;
        if (typeof window.onload != 'function') {
          window.onload = func;
        } else {
          window.onload = function() {
            if (oldonload) {
              oldonload();
        }
        func();
       }
     }
     }
      
    addLoadEvent(function() { prettyPrint();
if ($('#local-navigation').length) {
        $('#local-navigation').navigation();
    }


});
      
    </script>
     <script type="text/javascript" src="js/prettify.js"> </script><script id="search-processing" type="text/javascript" src="js/search-processing.js"> </script><script>function handleAreaClick(oArea) {window.parent.location.href = oArea.href;}</script><link type="text/css" rel="stylesheet" href="css/overrides.css"></head><body class="en-us sap-default centered navigation-default toc-injection enumeration-disabled" style="font-family: &apos;72&apos;, Arial, Helvetica, sans-serif;"><div id="d4h5-main-container" class="container_12" role="application"><ul id="page-links" class="hidden"><li><a id="skip-to-content" href="#d4h5-main-content">Skip to content</a></li><li><a id="skip-to-localnav" href="#local-navigation">Skip to navigation</a></li><li><a id="skip-to-footer" href="#footer-container">Skip to footer</a></li></ul><div id="d4h5-section-container" class="grid_12" style="padding-top: 0;"><div id="d4h5-main-content" class="grid_8 alpha omega" style="margin: 0 0.5em;"><section><div id="content-toolbar" class="toolbar hide-for-small"><div class="familylinks"><div class="parentlink"><br><strong>Parent topic: </strong><a class="link" href="../../#/topic/6a6a621c978145ad9eef2b221d2cf21d.html" title="In this tutorial we will build an app using OpenUI5 that, for example, a shop owner can use to manage his product stock levels." target="_top">Worklist App</a><br></div><div class="previouslink"><br><strong>Previous: </strong><a class="link" href="../../#/topic/85ec3a9454ac4eb1a901745e773844d3.html" title="For easily detecting and managing product shortages in our app, we will add a quick filter for the worklist table. Users can press the filter tabs to display the products according to whether they are in stock, have low stock or no stock. The table will update accordingly and show only the products matching the criteria." target="_top">Step 4: Quick Filter for the Worklist</a><br></div><div class="nextlink"><br><strong>Next: </strong><a class="link" href="../../#/topic/b561d146f9114b029bd60fa26df09c6b.html" title="In this step, we will extend the detail page of our app to show more information of a given product with various UI controls. We will enrich the header area and display further attributes in an info panel for information about the supplier." target="_top">Step 6: Extending the Detail Page</a><br></div></div></div><div class="page concept  - topic-topic concept-concept " id="loio2da220ff496c4b0f9ce29208cbd089f3"><h1 class="title topictitle1" hidden>Step 5: Adding Actions to the Worklist</h1><div class="body conbody"><p class="shortdesc" hidden>Now we can easily spot shortages on our stock, but we would also like to take action and resolve it. Either we can decide to remove the
product until the shortage is resolved or order new items of the product. In this step, we will add these actions to the footer of the
worklist table.</p>
<div class="section"><section class="section" type="Preview"><h2 class="section_title" style="font-size: 1.15em;">Preview</h2>

<div class="fig fignone" id="loio2da220ff496c4b0f9ce29208cbd089f3__fig_yn1_q4y_c5"><div class="figbody">

<img class="inline" id="loio2da220ff496c4b0f9ce29208cbd089f3__image_y4s_jz1_tdb" src="loio016d473029e04ec9be5ed43fa897e69b_LowRes.jpg">
</div><span class="figcap">Actions are now available in the footer bar</span></div>
</section></div>
<div class="section"><section class="section" type="Coding"><h2 class="section_title" style="font-size: 1.15em;">Coding</h2>

<p class="p">You can view and download all files in the <span class="ph uicontrol">Samples</span> in the Demo Kit <span class="ph">at <a class="xref" href="../../#/sample/sap.m.tutorial.worklist.05/preview" target="_top" alt="#/sample/sap.m.tutorial.worklist.05/preview" title="#/sample/sap.m.tutorial.worklist.05/preview">Worklist App - Step 5</a></span>.</p>
<div class="sectiondiv subsection">
<p class="p subsectiontitle">webapp/view/Worklist.view.xml</p>
<pre class="pre codeblock prettyprint lang-xml">...
&lt;Table
	id=&quot;table&quot;
	busyIndicatorDelay=&quot;{worklistView&gt;/tableBusyDelay}&quot;
	growing=&quot;true&quot;
	growingScrollToLoad=&quot;true&quot;
	noDataText=&quot;{worklistView&gt;/tableNoDataText}&quot;
	updateFinished=&quot;.onUpdateFinished&quot;
	width=&quot;auto&quot;
	<span class="ph emphasis emphasis">mode=&quot;MultiSelect&quot;
</span>
	items=&quot;{
		path: &apos;/Products&apos;,
		sorter: {
			path: &apos;ProductName&apos;,
			descending: false
		},
		parameters: {
			&apos;expand&apos;: &apos;Supplier&apos;
		}
	}&quot;&gt;
...</pre>
<p class="p">We change the table <samp class="ph codeph">mode</samp> to <samp class="ph codeph">MultiSelect</samp>. This allows you to select multiple items in the table. Below, we
will add two buttons to the footer bar of the screen. The first button will add to the <samp class="ph codeph">UnitsInStock</samp> property, and
the second will remove the selected products.</p>
</div>
<div class="sectiondiv subsection">
<p class="p subsectiontitle">webapp/view/Worklist.view.xml</p>
<pre class="pre codeblock prettyprint lang-xml">&lt;mvc:View
	 controllerName=&quot;mycompany.myapp.MyWorklistApp.controller.Worklist&quot;
	 xmlns=&quot;sap.m&quot;
	 xmlns:mvc=&quot;sap.ui.core.mvc&quot;
	 xmlns:semantic=&quot;sap.f.semantic&quot;&gt;

	 &lt;semantic:SemanticPage
		  id=&quot;page&quot;
		  headerPinnable=&quot;false&quot;
		  toggleHeaderOnTitleClick=&quot;false&quot;
		  <span class="ph emphasis emphasis">showFooter=&quot;true&quot;</span>&gt;

		  &lt;semantic:titleHeading&gt;
				&lt;Title text=&quot;{i18n&gt;worklistTitle}&quot;/&gt;
		  &lt;/semantic:titleHeading&gt;
		  ...
	 &lt;/semantic:content&gt;
	 &lt;semantic:sendEmailAction&gt;
		  &lt;semantic:SendEmailAction id=&quot;shareEmail&quot; press=&quot;.onShareEmailPress&quot;/&gt;
	 &lt;/semantic:sendEmailAction&gt;
	 <span class="ph emphasis emphasis">&lt;semantic:positiveAction&gt;
		  &lt;semantic:PositiveAction text=&quot;{i18n&gt;TableProductsReorder}&quot; press=&quot;.onUpdateStockObjects&quot;/&gt;
	 &lt;/semantic:positiveAction&gt;
	 &lt;semantic:negativeAction&gt;
		  &lt;semantic:NegativeAction text=&quot;{i18n&gt;TablePorductsUnlist}&quot; press=&quot;.onUnlistObjects&quot;/&gt;
	 &lt;/semantic:negativeAction&gt;</span>
&lt;/semantic:SemanticPage&gt;
...</pre>
<p class="p">Now we add the buttons to the footer bar of the page. The two semantic actions <samp class="ph codeph">Negative</samp> and
<samp class="ph codeph">Positive</samp> will automatically be positioned in the footer bar. The first button will order new items of the
selected products and the second one will remove them. The corresponding event handlers will be implemented in the controller.</p>
</div>
<div class="sectiondiv subsection">
<p class="p subsectiontitle">webapp/controller/Worklist.controller.js</p>
<pre class="pre codeblock prettyprint lang-js">sap.ui.define([
	&quot;./BaseController&quot;,
	&quot;sap/ui/model/json/JSONModel&quot;,
	&quot;myCompany/myApp/model/formatter&quot;,
	&quot;sap/ui/model/Filter&quot;,
	&quot;sap/ui/model/FilterOperator&quot;<span class="ph emphasis emphasis">,
	&quot;sap/m/MessageToast&quot;,
	&quot;sap/m/MessageBox&quot;
</span>
], function(BaseController, JSONModel, formatter, Filter, FilterOperator<span class="ph emphasis emphasis">, MessageToast, MessageBox</span>) {
	&quot;use strict&quot;;

	return BaseController.extend(&quot;myCompany.myApp.controller.Worklist&quot;, {

		formatter: formatter,

...

<span class="ph emphasis emphasis">		/**
		 * Displays an error message dialog. The displayed dialog is content density aware.
		 * @param {string} sMsg The error message to be displayed
		 * @private
		 */
		_showErrorMessage: function(sMsg) {
			MessageBox.error(sMsg, {
				styleClass: this.getOwnerComponent().getContentDensityClass()
			});
		},</span>

		/**
		 * Event handler when a filter tab gets pressed
		 * @param {sap.ui.base.Event} oEvent the filter tab event
		 * @public
		 */
		onQuickFilter: function(oEvent) {
			var oBinding = this._oTable.getBinding(&quot;items&quot;),
				sKey = oEvent.getParameter(&quot;selectedKey&quot;);

			oBinding.filter(this._mFilters[sKey]);
		}<span class="ph emphasis emphasis">,</span>

<span class="ph emphasis emphasis">		/**
		 * Error and success handler for the unlist action.
		 * @param {string} sProductId the product ID for which this handler is called
		 * @param {boolean} bSuccess true in case of a success handler, else false (for error handler)
		 * @param {number} iRequestNumber the counter which specifies the position of this request
		 * @param {number} iTotalRequests the number of all requests sent
		 * @private
		 */
		_handleUnlistActionResult : function (sProductId, bSuccess, iRequestNumber, iTotalRequests){
			// we could create a counter for successful and one for failed requests
			// however, we just assume that every single request was successful and display a success message once
			if (iRequestNumber === iTotalRequests) {
				MessageToast.show(this.getModel(&quot;i18n&quot;).getResourceBundle().getText(&quot;StockRemovedSuccessMsg&quot;, [iTotalRequests]));
			}
		},

		/**
		 * Error and success handler for the reorder action.
		 * @param {string} sProductId the product ID for which this handler is called
		 * @param {boolean} bSuccess true in case of a success handler, else false (for error handler)
		 * @param {number} iRequestNumber the counter which specifies the position of this request
		 * @param {number} iTotalRequests the number of all requests sent
		 * @private
		 */
		_handleReorderActionResult : function (sProductId, bSuccess, iRequestNumber, iTotalRequests){
			// we could create a counter for successful and one for failed requests
			// however, we just assume that every single request was successful and display a success message once
			if (iRequestNumber === iTotalRequests) {
				MessageToast.show(this.getModel(&quot;i18n&quot;).getResourceBundle().getText(&quot;StockUpdatedSuccessMsg&quot;, [iTotalRequests]));
			}
		},

		/**
		 * Event handler for the unlist button. Will delete the
		 * product from the (local) model.
		 * @public
		 */
		onUnlistObjects: function() {
			var aSelectedProducts, i, sPath, oProduct, oProductId;

			aSelectedProducts = this.byId(&quot;table&quot;).getSelectedItems();
			if (aSelectedProducts.length) {
				for (i = 0; i &lt; aSelectedProducts.length; i++) {
					oProduct = aSelectedProducts[i];
					oProductId = oProduct.getBindingContext().getProperty(&quot;ProductID&quot;);
					sPath = oProduct.getBindingContext().getPath();
					this.getModel().remove(sPath, {
						success : this._handleUnlistActionResult.bind(this, oProductId, true, i+1, aSelectedProducts.length),
						error : this._handleUnlistActionResult.bind(this, oProductId, false, i+1, aSelectedProducts.length)
					});
				}
			} else {
				this._showErrorMessage(this.getModel(&quot;i18n&quot;).getResourceBundle().getText(&quot;TableSelectProduct&quot;));
			}
		},


		/**
		 * Event handler for the reorder button. Will reorder the
		 * product by updating the (local) model
		 * @public
		 */
		onUpdateStockObjects: function() {
			var aSelectedProducts, i, sPath, oProductObject;

			aSelectedProducts = this.byId(&quot;table&quot;).getSelectedItems();
			if (aSelectedProducts.length) {
				for (i = 0; i &lt; aSelectedProducts.length; i++) {
					sPath = aSelectedProducts[i].getBindingContext().getPath();
					oProductObject = aSelectedProducts[i].getBindingContext().getObject();
					oProductObject.UnitsInStock += 10;
					this.getModel().update(sPath, oProductObject, {
						success : this._handleReorderActionResult.bind(this, oProductObject.ProductID, true, i+1, aSelectedProducts.length),
						error : this._handleReorderActionResult.bind(this, oProductObject.ProductID, false, i+1, aSelectedProducts.length)
					});
				}
			} else {
				this._showErrorMessage(this.getModel(&quot;i18n&quot;).getResourceBundle().getText(&quot;TableSelectProduct&quot;));
			}
		}</span>
	});
});</pre>
<p class="p">Let&#x2019;s have a look at the implementation of the event handlers for the new actions. We first load the
<samp class="ph codeph">sap.m.MessageToast</samp> control as a new dependency to display a success message for the <samp class="ph codeph">unlist</samp>
and <samp class="ph codeph">reorder</samp> actions.</p>
<p class="p">Both actions are similar from an implementation perspective and the details are described below. They both loop over the selected
items in the table and trigger a model update or deletion on the selected path. After that, a success message with the number of
products processed is displayed. The table is updated automatically by the model change.</p>
<div class="p"><ul class="ul" id="loio2da220ff496c4b0f9ce29208cbd089f3__ul_sb3_3qy_c5">
<li class="li">
<p class="p"><span class="ph uicontrol">Order</span></p>
<p class="p">For each of the selected items the binding path in the model is retrieved by calling the helper method
<samp class="ph codeph">getBindingContextPath</samp> on the selected item. Additionally, the data object from the model is
fetched by calling <samp class="ph codeph">getBindingContext().getObject()</samp> on the item. We update the data object and simply
add <samp class="ph codeph">10</samp> items to the stock to keep things simple in this example. Then we call the update function on
the model with the product path and the new object. This will trigger an OData update request to the back end and a
refresh of the model afterwards (multiple requests are handled together in batch mode). When the model refreshes, the
table will be updated as well because of its binding.</p>
</li>
<li class="li">
<p class="p"><span class="ph uicontrol">Remove</span></p>
<p class="p">For each of the selected items the binding path in the model is retrieved by calling the helper method
<samp class="ph codeph">getBindingContextPath</samp> on the selected item. Then, we call the <samp class="ph codeph">remove</samp> function on
the model with the product path. This triggers an OData <samp class="ph codeph">delete</samp> request to the back end and a refresh
of the OData model afterwards. Again, when the model is refreshed, the table will be updated as well because of its
binding. The ODataModel v2 collects all these requests and only sends one batch request (this default behavior can be
changed).</p>
</li>
</ul>For each action we register both a <samp class="ph codeph">success</samp> handler and an <samp class="ph codeph">error</samp> handler. The
<samp class="ph codeph">success</samp> handler and <samp class="ph codeph">error</samp> handler for each action is the same, but the function is called
with different parameters. This allows us to use the same handler function for both the error and success case. Inside the
corresponding handlers we simply display a success message once by comparing the current request number with the total number of
requests. Furthermore, we assume that all of our requests always succeed.</div>
<p class="p">In a real scenario, you could have a counter for error responses, and one for success responses. Finally, you could implement you
own business logic for error and success cases, like displaying the number of failed and succeeded requests together with the
corresponding product identified by the product ID parameter of the handlers. We don&#x2019;t do this to keep things simple.</p>
<aside class="note" aria-labelledby="note_0_title"><div class="title" id="note_0_title"><strong>Note</strong></div>
<p class="p">In our example, the remove or order actions are only applied to items that are visible in the table, even if the <span class="ph uicontrol">Select
All</span> checkbox of the table is selected. Keep in mind that there may be more data on the back end that is
currently not loaded, and therefore it is neither displayed and nor can it be selected by the user.</p><p class="p">If you want to change this behavior, you might need to change both back-end and front-end code.</p></aside>
</div>
<div class="sectiondiv subsection">
<p class="p subsectiontitle">webapp/i18n/i18n.properties</p>
<pre class="pre codeblock prettyprint lang-prefs">
...
<span class="ph emphasis emphasis">#text of the button for Products reordering
TableProductsReorder=Order

#text for the button for Products unlisting
TablePorductsUnlist=Remove

#Text for no product selected
TableNoProductsSelected=No product selected

#Product successfully deleted
StockRemovedSuccessMsg=Product removed

#Product successfully updated
StockUpdatedSuccessMsg=Product stock level updated</span>

#~~~ Object View ~~~~~~~~~~~~~~~~~~~~~~~~~~
...</pre>
<p class="p">Add the missing texts for the buttons and the message toast.</p>
<p class="p">Save the changes and run the application again. Try the <span class="ph uicontrol">Order</span> and <span class="ph uicontrol">Remove</span> buttons with one or more
products selected. The stock value will be increased or the product will be (temporarily) removed from the worklist table. Since
all of our changes happen on a local mock server, we can simply reload the app to reset the data again.</p>
</div>
</section></div>
</div><div class="related-links"> <div class="familylinks"><div class="parentlink"><br><strong>Parent topic: </strong><a class="link" href="../../#/topic/6a6a621c978145ad9eef2b221d2cf21d.html" title="In this tutorial we will build an app using OpenUI5 that, for example, a shop owner can use to manage his product stock levels." target="_top">Worklist App</a><br></div><div class="previouslink"><br><strong>Previous: </strong><a class="link" href="../../#/topic/85ec3a9454ac4eb1a901745e773844d3.html" title="For easily detecting and managing product shortages in our app, we will add a quick filter for the worklist table. Users can press the filter tabs to display the products according to whether they are in stock, have low stock or no stock. The table will update accordingly and show only the products matching the criteria." target="_top">Step 4: Quick Filter for the Worklist</a><br></div><div class="nextlink"><br><strong>Next: </strong><a class="link" href="../../#/topic/b561d146f9114b029bd60fa26df09c6b.html" title="In this step, we will extend the detail page of our app to show more information of a given product with various UI controls. We will enrich the header area and display further attributes in an info panel for information about the supplier." target="_top">Step 6: Extending the Detail Page</a><br></div></div></div></div></section><div class="clear"></div>
</div><div class="clearfix"></div></div></div><div class="clearfix"></div><div id="footer-container" class="grid_12"><footer>
	<div id="custom-footerSpacer"></div>
	
</footer>
</div></body></html>