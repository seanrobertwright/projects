/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['./library','sap/ui/core/Core','sap/ui/core/Control','sap/ui/core/EnabledPropagator','sap/ui/core/delegate/ItemNavigation','sap/ui/core/IconPool','sap/ui/core/delegate/ScrollEnablement','./IconTabBarSelectList','./Button','./AccButton','./ResponsivePopover','./IconTabFilter','sap/ui/Device','sap/ui/core/ResizeHandler','./IconTabBarDragAndDropUtil','./IconTabHeaderRenderer',"sap/ui/thirdparty/jquery","sap/base/Log","sap/ui/events/KeyCodes"],function(l,C,a,E,I,b,S,c,B,A,R,d,D,e,f,g,q,L,K){"use strict";var t=l.touch;var P=l.PlacementType;var h=l.ButtonType;var j=l.BackgroundDesign;var k=l.IconTabHeaderMode;var m=l.IconTabDensityMode;var n=a.extend("sap.m.IconTabHeader",{metadata:{library:"sap.m",properties:{showSelection:{type:"boolean",group:"Misc",defaultValue:true,deprecated:true},selectedKey:{type:"string",group:"Data",defaultValue:null},visible:{type:"boolean",group:"Behavior",defaultValue:true},mode:{type:"sap.m.IconTabHeaderMode",group:"Appearance",defaultValue:k.Standard},showOverflowSelectList:{type:"boolean",group:"Appearance",defaultValue:false},backgroundDesign:{type:"sap.m.BackgroundDesign",group:"Appearance",defaultValue:j.Solid},enableTabReordering:{type:"boolean",group:"Behavior",defaultValue:false},tabDensityMode:{type:"sap.m.IconTabDensityMode",group:"Appearance",defaultValue:m.Cozy}},aggregations:{items:{type:"sap.m.IconTab",multiple:true,singularName:"item",dnd:{draggable:true,droppable:true,layout:"Horizontal"}},_overflowButton:{type:"sap.m.Button",multiple:false,visibility:"hidden"},_leftArrowButton:{type:"sap.m.Button",multiple:false,visibility:"hidden"},_rightArrowButton:{type:"sap.m.Button",multiple:false,visibility:"hidden"}},events:{select:{parameters:{item:{type:"sap.m.IconTabFilter"},key:{type:"string"}}}}}});var r=sap.ui.getCore().getLibraryResourceBundle("sap.m");E.apply(n.prototype,[true]);n.SCROLL_STEP=264;n.prototype._ARROWS={Left:"Left",Right:"Right"};n.prototype.init=function(){this._bPreviousScrollForward=false;this._bPreviousScrollBack=false;this._iCurrentScrollLeft=0;this.startScrollX=0;this.startTouchX=0;this._scrollable=null;this._aTabKeys=[];this._oItemNavigation=new I().setCycling(false);this._oItemNavigation.attachEvent(I.Events.FocusLeave,this._onItemNavigationFocusLeave,this);this._oItemNavigation.attachEvent(I.Events.AfterFocus,this._onItemNavigationAfterFocus,this);this._oItemNavigation.setDisabledModifiers({sapnext:["alt","meta"],sapprevious:["alt","meta"]});this.addDelegate(this._oItemNavigation);this._oScroller=new S(this,this.getId()+"-head",{horizontal:true,vertical:false,nonTouchScrolling:true});};n.prototype.isTouchScrollingDisabled=function(){return this.getShowOverflowSelectList()&&this.getParent().getMetadata().getName()=='sap.tnt.ToolHeader';};n.prototype._getSelectList=function(){var i=this;if(!this._oSelectList){this._oSelectList=new c({selectionChange:function(o){var T=o.getParameter('selectedItem');i.setSelectedItem(T._tabFilter);}});this._oSelectList._iconTabHeader=this;}return this._oSelectList;};n.prototype._getOverflowButton=function(){var o=this.getAggregation("_overflowButton");if(!o){o=new B({id:this.getId()+'-overflow',icon:"sap-icon://slim-arrow-down",type:h.Transparent,press:this._overflowButtonPress.bind(this)});o.addEventDelegate(this._onOverflowButtonEventDelegate);this.setAggregation("_overflowButton",o);}return o;};n.prototype._overflowButtonPress=function(i){if(!this._oPopover){this._oPopover=new R({showArrow:false,showHeader:false,placement:P.Vertical,offsetX:0,offsetY:0}).addStyleClass('sapMITBPopover');if(D.system.phone){this._oPopover._oControl.addButton(this._createPopoverCloseButton());}this.addDependent(this._oPopover);this._oPopover._oControl._adaptPositionParams=function(){var o=q("body").hasClass("sapUiSizeCompact");this._arrowOffset=0;if(o){this._offsets=["0 0","0 0","0 2","0 0"];}else{this._offsets=["0 0","0 0","0 3","0 0"];}this._myPositions=["end bottom","begin top","end top","end top"];this._atPositions=["end top","end top","end bottom","begin top"];};}var s=this._getSelectList();this._setSelectListItems();this._oPopover.removeAllContent();this._oPopover.addContent(s);this._oPopover.setInitialFocus(s.getSelectedItem());this._oPopover.openBy(this._getOverflowButton());};n.prototype._createPopoverCloseButton=function(){var i=this;return new B({text:r.getText("SELECT_CANCEL_BUTTON"),press:function(){i._closeOverflow();}});};n.prototype._closeOverflow=function(){if(!D.system.desktop){this._oPopover.close();}if(this.oSelectedItem){this.oSelectedItem.$().focus();}};n.prototype._setSelectListItems=function(){if(!this.getShowOverflowSelectList()){return;}var s,T,o=this._getSelectList(),p=this.getTabFilters();o.destroyItems();for(var i=0;i<p.length;i++){T=p[i];s=T.clone(undefined,undefined,{bCloneChildren:false,bCloneBindings:true});s._tabFilter=T;o.addItem(s);if(T==this.oSelectedItem){o.setSelectedItem(s);}}};n.prototype._findSelectItem=function(T){var s=this._getSelectList(),o=s.getItems(),p;for(var i=0;i<o.length;i++){p=o[i];if(p._tabFilter==T){return p;}}};n.prototype._onItemNavigationFocusLeave=function(){if(!this.oSelectedItem){return;}var o=this.getItems();var p=-1;var s;for(var i=0;i<o.length;i++){s=o[i];if(s instanceof d==false){continue;}p++;if(this.oSelectedItem==s){break;}}this._oItemNavigation.setFocusedIndex(p);};n.prototype._onItemNavigationAfterFocus=function(o){var H=this.getDomRef("head"),i=o.getParameter("index"),$=o.getParameter('event');if($.keyCode===undefined){return;}this._iCurrentScrollLeft=H.scrollLeft;this._checkOverflow();if(i!==null&&i!==undefined){this._scrollIntoView(this.getTabFilters()[i],0);}};n.prototype.getTabFilters=function(){var i=this.getItems();var T=[];i.forEach(function(o){if(o instanceof d){T.push(o);}});return T;};n.prototype.exit=function(){if(this._oItemNavigation){this.removeDelegate(this._oItemNavigation);this._oItemNavigation.destroy();delete this._oItemNavigation;}if(this._oScroller){this._oScroller.destroy();this._oScroller=null;}if(this._sResizeListenerId){e.deregister(this._sResizeListenerId);this._sResizeListenerId=null;}if(this._aTabKeys){this._aTabKeys=null;}if(this._oPopover){this._oPopover.destroy();this._oPopover=null;}};n.prototype._handleOnLongDragOver=function(){if(!this._oPopover||!this._oPopover.isOpen()){this._overflowButtonPress();}};n.prototype._handleOnDragOver=function(o){this._getOverflowButton().addStyleClass("sapMBtnDragOver");o.preventDefault();};n.prototype._handleOnDrop=function(){this._getOverflowButton().removeStyleClass("sapMBtnDragOver");};n.prototype._handleOnDragLeave=function(){this._getOverflowButton().removeStyleClass("sapMBtnDragOver");};n.prototype._setsDragAndDropConfigurations=function(){if(!this.getEnableTabReordering()&&this.getDragDropConfig().length){this.destroyDragDropConfig();}else if(this.getEnableTabReordering()&&!this.getDragDropConfig().length){f.setDragDropAggregations(this,"Horizontal");}};n.prototype.onBeforeRendering=function(){this._bRtl=C.getConfiguration().getRTL();this._onOverflowButtonEventDelegate={onlongdragover:this._handleOnLongDragOver.bind(this),ondragover:this._handleOnDragOver.bind(this),ondragleave:this._handleOnDragLeave.bind(this),ondrop:this._handleOnDrop.bind(this)};if(this._sResizeListenerId){e.deregister(this._sResizeListenerId);this._sResizeListenerId=null;}this._updateSelection();this._isTouchScrollingDisabled=this.isTouchScrollingDisabled();this._oScroller.setHorizontal(!this._isTouchScrollingDisabled&&(!this.getEnableTabReordering()||!D.system.desktop));this._setsDragAndDropConfigurations();};n.prototype.setSelectedKey=function(s){var o=this.getTabFilters(),i=0,p=this._isInsideIconTabBar(),u;if(o.length>0){s=s||o[0]._getNonEmptyKey();}if(this.$().length){for(;i<o.length;i++){if(o[i]._getNonEmptyKey()===s){this.setSelectedItem(o[i],true);u=true;break;}}if(!u&&!p&&s){this.setSelectedItem(null);}}this.setProperty("selectedKey",s,true);return this;};n.prototype.setSelectedItem=function(i,o){if(!i){if(this.oSelectedItem){this.oSelectedItem.$().removeClass("sapMITBSelected");this.oSelectedItem=null;}return this;}if(!i.getEnabled()){return this;}if(this.getShowOverflowSelectList()){var s=this._findSelectItem(i);if(s){this._getSelectList().setSelectedItem(s);}}var p=this.getParent();var u=this._isInsideIconTabBar();var v=false;if(i.getContent().length===0&&this.oSelectedItem&&this.oSelectedItem.getContent().length===0){v=true;}if(this.oSelectedItem&&this.oSelectedItem.getVisible()&&(!o&&u&&p.getExpandable()||this.oSelectedItem!==i)){this.oSelectedItem.$().removeClass("sapMITBSelected").attr('aria-selected',false).removeAttr('aria-expanded');}if(i.getVisible()){if(this.oSelectedItem===i){if(!o&&u&&p.getExpandable()){p._toggleExpandCollapse();}}else{if(u){p.$("content").attr('aria-labelledby',i.sId);}this.oSelectedItem=i;this.setProperty("selectedKey",this.oSelectedItem._getNonEmptyKey(),true);if(!u){this.oSelectedItem.$().addClass("sapMITBSelected").attr({'aria-selected':true});}if(u&&(p.getExpandable()||p.getExpanded())){this.oSelectedItem.$().addClass("sapMITBSelected").attr({'aria-selected':true});var w=this.oSelectedItem.getContent();if(w.length>0){p._rerenderContent(w);}else{if(!v){p._rerenderContent(p.getContent());}}if(!o&&p.getExpandable()&&!p.getExpanded()){p._toggleExpandCollapse(true);}}}if(this.oSelectedItem.$().length>0){this._scrollIntoView(i,500);}else{this._scrollAfterRendering=true;}}this.oSelectedItem=i;var x=this.oSelectedItem._getNonEmptyKey();this.setProperty("selectedKey",x,true);if(u){p.setProperty("selectedKey",x,true);}if(!o){if(u){p.fireSelect({selectedItem:this.oSelectedItem,selectedKey:x,item:this.oSelectedItem,key:x});}else{this.fireSelect({selectedItem:this.oSelectedItem,selectedKey:x,item:this.oSelectedItem,key:x});}}return this;};n.prototype.getVisibleTabFilters=function(){var o=this.getTabFilters(),v=[],p;for(var i=0;i<o.length;i++){p=o[i];if(p.getVisible()){v.push(p);}}return v;};n.prototype._getFirstVisibleItem=function(o){for(var i=0;i<o.length;i++){if(o[i].getVisible()){return o[i];}}return null;};n.prototype._initItemNavigation=function(){var i=this,H=this.getDomRef("head"),o=this.getItems(),T=[],s=-1;o.forEach(function(p){if(p instanceof d){var u=i.getFocusDomRef(p);q(u).attr("tabindex","-1");T.push(u);if(p===i.oSelectedItem){s=T.indexOf(u);}}});if(!this._oItemNavigation){this._oItemNavigation=new I();this._oItemNavigation.attachEvent(I.Events.FocusLeave,this._onItemNavigationFocusLeave,this);this._oItemNavigation.attachEvent(I.Events.AfterFocus,this._onItemNavigationAfterFocus,this);this.addDelegate(this._oItemNavigation);}this._oItemNavigation.setRootDomRef(H);this._oItemNavigation.setItemDomRefs(T);this._oItemNavigation.setPageSize(T.length);this._oItemNavigation.setSelectedIndex(s);};n.prototype.onThemeChanged=function(){this._applyTabDensityMode();};n.prototype._applyTabDensityMode=function(){var T=this.getTabDensityMode();this.$().removeClass("sapUiSizeCompact");switch(T){case m.Compact:this.$().addClass("sapUiSizeCompact");break;case m.Inherit:if(this.$().closest(".sapUiSizeCompact").length){this.$().addClass("sapUiSizeCompact");}break;}};n.prototype.onAfterRendering=function(){this._applyTabDensityMode();if(this._oScroller){this._oScroller.setIconTabBar(this,q.proxy(this._afterIscroll,this),q.proxy(this._scrollPreparation,this));}var p=this.getParent();var i=this._isInsideIconTabBar();if(this.oSelectedItem&&(!i||i&&p.getExpanded())){this.oSelectedItem.$().addClass("sapMITBSelected").attr({'aria-selected':true});}if(C.isThemeApplied()){setTimeout(this["_checkOverflow"].bind(this),350);if(this.oSelectedItem){this._scrollIntoView(this.oSelectedItem,500);}}else{C.attachThemeChanged(this._handleThemeLoad,this);}this._initItemNavigation();if(this.getShowOverflowSelectList()){this.$('overflow').attr('tabindex',-1);}this._sResizeListenerId=e.register(this.getDomRef(),q.proxy(this._fnResize,this));this._bCheckIfIntoView=true;};n.prototype._handleThemeLoad=function(){setTimeout(this["_checkOverflow"].bind(this),350);if(this.oSelectedItem){this._scrollIntoView(this.oSelectedItem,500);}C.detachThemeChanged(this._handleThemeLoad,this);};n.prototype.destroyItems=function(){this.oSelectedItem=null;this._aTabKeys=[];this.destroyAggregation("items");return this;};n.prototype.addItem=function(i){if(!(i instanceof sap.m.IconTabSeparator)){var s=i.getKey();if(this._aTabKeys.indexOf(s)!==-1){L.warning("sap.m.IconTabHeader: duplicate key '"+s+"' inside the IconTabFilter. Please use unique keys.");}this._aTabKeys.push(s);}this.addAggregation("items",i);this._invalidateParentIconTabBar();};n.prototype.insertItem=function(i,o){if(!(i instanceof sap.m.IconTabSeparator)){var s=i.getKey();if(this._aTabKeys.indexOf(s)!==-1){L.warning("sap.m.IconTabHeader: duplicate key '"+s+"' inside the IconTabFilter. Please use unique keys.");}this._aTabKeys.push(s);}this.insertAggregation("items",i,o);this._invalidateParentIconTabBar();};n.prototype.removeAllItems=function(){var o=this.removeAllAggregation("items");this._aTabKeys=[];this.oSelectedItem=null;this._invalidateParentIconTabBar();return o;};n.prototype.removeItem=function(i){i=this.removeAggregation("items",i);if(i&&!(i instanceof sap.m.IconTabSeparator)){var s=i.getKey();this._aTabKeys.splice(this._aTabKeys.indexOf(s),1);}if(this.oSelectedItem===i){this.oSelectedItem=null;}this._invalidateParentIconTabBar();return i;};n.prototype.updateAggregation=function(){this.oSelectedItem=null;a.prototype.updateAggregation.apply(this,arguments);this.invalidate();};n.prototype.removeAggregation=function(s,o,i){var p=this.getTabFilters();var u=a.prototype.removeAggregation.apply(this,arguments);if(i){return u;}if(u&&u==this.oSelectedItem&&s=='items'){var v=(p?Array.prototype.indexOf.call(p,u):-1);p=this.getTabFilters();v=Math.max(0,Math.min(v,p.length-1));var w=p[v];if(w){this.setSelectedItem(w,true);}else{var x=this.getParent();if(this._isInsideIconTabBar()&&x.getExpanded()){x.$("content").children().remove();}}}return u;};n.prototype.removeAllAggregation=function(s,i){if(s=='items'){var o=this.getParent();if(this._isInsideIconTabBar()&&o.getExpanded()){o.$("content").children().remove();}}return a.prototype.removeAllAggregation.apply(this,arguments);};n.prototype._getDisplayText=function(i){var T=i.getText();if(this.isInlineMode()){var s=i.getCount();if(s){if(this._bRtl){T='('+s+') '+T;}else{T+=' ('+s+')';}}}return T;};n.prototype.isInlineMode=function(){return this._bTextOnly&&this.getMode()==k.Inline;};n.prototype._checkTextOnly=function(o){if(o.length>0){for(var i=0;i<o.length;i++){if(!(o[i]instanceof sap.m.IconTabSeparator)){if(o[i].getIcon()){this._bTextOnly=false;return false;}}}}this._bTextOnly=true;return true;};n.prototype._checkNoText=function(o){if(o.length>0){for(var i=0;i<o.length;i++){if(!(o[i]instanceof sap.m.IconTabSeparator)){if(o[i].getText().length>0){return false;}}}}return true;};n.prototype._checkInLine=function(o){var p;if(o.length>0){for(var i=0;i<o.length;i++){p=o[i];if(!(p instanceof sap.m.IconTabSeparator)){if(p.getIcon()||p.getCount()){this._bInLine=false;return false;}}}}this._bInLine=true;return true;};n.prototype._checkScrolling=function(H){var $=this.$();var s=false;var i=this.getDomRef("scrollContainerInner");var o=this.getDomRef("head");if(o&&i){if(o.offsetWidth>i.offsetWidth){s=true;}}if(this._scrollable!==s){$.toggleClass("sapMITBScrollable",s);$.toggleClass("sapMITBNotScrollable",!s);this._scrollable=s;}this._setTabsVisibility();return s;};n.prototype._getScrollButton=function(s){var i="_"+s.toLowerCase()+"ArrowButton";if(this.getAggregation(i)){return this.getAggregation(i);}var T=s===this._ARROWS.Left?"TABSTRIP_SCROLL_BACK":"TABSTRIP_SCROLL_FORWARD";var o=r.getText(T);var p=b.getIconURI("slim-arrow-"+s.toLowerCase());var u=new A(this.getId()+"-arrowScroll"+s,{type:h.Transparent,icon:p,tooltip:o,tabIndex:"-1",ariaHidden:"true",press:this._onScrollButtonPress.bind(this,s)});this.setAggregation(i,u);return this.getAggregation(i);};n.prototype._onScrollButtonPress=function(s){var i=s===this._ARROWS.Left?n.SCROLL_STEP:-n.SCROLL_STEP;if(this._bRtl){i=-i;}var o=this._oScroller.getScrollLeft()-i;if(s===this._ARROWS.Left){if(o<0){o=0;}}else{var p=this.$("scrollContainerInner").width();var H=this.$("head").width();if(o>(H-p)){o=H-p;}}this._scrollPreparation();setTimeout(this._oScroller["scrollTo"].bind(this._oScroller,o,0,500),0);setTimeout(this["_afterIscroll"].bind(this),500);};n.prototype._checkOverflow=function(){if(this.bIsDestroyed){return;}var o=this.getDomRef("head");var $=this.$();if(this._checkScrolling(o)&&o){var s=false;var i=false;var p=this.getDomRef("scrollContainerInner");var u=this.getDomRef("head");if(this._oScroller.getScrollLeft()>0){if(this._bRtl){i=true;}else{s=true;}}if((this._oScroller.getScrollLeft()+p.offsetWidth)<u.offsetWidth){if(this._bRtl){s=true;}else{i=true;}}if((i!=this._bPreviousScrollForward)||(s!=this._bPreviousScrollBack)){this._bPreviousScrollForward=i;this._bPreviousScrollBack=s;$.toggleClass("sapMITBScrollBack",s);$.toggleClass("sapMITBNoScrollBack",!s);$.toggleClass("sapMITBScrollForward",i);$.toggleClass("sapMITBNoScrollForward",!i);}}else{this._bPreviousScrollForward=false;this._bPreviousScrollBack=false;}};n.prototype._handleActivation=function(o){var T=o.target.id,i=o.srcControl,s,$=q(o.target);if(i instanceof B){return;}var p=q(document.getElementById(T));if(p.parents()&&Array.prototype.indexOf.call(p.parents(),this.$("content")[0])>-1){}else{if(T){o.preventDefault();if($.hasClass('sapMITBFilterIcon')||$.hasClass('sapMITBCount')||$.hasClass('sapMITBText')||$.hasClass('sapMITBTab')||$.hasClass('sapMITBContentArrow')||$.hasClass('sapMITBSep')||$.hasClass('sapMITBSepIcon')){s=o.srcControl.getId().replace(/-icon$/,"");i=C.byId(s);if(i.getMetadata().isInstanceOf("sap.m.IconTab")&&!(i instanceof sap.m.IconTabSeparator)){this.setSelectedItem(i);}}else if(i.getMetadata().isInstanceOf("sap.m.IconTab")&&!(i instanceof sap.m.IconTabSeparator)){this.setSelectedItem(i);}}else{if(i.getMetadata().isInstanceOf("sap.m.IconTab")&&!(i instanceof sap.m.IconTabSeparator)){this.setSelectedItem(i);}}}};n.prototype._scrollIntoView=function(i,o){if(this.bIsDestroyed||!i.$().length){return;}var $=i.$(),s=this._oScroller.getScrollLeft(),p=this.$("scrollContainerInner").width(),u=$.outerWidth(true),v=$.position().left,w=this._bPreviousScrollBack?this._getScrollButton(this._ARROWS.Left).$().width():0,O=this.getShowOverflowSelectList()?this._getOverflowButton().$().width():0,N;if(v-s<0||v-s>p-u){if(v-s<0){N=v-w;}else{N=Math.min(v,v+u-p+O);N=Math.round(N);}this._scrollPreparation();this._iCurrentScrollLeft=N;setTimeout(this._oScroller["scrollTo"].bind(this._oScroller,N,0,o),0);setTimeout(this["_afterIscroll"].bind(this),o);}};n.prototype._scroll=function(i,o){this._scrollPreparation();var p=this.getDomRef("head");var s=p.scrollLeft;var u=D.browser.msie||D.browser.edge;if(!u&&this._bRtl){i=-i;}var v=s+i;q(p).stop(true,true).animate({scrollLeft:v},o,q.proxy(this._adjustAndShowArrow,this));this._iCurrentScrollLeft=v;};n.prototype._adjustAndShowArrow=function(){this._$bar&&this._$bar.toggleClass("sapMITBScrolling",false);this._$bar=null;if(D.system.desktop){this._checkOverflow();}};n.prototype._scrollPreparation=function(){if(!this._$bar){this._$bar=this.$().toggleClass("sapMITBScrolling",true);}};n.prototype._afterIscroll=function(){this._checkOverflow();this._adjustAndShowArrow();this._setTabsVisibility();};n.prototype._fnResize=function(){this._checkOverflow();if(this.oSelectedItem&&this._bCheckIfIntoView){this._scrollIntoView(this.oSelectedItem,0);if(!this._isTouchScrollingDisabled){this._bCheckIfIntoView=false;}}this._setTabsVisibility();};n.prototype._isInsideIconTabBar=function(){var p=this.getParent();return p instanceof a&&p.isA('sap.m.IconTabBar');};n.prototype._invalidateParentIconTabBar=function(){if(this._isInsideIconTabBar()){this.getParent().invalidate();}};n.prototype._setTabsVisibility=function(){if(!this._isTouchScrollingDisabled){return;}var T=this.getItems(),o,$,H,i;for(i=0;i<T.length;i++){o=T[i];$=o.$();if(!$.hasClass('sapMITBSelected')&&!this._isTabIntoView($)){$.addClass('sapMITBFilterHidden');}else{H=true;$.removeClass('sapMITBFilterHidden');}}if(!H){for(i=0;i<T.length;i++){o=T[i];$=o.$();if(this._isTabIntoView($,true)){$.removeClass('sapMITBFilterHidden');break;}}}this._moveVisibleTabs();};n.prototype._isTabIntoView=function($,s){if(!$.length){return false;}var i=this._oScroller.getScrollLeft(),o=this.$("scrollContainerInner").width(),p=this.$('head'),H=p.innerWidth()-p.width(),u=$.css('padding-left'),v=$.width()+parseFloat(u),w=Math.ceil($.position().left-H/2);if(w-i<0||(!s&&(w+v-i>o))){return false;}return true;};n.prototype._moveVisibleTabs=function(){if(!this._oScroller){return;}var s=this._oScroller.getScrollLeft(),$=this.$('head'),H=$.innerWidth()-$.width(),i=this.$().find('.sapMITBFilter:not(.sapMITBFilterHidden)').first(),o,p;if(!i.length){return;}p=i.position().left-H/2;if(!this._bRtl&&p-s>2){o=s-p;$.css('transform','translate('+o+'px)');}else{$.css('transform','');}return true;};n.prototype.getFocusDomRef=function(F){var T=F||this.oSelectedItem;if(!T){return null;}return T.getDomRef();};n.prototype.applyFocusInfo=function(F){if(F.focusDomRef){q(F.focusDomRef).focus();}};n.prototype._updateSelection=function(){var o=this.getItems(),s=this.getSelectedKey(),i=0,p=this.getParent(),u=this._isInsideIconTabBar(),v=p&&p.getMetadata().getName()=='sap.tnt.ToolHeader';if(o.length>0){if(!this.oSelectedItem||s&&s!==this.oSelectedItem._getNonEmptyKey()){if(s){for(;i<o.length;i++){if(!(o[i]instanceof sap.m.IconTabSeparator)&&o[i]._getNonEmptyKey()===s){this.oSelectedItem=o[i];break;}}}if(!this.oSelectedItem&&(u||!s)){for(i=0;i<o.length;i++){if(!(o[i]instanceof sap.m.IconTabSeparator)&&o[i].getVisible()){this.oSelectedItem=o[i];break;}}}}if(!v&&this.oSelectedItem&&!this.oSelectedItem.getVisible()){for(i=0;i<o.length;i++){if(!(o[i]instanceof sap.m.IconTabSeparator)&&o[i].getVisible()){this.oSelectedItem=o[i];break;}}}if(this.oSelectedItem){this.setProperty("selectedKey",this.oSelectedItem._getNonEmptyKey(),true);}}};n.prototype.ontouchstart=function(o){var T=o.targetTouches[0];this._iActiveTouch=T.identifier;this._iTouchStartPageX=T.pageX;this._iTouchStartPageY=T.pageY;this._iTouchDragX=0;this._iTouchDragY=0;var $=q(o.target);if($.hasClass('sapMITBArrowScroll')){o.preventDefault();}};n.prototype.ontouchmove=function(o){if(this._iActiveTouch===undefined){return;}var T=t.find(o.changedTouches,this._iActiveTouch);if(!T||T.pageX===this._iTouchStartPageX){return;}this._iTouchDragX+=Math.abs(this._iTouchStartPageX-T.pageX);this._iTouchDragY+=Math.abs(this._iTouchStartPageY-T.pageY);this._iTouchStartPageX=T.pageX;this._iTouchStartPageY=T.pageY;};n.prototype.ontouchend=function(o){if(this._iActiveTouch===undefined){return;}var M=D.system.desktop?5:15;if((this._scrollable&&this._iTouchDragX>M)||this._iTouchDragY>M){return;}var i=0;var p=1;var s;if(o.which===s||o.which===i||o.which===p){this._handleActivation(o);}this._iActiveTouch=undefined;};n.prototype.ontouchcancel=n.prototype.ontouchend;n.prototype.onkeydown=function(o){switch(o.which){case K.ENTER:this._handleActivation(o);o.preventDefault();break;case K.SPACE:o.preventDefault();break;}};n.prototype.onkeyup=function(o){if(o.which===K.SPACE){this._handleActivation(o);o.preventDefault();}};n.prototype._handleDragAndDrop=function(o){var s=o.getParameter("dropPosition"),i=o.getParameter("draggedControl"),p=o.getParameter("droppedControl"),u=i.getParent().getMetadata().getName()==="sap.m.IconTabBarSelectList";if(u){this._handleDragAndDropBetweenHeaderAndList(s,p,i);}else{f.handleDrop(this,s,i,p,false);}this._initItemNavigation();i.$().focus();};n.prototype._handleDragAndDropBetweenHeaderAndList=function(s,o,i){var p=this._getSelectList(),u=f.getDraggedDroppedItemsFromList(p.getAggregation("items"),i,o);if(!u){return;}f.handleDrop(this,s,i._tabFilter,o,false);f.handleDrop(p,s,i,u.oDroppedControlFromList,false);p._initItemNavigation();};n.prototype._moveTab=function(T,i){var o=f.moveItem.call(this,T,i);this._initItemNavigation();if(o){this._scrollIntoView(T,0);}};n.prototype.ondragrearranging=function(o){if(!this.getEnableTabReordering()){return;}var T=o.srcControl;this._moveTab(T,o.keyCode);T.$().focus();};n.prototype.onsaphomemodifiers=n.prototype.ondragrearranging;n.prototype.onsapendmodifiers=n.prototype.ondragrearranging;n.prototype.onsapincreasemodifiers=n.prototype.ondragrearranging;n.prototype.onsapdecreasemodifiers=n.prototype.ondragrearranging;return n;});
