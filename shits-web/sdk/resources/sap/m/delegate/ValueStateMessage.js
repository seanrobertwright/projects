/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['sap/ui/Device','sap/ui/base/Object','sap/ui/core/Core','sap/ui/core/ValueStateSupport','sap/ui/core/Popup','sap/ui/core/library',"sap/ui/thirdparty/jquery","sap/ui/dom/jquery/Aria"],function(D,B,C,V,P,c,q){"use strict";var a=c.ValueState;var b=B.extend("sap.m.delegate.ValueState",{constructor:function(o){B.apply(this,arguments);this._oControl=o;this._oPopup=null;}});b.prototype.open=function(){var o=this._oControl,p=this.getPopup(),m=this.createDom(),d=P.Dock,$=q(o.getDomRefForValueStateMessage());if(!o||!p||!m){return;}p.setContent(m);p.close(0);if(p.getContent()){p.getContent().style.maxWidth=o.getDomRef().offsetWidth+"px";}else{p.getContent().style.maxWidth="";}p.open(this.getOpenDuration(),d.BeginTop,d.BeginBottom,o.getDomRefForValueStateMessage(),null,null,D.system.phone?true:P.CLOSE_ON_SCROLL);var e=q(m);if($.offset().top<e.offset().top){e.addClass("sapMValueStateMessageBottom");}else{e.addClass("sapMValueStateMessageTop");}q(o.getFocusDomRef()).addAriaDescribedBy(this.getId());};b.prototype.close=function(){var o=this._oControl,p=this._oPopup;if(p){p.close(0);}if(o){q(o.getFocusDomRef()).removeAriaDescribedBy(this.getId());}};b.prototype.getId=function(){var o=this._oControl;if(!o){return"";}return(typeof o.getValueStateMessageId==="function")?o.getValueStateMessageId():o.getId()+"-message";};b.prototype.getOpenDuration=function(){var o=this._oControl;if(!o){return 0;}return(o.iOpenMessagePopupDuration===undefined)?0:o.iOpenMessagePopupDuration;};b.prototype.createPopup=function(i){i=i||this.getId();if(this._oPopup){return this._oPopup;}this._oPopup=new P(document.createElement("span"),false,false,false);this._oPopup.attachClosed(function(){q(document.getElementById(i)).remove();});this._oPopup.attachOpened(function(){var d=this._oPopup.getContent(),e=D.browser.msie&&this._oControl&&this._oControl.getFormattedValueStateText&&!!this._oControl.getFormattedValueStateText();if(d&&!e){d.style.zIndex=this._getCorrectZIndex();}}.bind(this));return this._oPopup;};b.prototype.getPopup=function(){if(!this._oControl){return null;}return this.createPopup();};b.prototype.createDom=function(){var o=this._oControl;if(!o){return null;}var i=this.getId(),m=document.createElement("div"),s=o.getValueState(),I=D.browser.msie,f=o.getFormattedValueStateText?o.getFormattedValueStateText():null,t,r,A,T;m.id=i;m.setAttribute("role","tooltip");m.setAttribute("aria-live","assertive");if(s===a.Success||s===a.None){m.className="sapUiInvisibleText";}else{m.className="sapMValueStateMessage sapMValueStateMessage"+s;}r=C.getLibraryResourceBundle("sap.m");A=document.createElement("span");A.id=i+"-hidden";if(I){A.className="sapUiHidden";A.setAttribute("aria-hidden","true");}else{A.className="sapUiPseudoInvisibleText";}if(s!==a.None){A.appendChild(document.createTextNode(r.getText("INPUTBASE_VALUE_STATE_"+s.toUpperCase())));}m.appendChild(A);if(!f||!f.getHtmlText()){T=s===a.Success||s===a.None?"":o.getValueStateText()||V.getAdditionalText(o);t=document.createElement("span");t.id=i+"-text";t.appendChild(document.createTextNode(T));m.appendChild(t);}else if(s!==a.Success&&s!==a.None){C.getRenderManager().render(f,m);m.lastElementChild.setAttribute("id",i+"-text");}if(!o.isA('sap.m.Select')&&I){if(!t){m.lastElementChild.setAttribute("id",i+"-text");}else{t.setAttribute("aria-hidden","true");}}return m;};b.prototype.destroy=function(){if(this._oPopup){this._oPopup.destroy();this._oPopup=null;}this._oControl=null;};b.prototype._getCorrectZIndex=function(){var p=this._oControl.$().parents().filter(function(){var z=q(this).css('z-index');return z&&z!=='auto'&&z!=='0';});if(!p.length){return 1;}var h=0;p.each(function(){var z=parseInt(q(this).css('z-index'));if(z>h){h=z;}});return h+1;};return b;});
