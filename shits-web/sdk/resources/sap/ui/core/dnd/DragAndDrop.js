/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/Device","../UIArea","sap/ui/thirdparty/jquery","sap/ui/dom/jquery/control"],function(D,U,q){"use strict";var a={},d=null,o=null,v=null,V=[],b=[],c=null,$,e,g,C,t,l={},f;function h(E,S){if(!E){return;}if(E.addStyleClass){E.addStyleClass(S);}else{E.$().addClass(S);}}function r(E,S){if(!E){return;}if(E.removeStyleClass){E.removeStyleClass(S);}else{E.$().removeClass(S);}}function j(E,i){var F=q(E.target).control(0,true);if(!F){return;}var N=q.Event(null,E);N.type=i;F.getUIArea()._handleEvent(N);}function k(E){return!E.disabled&&/^(input|textarea)$/.test(E.localName);}function s(d,E){if(D.browser.msie||!d||!d.getDragGhost){return;}var i=d.getDragGhost();if(!i){return;}if(!g){g=q('<div class="sapUiDnDGhostContainer"></div>');q(document.body).append(g);}g.append(i);window.setTimeout(function(){g.empty();},0);var O=E.originalEvent;O.dataTransfer.setDragImage(i,O.offsetX,O.offsetY);}function m(E){var i={},I,F=E.originalEvent.dataTransfer,G=function(T,H){if(F&&T=="text"||(D.browser!="msie"&&D.browser!="edge")){F.setData(T,H);}};return{setData:function(K,H){H=""+H;i[K]=H;G(K,H);},getData:function(K){return i[K];},setTextData:function(H){H=""+H;i["text/plain"]=H;i["text"]=H;G("text/plain",H);G("text",H);},getTextData:function(){return i["text/plain"];},setComplexData:function(K,H){i[K]=H;},getComplexData:function(K){return i[K];},getIndicator:function(){return $&&$[0];},setIndicatorConfig:function(H){I=H;},getIndicatorConfig:function(H){return I;},getDragControl:function(){return d;},getDropControl:function(){return v;},setDropControl:function(H){v=H;},getDropInfo:function(){return b[0]||null;},getDropPosition:function(){return C;}};}function n(E){d=o=v=c=null;C="";V=[];b=[];}function p(){if($){return $;}if(!D.browser.msie){e=q("<div class='sapUiDnDIndicatorWrapper'></div>");}$=q("<div class='sapUiDnDIndicator'></div>");if(!e){q(sap.ui.getCore().getStaticAreaRef()).append($);}else{q(sap.ui.getCore().getStaticAreaRef()).append(e);$.appendTo(e);}return $;}function u(){if($){$.removeAttr("style").hide();l={};}}function w(E,i,F,G){if(!i){return;}var I=E.dragSession&&E.dragSession.getIndicatorConfig(),H=i.getBoundingClientRect(),P=window.pageYOffset,J=window.pageXOffset,K=p(),R,S={},L={top:H.top+P,bottom:H.bottom+P,left:H.left+J,right:H.right+J,width:H.width,height:H.height};if(!F||F=="On"){R="On";G="";}else if(G=="Horizontal"){var M=E.pageX-L.left;S.height=L.height;S.top=L.top;if(F=="Between"){S.width="";if(M<L.width*0.5){R="Before";S.left=L.left;}else{R="After";S.left=L.right;}}else if(F=="OnOrBetween"){if(M<L.width*0.25){R="Before";S.left=L.left;S.width="";}else if(M>L.width*0.75){R="After";S.left=L.right;S.width="";}else{R="On";}}if(R!="On"&&sap.ui.getCore().getConfiguration().getRTL()){R=(R=="After")?"Before":"After";}}else{var N=E.pageY-L.top;S.width=L.width;S.left=L.left;if(F=="Between"){S.height="";if(N<L.height*0.5){R="Before";S.top=L.top;}else{R="After";S.top=L.bottom;}}else if(F=="OnOrBetween"){if(N<L.height*0.25){R="Before";S.top=L.top;S.height="";}else if(N>L.height*0.75){R="After";S.top=L.bottom;S.height="";}else{R="On";}}}if(I&&I.display=="none"){return R;}if(R=="On"){S.top=L.top;S.left=L.left;S.width=L.width;S.height=L.height;F=R;}else{F="Between";}if(l.top!=S.top||l.left!=S.left||l.width!=S.width||l.height!=S.height){K.attr("data-drop-layout",G);K.attr("data-drop-position",F);K.css(q.extend(S,I)).show();l=S;}return R;}function x(i){var P=i.getParent(),S=(i.getDragDropConfig)?i.getDragDropConfig():[],E=(P&&P.getDragDropConfig)?P.getDragDropConfig():[];return S.concat(E);}function y(d){var i=x(d);return i.filter(function(E){return E.isDraggable(d);});}function z(o,i,E){var F=x(o);i=i||[];return F.filter(function(G){return!G.isA("sap.ui.core.dnd.IDragInfo");}).concat(i).filter(function(G){if(!G.isDroppable(o,E)){return false;}var H=G.getGroupName();if(!H){return true;}return i.some(function(I){return I.getGroupName()==H;});});}function A(E,i){E.preventDefault();var F=i.getDropEffect().toLowerCase();E.originalEvent.dataTransfer.dropEffect=F;}function B(E,i,v){var T=i.getTargetAggregation();if(!T){return w(E,v.getDomRef());}var F;if(E.getMark("DragWithin")==T){F=v.getDomRefForSetting(T);}F=F||v.getDomRef();return w(E,F,i.getDropPosition(true),i.getDropLayout(true));}a.preprocessEvent=function(E){if(c&&E.type.indexOf("dr")==0){E.dragSession=c;}var i="onbefore"+E.type;if(a[i]){a[i](E);}};a.postprocessEvent=function(E){var i="onafter"+E.type;if(a[i]){a[i](E);}};a.onbeforemousedown=function(E){if(D.browser.msie&&k(E.target)){f=q(E.target).closest("[data-sap-ui-draggable=true]").prop("draggable",false)[0];}};a.onbeforemouseup=function(E){if(f){f.draggable=true;f=null;}};a.onbeforedragstart=function(E){if(!E.target.draggable){return;}if(k(document.activeElement)){E.target.getAttribute("data-sap-ui-draggable")&&E.preventDefault();return;}d=q(E.target).control(0,true);if(!d){return;}V=y(d);if(!V.length){return;}if(D.browser.firefox&&E.originalEvent.dataTransfer.types.length===0){E.originalEvent.dataTransfer.setData("ui5/dummyDataForFirefox","data");}E.dragSession=c=m(E);};a.onafterdragstart=function(E){if(!V.length||E.isDefaultPrevented()){n();return;}V=E.isMarked("NonDraggable")?[]:V.filter(function(i){return i.fireDragStart(E);});if(!V.length){E.preventDefault();n();return;}s(d,E);h(d,"sapUiDnDDragging");q("html").addClass("sapUiDnDNoScrolling");};a.onbeforedragenter=function(E){var F=q(E.target).control(0,true);if(F&&o===F){E.setMark("DragWithin","SameControl");}else{t=Date.now();o=F;}var G=[];v=F;for(var i=0;i<20&&v;i++,v=v.getParent()){G=z(v,V,E);if(G.length){break;}}if(E.getMark("DragWithin")!="SameControl"){b=G;if(c){c.setIndicatorConfig(null);}}if(!b.length){v=null;}else if(!c){E.dragSession=c=m(E);}};a.onafterdragenter=function(E){if(!v||E.isMarked("NonDroppable")){b=[];}else if(E.getMark("DragWithin")!="SameControl"){b=b.filter(function(F){return F.fireDragEnter(E);});}var i=b[0];if(!i||i.getDropEffect()=="None"){u();C="";}else{A(E,i);C=B(E,i,v);}};a.onbeforedragover=function(E){var i=Date.now();if(i-t>=1000){j(E,"longdragover");t=i;}};a.onafterdragover=function(E){var i=b[0];if(!i||i.getDropEffect()=="None"){return;}b.forEach(function(F){F.fireDragOver(E);});A(E,i);if(i&&i.getDropPosition(true)=="On"){return;}C=B(E,i,v);};a.onbeforedrop=function(E){if(b.length){E.preventDefault();}};a.onafterdrop=function(E){b.forEach(function(i){i.fireDrop(E);});this.iDragEndTimer=window.requestAnimationFrame(this.onafterdragend.bind(this,E));};a.onafterdragend=function(E){this.iDragEndTimer=window.cancelAnimationFrame(this.iDragEndTimer);V.forEach(function(i){i.fireDragEnd(E);});r(d,"sapUiDnDDragging");q("html").removeClass("sapUiDnDNoScrolling");u();n();};U.addEventPreprocessor(a.preprocessEvent);U.addEventPostprocessor(a.postprocessEvent);return a;},true);
