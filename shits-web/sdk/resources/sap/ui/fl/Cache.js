/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/LrepConnector","sap/ui/fl/apply/_internal/flexState/FlexState","sap/ui/fl/Utils","sap/base/Log"],function(L,F,U,a){"use strict";var C=function(){};function _(s){return F.getFlexObjectsFromStorageResponse(s).changes;}function b(s,d){if(!d){return s;}return s===C.NOTAG?s.replace(/>$/,''.concat('-',d,'>')):s.concat('-',d);}function c(s){return s.replace(/(^W\/|")/g,'');}C.NOTAG="<NoTag>";C.clearEntries=function(){F.clearState();};C.getChangesFillingCache=function(m,p,i){var P=Promise.resolve();if(i){P=F.clearAndInitialize(p);}return P.then(function(){return F.getStorageResponse(m.name);}).catch(function(){return{};});};C.getCacheKey=function(m,A){if(!m||!m.name||!A){a.warning("Not all parameters were passed to determine a flexibility cache key.");return Promise.resolve(C.NOTAG);}return this.getChangesFillingCache(m).then(function(w){if(w&&w.cacheKey){return c(w.cacheKey);}return C.NOTAG;}).then(function(s){var v=A.getModel(U.VARIANT_MODEL_NAME);var d=v?v.getCurrentControlVariantIds():[];return b(s,d.join("-"));});};C.addChange=function(o,d){var e=_(o.name);if(!e){return;}e.push(d);};C.updateChange=function(o,d){var e=_(o.name);if(!e){return;}for(var i=0;i<e.length;i++){if(e[i].fileName===d.fileName){e.splice(i,1,d);break;}}};C.deleteChange=function(o,d){var e=_(o.name);if(!e){return;}for(var i=0;i<e.length;i++){if(e[i].fileName===d.fileName){e.splice(i,1);break;}}};C.removeChanges=function(o,d){var e=F.getFlexObjectsFromStorageResponse(o.name);e.changes=e.changes.filter(function(f){return d.indexOf(f.fileName)===-1;});var v=e.variantSection;Object.keys(v).forEach(function(i){v[i].variants.forEach(function(V){V.controlChanges=V.controlChanges.filter(function(f){return d.indexOf(f.getFileName())===-1;});});});};return C;},true);
