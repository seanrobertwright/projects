/*
 * ! OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/includes","sap/base/util/restricted/_pick","sap/ui/fl/apply/_internal/flexState/controlVariants/VariantManagementState","sap/ui/fl/apply/_internal/changes/Reverter"],function(i,_,V,R){"use strict";function a(p){var c=V.getVariantChanges(Object.assign(_(p,["vmReference","variantsMap"]),{changeInstance:true,vReference:p.currentVReference}));var C=c.map(function(o){return o.getId();});var m=Object.keys(p.changesMap).reduce(function(b,d){return b.concat(p.changesMap[d]);},[]);var f=m.filter(function(o){return i(C,o.getId());});var n=V.getVariantChanges(Object.assign(_(p,["vmReference","variantsMap"]),{changeInstance:true,vReference:p.newVReference}));var r=[];if(n.length>0){r=f.slice();f.some(function(o){if(n[0]&&o.getId()===n[0].getId()){n.shift();r.shift();}else{return true;}});}else{r=f;}var s={changesToBeReverted:r.reverse(),changesToBeApplied:n};return s;}var S={switchVariant:function(p){p.changesMap=p.flexController._oChangePersistence.getChangesMapForComponent().mChanges;p.variantsMap=V.getContent({reference:p.flexController.getComponentName()});var c=a(p);return R.revertMultipleChanges(c.changesToBeReverted,p).then(p.flexController.applyVariantChanges.bind(p.flexController,c.changesToBeApplied,p.appComponent)).then(V.setCurrentVariant.bind(null,p));}};return S;},true);
