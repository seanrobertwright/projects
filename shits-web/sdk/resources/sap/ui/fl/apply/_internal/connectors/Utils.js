/*
 * ! OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/security/encodeURLParameters","sap/base/Log"],function(a,L){"use strict";var T=0;var _=function(r,u){var e=new Error(r.statusText);e.status=r.status;e.userMessage=u;return e;};var b=function(t){return sap.ui.getCore().getLibraryResourceBundle("sap.ui.fl").getText(t);};return{logAndResolveDefault:function(r,c,f,e){L.error("Connector ("+c.connector+") failed call '"+f+"': "+e);return r;},getUrl:function(r,p,P){if(!r||!p.url){throw new Error("Not all necessary parameters were passed");}var u=p.url+r;if(p.cacheKey){u+="~"+p.cacheKey+"~/";}if(p.reference){u+=p.reference;}else if(p.fileName){u+=p.fileName;}if(P){Object.keys(P).forEach(function(k){if(P[k]===undefined){delete P[k];}});var q=a(P);if(q.length>0){u+="?"+q;}}return u;},sendRequest:function(u,m,p){m=m||"GET";m=m.toUpperCase();return new Promise(function(r,c){var x=new XMLHttpRequest();x.open(m,u);x.timeout=T;if((m==="GET"||m==="HEAD")&&(!p||!p.xsrfToken)){x.setRequestHeader("X-CSRF-Token","fetch");}if((m==="POST"||m==="PUT"||m==="DELETE")&&p&&p.xsrfToken){x.setRequestHeader("X-CSRF-Token",p.xsrfToken);}if(p&&p.contentType){x.setRequestHeader("Content-Type",p.contentType);}if(p&&p.siteId){x.setRequestHeader("X-LRep-Site-Id",p.siteId);}if(p&&p.sAppDescriptorId){x.setRequestHeader("X-LRep-AppDescriptor-Id",p.sAppDescriptorId);}if(p&&p.dataType){x.responseType=p.dataType;}if(p&&p.payload){x.send(p.payload);}else{x.send();}x.onload=function(){if(x.status>=200&&x.status<400){try{var R={};if(x.status!==204){if(!x.response&&x.responseText){x.response=x.responseText;}if(x.response){R.response=typeof x.response==="string"?JSON.parse(x.response):x.response;}}R.status=x.status;if(x.getResponseHeader("X-CSRF-Token")){R.xsrfToken=x.getResponseHeader("X-CSRF-Token");}if(x.getResponseHeader("Etag")){R.etag=x.getResponseHeader("Etag");}r(R);}catch(E){E.userMessage=b("MSG_LOADING_SERVER_RESPONSE_ERROR");c(E);}}else{var s="";try{var o=JSON.parse(x.response);if(Array.isArray(o.messages)&&o.messages.length){s=o.messages.reduce(function(C,d){return C.concat(d.severity==="Error"?d.text+"\n":"");},s);}}catch(e){}c(_(x,s));}};x.ontimeout=function(){c(_(x,b("MSG_CONNECTION_TIMEOUT_ERROR")));};x.onerror=function(){c(_(x,b("MSG_NETWORK_ERROR")));};});}};});
