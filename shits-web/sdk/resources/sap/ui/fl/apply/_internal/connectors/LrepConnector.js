/*
 * ! OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/merge","sap/ui/fl/apply/connectors/BaseConnector","sap/ui/fl/apply/_internal/connectors/Utils","sap/ui/fl/Utils","sap/ui/dom/includeScript","sap/base/util/restricted/_pick"],function(m,B,A,F,i,_){"use strict";var R={DATA:"/flex/data/",MODULES:"/flex/modules/"};var L=m({},B,{layers:["ALL"],xsrfToken:undefined,settings:undefined,_loadModules:function(f){return new Promise(function(r,a){i(f,undefined,r,a);});},_addClientAndLanguageInfo:function(p){var c=F.getUrlParameter("sap-client");var l=F.getUrlParameter("sap-language")||F.getUrlParameter("sap-ui-language");if(!p&&(c||l)){p={};}if(c){p["sap-client"]=c;}if(l){p["sap-language"]=l;}},loadFlexData:function(p){if(p.cacheKey==="<NO CHANGES>"){return Promise.resolve();}var P=_(p,["appVersion"]);this._addClientAndLanguageInfo(P);var a;if(p.appDescriptor&&p.appDescriptor["sap.app"]){a=p.appDescriptor["sap.app"].id;}var d=A.getUrl(R.DATA,p,P);return A.sendRequest(d,"GET",{xsrfToken:this.xsrfToken,siteId:p.siteId,sAppDescriptorId:a}).then(function(r){var o=r.response;if(r.xsrfToken){this.xsrfToken=r.xsrfToken;}if(r.etag){o.cacheKey=r.etag;}else if(p.cacheKey){o.cacheKey=p.cacheKey;}o.changes=o.changes.concat(o.compVariants||[]);if(o.settings){this.settings=o.settings;}if(!o.loadModules){return o;}var M=A.getUrl(R.MODULES,p,P);return this._loadModules(M).then(function(){return o;});}.bind(this));}});return L;},true);
