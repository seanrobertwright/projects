/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/changeHandler/Base","sap/base/util/LoaderExtensions","sap/ui/fl/changeHandler/common/revertAddedControls"],function(B,L,r){"use strict";var a={};a.applyChange=function(c,C,p,m){var n=B.instantiateFragment(c,p);var M=p.modifier;var v=p.view;var A=m.aggregationName;var o=M.findAggregation(C,A);if(!o){a._destroyArrayOfControls(n);throw new Error("The given Aggregation is not available in the given control: "+M.getId(C));}var s=c.getModuleName();var f=L.loadResource(s,{dataType:"text"});var i=m.index;var R=[];n.forEach(function(N,I){if(!M.validateType(N,o,C,f,I)){a._destroyArrayOfControls(n);throw new Error("The content of the xml fragment does not match the type of the targetAggregation: "+o.type);}});n.forEach(function(N,I){M.insertAggregation(C,A,N,i+I,v);R.push({id:M.getId(N),aggregationName:A});});c.setRevertData(R);return n;};a.revertChange=r;a._throwMissingAttributeError=function(A){throw new Error("Attribute missing from the change specific content'"+A+"'");};a._destroyArrayOfControls=function(c){c.forEach(function(C){if(C.destroy){C.destroy();}});};a.completeChangeContent=function(c,s,C){if(!C){C=c.getDefinition();if(!C.content){C.content={};}}if(s.fragmentPath){C.content.fragmentPath=s.fragmentPath;}else{a._throwMissingAttributeError("fragmentPath");}var m=C.reference.replace(/\./g,"/");m+="/changes/";m+=C.content.fragmentPath.replace(/\.fragment\.xml/g,"");c.setModuleName(m);};return a;},true);
