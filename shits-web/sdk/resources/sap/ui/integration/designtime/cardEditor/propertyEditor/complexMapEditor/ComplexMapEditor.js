/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/integration/designtime/baseEditor/propertyEditor/BasePropertyEditor","sap/base/util/restricted/_omit","sap/base/util/restricted/_merge","sap/base/util/deepClone"],function(B,_,a,d){"use strict";var C=B.extend("sap.ui.integration.designtime.cardEditor.propertyEditor.complexMapEditor.ComplexMapEditor",{xmlFragment:"sap.ui.integration.designtime.cardEditor.propertyEditor.complexMapEditor.ComplexMapEditor",renderer:B.getMetadata().getRenderer().render});C.prototype.asyncInit=function(){this._oNestedArrayEditor=this.getContent();this._oNestedArrayEditor.attachValueChange(function(e){var p=e.getParameter("previousValue")||[];var v=d(e.getParameter("value")||[]);var i=v.map(function(V,I){if(typeof V.key==="undefined"){var k="key";var n=0;var c=function(E){return E.key===k;};while(v.some(c)){k="key"+ ++n;}V.key=k;}var b=((!p[I]||V.key!==p[I].key)&&v.some(function(o,f){return o.key===V.key&&f!==I;}));this._setInputState(I,b,this.getI18nProperty("BASE_EDITOR.MAP.DUPLICATE_KEY"));return b;},this).filter(Boolean);if(!i.length){this.setValue(this._formatOutputValue(v));}},this);};C.prototype._formatInputValue=function(v){if(!v){v={};}var f=Object.keys(v).map(function(k){var F=d(v[k]);F.key=k;return F;});return f;};C.prototype.setConfig=function(c){var A=a({},{template:{key:{label:c["keyLabel"]||this.getI18nProperty("CARD_EDITOR.COMPLEX_MAP.KEY"),type:"string",path:"key",enabled:c["allowKeyChange"]!==false}},allowSorting:false},c);A.type="array";A.path="";this._oNestedArrayEditor.setConfig(A);B.prototype.setConfig.call(this,c);};C.prototype._setInputState=function(i,h,e){var c=this._oNestedArrayEditor.getAggregation("propertyEditor");if(!c||!c._aEditorWrappers[i]){return;}var k=c._aEditorWrappers[i].getAggregation("propertyEditors")[0].getContent();if(h){k.setValueState("Error");k.setValueStateText(e);}else{k.setValueState("None");}};C.prototype.setValue=function(v){var f=this._formatInputValue(v);this._oNestedArrayEditor.setValue(f);B.prototype.setValue.call(this,v);};C.prototype._formatOutputValue=function(v){var f={};v.forEach(function(V){f[V.key]=_(V,"key");});return f;};return C;});
