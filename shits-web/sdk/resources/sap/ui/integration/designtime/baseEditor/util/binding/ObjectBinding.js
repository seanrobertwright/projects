/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/base/ManagedObject","sap/base/util/deepClone","sap/base/util/ObjectPath","sap/base/util/isPlainObject","sap/ui/base/BindingParser","sap/base/util/includes"],function(M,d,O,i,B,a){"use strict";var b=M.extend("sap.ui.integration.designtime.baseEditor.util.ObjectBinding",{metadata:{properties:{object:{type:"object"},_value:{type:"any",hidden:true}},events:{change:{parameters:{path:{type:"string"},value:{type:"any"}}}}},_originalObject:null});b.prototype.init=function(){this._aIgnoreList=[];};b.prototype.exit=function(){this._cleanup();};b.prototype.setObject=function(o){this._setOriginalObject(o);this._init();return this;};b.prototype._setObject=function(o){var c=d(o,50);return this.setProperty("object",c);};b.prototype._setOriginalObject=function(o){this._originalObject=d(o,50);};b.prototype._getOriginalObject=function(){return this._originalObject;};b.prototype.setModel=function(){var r=M.prototype.setModel.apply(this,arguments);this._init();return r;};b.prototype.setBindingContext=function(){var r=M.prototype.setBindingContext.apply(this,arguments);this._init();return r;};b.prototype._init=function(){this._cleanup();var o=this._getOriginalObject();if(o){this._setObject(o);this._createPropertyBindings(o);}};b.prototype._cleanup=function(){if(this._mSimpleBindings){Object.keys(this._mSimpleBindings).forEach(function(k){var o=this._mSimpleBindings[k];o.getModel().removeBinding(o);o.destroy();}.bind(this));}this._mSimpleBindings={};};b.prototype._createPropertyBindings=function(o,p){Object.keys(o).filter(function(k){return!this.isIgnored(k);},this).forEach(function(k){var c=p?p+"/"+k:k;if(typeof o[k]==="string"){var e=B.complexParser(o[k]);if(e){if(e.parts){if(!e.parts.find(function(P){return!this.getModel(P.model);}.bind(this))){e.parts.forEach(function(P){this._createSimpleBinding(P,c,e);}.bind(this));}else{return;}}else if(this.getModel(e.model)){this._createSimpleBinding(e,c,e);}else{return;}this._updateValue(c,e);}}else if(o[k]&&(i(o[k])||Array.isArray(o[k]))){this._createPropertyBindings(o[k],c);}},this);};b.prototype._updateValue=function(p,o){var c=this.getObject();var P=p.split("/");var k=P.pop();if(P.length){c=O.get(P,c);}this.bindProperty("_value",o);var v=d(this.getProperty("_value"));this.unbindProperty("_value");if(v!==c[k]){c[k]=v;this.fireChange({path:p,value:v});}};b.prototype._createSimpleBinding=function(s,c,o){var C=this.getBindingContext(s.model);var h=s.model+">"+s.path;var e=this._mSimpleBindings[h];if(!e){e=this.getModel(s.model).bindProperty(s.path,C);this._mSimpleBindings[h]=e;}e.attachChange(function(){this._updateValue(c,o);}.bind(this));return e;};b.prototype.addToIgnore=function(k){this._aIgnoreList=this._aIgnoreList.concat(k);this._init();};b.prototype.removeFromIgnore=function(k){this._aIgnoreList=this._aIgnoreList.filter(function(I){return I!==k;});this._init();};b.prototype.isIgnored=function(k){return a(this._aIgnoreList,k);};return b;});
