/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/integration/designtime/baseEditor/propertyEditor/BasePropertyEditor","sap/ui/core/ListItem","sap/ui/core/Fragment","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/core/IconPool","sap/ui/base/BindingParser","sap/ui/integration/designtime/baseEditor/util/isValidBindingString"],function(B,L,F,J,a,b,I,c,i){"use strict";var o=null;var d=B.extend("sap.ui.integration.designtime.baseEditor.propertyEditor.iconEditor.IconEditor",{xmlFragment:"sap.ui.integration.designtime.baseEditor.propertyEditor.iconEditor.IconEditor",renderer:B.getMetadata().getRenderer().render});d.prototype.asyncInit=function(){var e=this.getContent();this._oIconModel=this._getIconModel();e.setModel(this._oIconModel,"icons");e.bindAggregation("suggestionItems","icons>/",new L({text:"{icons>path}",additionalText:"{icons>name}"}));return Promise.resolve();};d.prototype._getIconModel=function(){if(!o){o=new J(I.getIconNames().map(function(n){return{name:n,path:"sap-icon://"+n};}));}return o;};d.prototype._onLiveChange=function(e){var s=e.getParameter("value");if(this._isValid(s)){this.setValue(s);}};d.prototype._onSuggestionItemSelected=function(e){this.setValue(e.getParameter("selectedItem").getText());};d.prototype._isValid=function(s){var e=this.getContent();var f=I.isIconURI(s)&&!!I.getIconInfo(s);if(s&&!f&&!i(s,false)){e.setValueState("Error");e.setValueStateText(this.getI18nProperty("BASE_EDITOR.ICON.INVALID_BINDING_OR_ICON"));return false;}e.setValueState("None");return true;};d.prototype._getDefaultSearchValue=function(s){try{var p=c.complexParser(s);return p?"":s;}catch(e){return s;}};d.prototype._handleValueHelp=function(e){var v=e.getSource().getValue();if(!this._oDialog){return F.load({name:"sap.ui.integration.designtime.baseEditor.propertyEditor.iconEditor.IconEditorDialog",controller:this}).then(function(D){this._oDialog=D;this.addDependent(this._oDialog);this._oDialog.setModel(this._oIconModel);this._filter(v);this._oDialog.open(this._getDefaultSearchValue(v));return this._oDialog;}.bind(this));}else{this._filter(v);this._oDialog.open(this._getDefaultSearchValue(v));return Promise.resolve(this._oDialog);}};d.prototype.handleSearch=function(e){var v=e.getParameter("value");this._filter(v);};d.prototype._filter=function(v){var f=new a("path",b.Contains,v);var e=this._oDialog.getBinding("items");e.filter([f]);};d.prototype.handleClose=function(e){var s=e.getParameter("selectedItem");if(s){this.setValue(s.getIcon());}e.getSource().getBinding("items").filter([]);};return d;});
