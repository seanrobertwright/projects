/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/base/Object","sap/base/Log"],function(B,L){"use strict";var r=/\{\{destinations.([^\}]+)/;var D=B.extend("sap.ui.integration.util.Destinations",{metadata:{library:"sap.ui.integration"},constructor:function(h,m){B.call(this);this._oHost=h;this._oManifest=m;}});D.prototype.setHost=function(h){this._oHost=h;};D.prototype.process=function(c){var u=c.url,C;if(!u||typeof u!=="string"){return Promise.resolve(c);}if(!this._hasDestination(u)){return Promise.resolve(c);}C=jQuery.extend(true,{},c);return this._processString(u).then(function(p){C.url=p;return C;});};D.prototype._hasDestination=function(s){return!!s.match(r);};D.prototype._processString=function(s){var m=s.match(r),k,n;if(!m){return Promise.resolve(s);}k=m[1];n=this._getName(k);if(!n){return Promise.reject("Can not resolve destination '"+k+"'. Problem with configuration in the manifest.");}if(!this._oHost){return Promise.reject("Can not resolve destination '"+k+"'. There is no 'host' specified.");}return this._oHost.getDestination(n).then(function(u){return this._replaceUrl(s,k,u);}.bind(this));};D.prototype._replaceUrl=function(s,k,u){var S=u.trim().replace(/\/$/,"");return s.replace("{{destinations."+k+"}}",S);};D.prototype._getName=function(k){var c=this._oManifest.get("/sap.card/configuration/destinations/"+k),n;if(!c){L.error("Config for destination '"+k+"' was not found in manifest.");return;}n=c.name;if(!n){L.error("Configuration for destination '"+k+"' is missing a 'name'.");return;}return c.name;};return D;});
