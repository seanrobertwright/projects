/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['sap/ui/base/ManagedObjectMetadata','./ASTUtils','./Doclet','sap/ui/documentation/sdk/thirdparty/esprima',"sap/base/Log"],function(M,A,D,e,L){"use strict";var S=esprima.Syntax;var c;var I;var p;var C;var s;var a=A.createPropertyMap;var u=A.unlend;var g=M._guessSingularName;var b=D.get;var d=L.error;var w=L.warning;var v=L.debug;function f(n){return(n&&n.type===S.CallExpression&&n.callee.type===S.MemberExpression&&n.callee.property.type===S.Identifier&&n.callee.property.name==='extend'&&n.arguments.length>=2&&n.arguments[0].type===S.Literal&&typeof n.arguments[0].value==="string"&&u(n.arguments[1]).type===S.ObjectExpression);}function h(n){return(n&&n.type===S.CallExpression&&n.callee.type===S.MemberExpression&&k(n.callee)==='sap.ui.define');}function k(n){if(n.type===S.MemberExpression){var i=k(n.object);return i?i+"."+n.property.name:null;}else if(n.type===S.Identifier){return s[n.name]?s[n.name]:n.name;}else{return null;}}function l(n,i){var j;if(n.type===S.Literal){return n.value;}else if(n.type===S.UnaryExpression&&n.prefix&&n.argument.type===S.Literal&&typeof n.argument.value==='number'&&(n.operator==='-'||n.operator==='+')){j=n.argument.value;return n.operator==='-'?-j:j;}else if(n.type===S.MemberExpression&&i){j=k(n);if(j.indexOf(i+".")===0){return j.slice(i.length+1);}else if(j.indexOf(i.split(".").slice(-1)[0]+".")===0){return j.slice(i.split(".").slice(-1)[0].length+1);}else{w("did not understand default value '%s', falling back to source",j);return j;}}else if(n.type===S.Identifier&&n.name==='undefined'){return undefined;}else if(n.type===S.ArrayExpression&&n.elements.length===0){return"[]";}d("unexpected type of default value (type='%s', source='%s'), falling back to '???'",n.type,JSON.stringify(n,null,"\t"));return'???';}function m(i,j){var B=k(i.callee.object);var E={metatype:'control',name:i.arguments[0].value,baseType:B,doc:j&&(j.classdesc||j.description),deprecation:j&&j.deprecated,since:j&&j.since,experimental:j&&j.experimental,specialSettings:{},properties:{},aggregations:{},associations:{},events:{},methods:{}};function F(n){return n.slice(0,1).toUpperCase()+n.slice(1);}function G(N,O,P){var Q,n,R,T;Q=N&&a(N.value);if(Q){for(n in Q){if(Q.hasOwnProperty(n)){T=b(Q[n]);R=a(Q[n].value,O);if(R==null){d("no valid metadata for "+n+" (AST type '"+Q[n].value.type+"')");continue;}P(n,R,T,Q[n]);}}}}var H=u(i.arguments[1]);var J=a(H);if(J&&J.metadata&&J.metadata.value.type!==S.ObjectExpression){w("class metadata exists but can't be analyzed. It is not of type 'ObjectExpression', but a '"+J.metadata.value.type+"'.");return null;}var K=J&&J.metadata&&a(J.metadata.value);if(K){v("  analyzing metadata for '"+E.name+"'");E["abstract"]=!!(K["abstract"]&&K["abstract"].value.value);E["final"]=!!(K["final"]&&K["final"].value.value);G(K.specialSettings,"readonly",function(n,N,O){E.specialSettings[n]={name:n,doc:O&&O.description,since:O&&O.since,deprecation:O&&O.deprecated,experimental:O&&O.experimental,visibility:(N.visibility&&N.visibility.value.value)||"public",type:N.type?N.type.value.value:"any",readonly:(N.readyonly&&N.readonly.value.value)||true};});G(K.properties,"type",function(n,O,P){var Q;var N=F(n);var R;E.properties[n]={name:n,doc:P&&P.description,since:P&&P.since,deprecation:P&&P.deprecated,experimental:P&&P.experimental,visibility:(O.visibility&&O.visibility.value.value)||"public",type:(Q=O.type?O.type.value.value:"string"),defaultValue:O.defaultValue?l(O.defaultValue.value,Q):null,group:O.group?O.group.value.value:'Misc',bindable:O.bindable?!!l(O.bindable.value):false,methods:(R={"get":"get"+N,"set":"set"+N})};if(E.properties[n].bindable){R["bind"]="bind"+N;R["unbind"]="unbind"+N;}});E.defaultAggregation=(K.defaultAggregation&&K.defaultAggregation.value.value)||undefined;G(K.aggregations,"type",function(n,O,P){var N=F(n);var Q;E.aggregations[n]={name:n,doc:P&&P.description,deprecation:P&&P.deprecated,since:P&&P.since,experimental:P&&P.experimental,visibility:(O.visibility&&O.visibility.value.value)||"public",type:O.type?O.type.value.value:"sap.ui.core.Control",singularName:O.singularName?O.singularName.value.value:g(n),cardinality:(O.multiple&&!O.multiple.value.value)?"0..1":"0..n",bindable:O.bindable?!!l(O.bindable.value):false,methods:(Q={"get":"get"+N,"destroy":"destroy"+N})};if(E.aggregations[n].cardinality==="0..1"){Q["set"]="set"+N;}else{var R=F(E.aggregations[n].singularName);Q["insert"]="insert"+R;Q["add"]="add"+R;Q["remove"]="remove"+R;Q["indexOf"]="indexOf"+R;Q["removeAll"]="removeAll"+N;}if(E.aggregations[n].bindable){Q["bind"]="bind"+N;Q["unbind"]="unbind"+N;}});G(K.associations,"type",function(n,O,P){var N=F(n);var Q;E.associations[n]={name:n,doc:P&&P.description,deprecation:P&&P.deprecated,since:P&&P.since,experimental:P&&P.experimental,visibility:(O.visibility&&O.visibility.value.value)||"public",type:O.type?O.type.value.value:"sap.ui.core.Control",singularName:O.singularName?O.singularName.value.value:g(n),cardinality:(O.multiple&&O.multiple.value.value)?"0..n":"0..1",methods:(Q={"get":"get"+N})};if(E.associations[n].cardinality==="0..1"){Q["set"]="set"+N;}else{var R=F(E.associations[n].singularName);Q["add"]="add"+R;Q["remove"]="remove"+R;Q["removeAll"]="removeAll"+N;}});G(K.events,null,function(n,O,P){var N=F(n);var Q=E.events[n]={name:n,doc:P&&P.description,deprecation:P&&P.deprecated,since:P&&P.since,experimental:P&&P.experimental,allowPreventDefault:!!(O.allowPreventDefault&&O.allowPreventDefault.value.value),parameters:{},methods:{"attach":"attach"+N,"detach":"detach"+N,"fire":"fire"+N}};G(O.parameters,null,function(R,T,U){Q.parameters[R]={name:R,doc:U&&U.description,deprecation:U&&U.deprecated,since:U&&U.since,experimental:U&&U.experimental,type:T&&T.type?T.type.value.value:""};});});}return E;}function o(n){var j=D.get(n);var B=k(n.expression.left);if(B&&j&&j.isPublic()){var T={metatype:"type",doc:undefined,deprecation:false,visibility:'public'};T.name=B;if(j){T.doc=j.description;T.deprecation=j.deprecation;T.since=j.since;T.experimental=j.experimental;}var E=n.expression.right.properties||[];T.values={};for(var i=0;i<E.length;i++){var F=D.get(E[i]);var G=E[i].key;var H=E[i].value;var J={};if(G.type==S.Identifier){J.name=G.name;}else if(G.type==S.Literal){J.name=G.value;}else{throw new Error();}if(H.type==S.Literal){J.value=H.value;}else{throw new Error();}if(F!=null){J.doc=F.description;J.deprecation=F.deprecation;J.since=F.since;J.experimental=F.experimental;}T.values[J.name]=J;}I.push(T);}}function q(n){var i=D.get(n);var j=n.expression.right.arguments[0].value;var B=A.createPropertyMap(n.expression.right.arguments[1]);var E=null;if(n.expression.right.arguments.length>2&&n.expression.right.arguments[2].type==S.CallExpression&&n.expression.right.arguments[2].callee.type==S.MemberExpression&&k(n.expression.right.arguments[2].callee)=="sap.ui.base.DataType.getType"&&n.expression.right.arguments[2].arguments.length>0&&n.expression.right.arguments[2].arguments[0].type==S.Literal){E=n.expression.right.arguments[2].arguments[0].value;}if(j&&i&&i.isPublic()){var T={metatype:"type",doc:undefined,deprecation:false,visibility:'public'};T.name=j;if(i){T.doc=i.description;T.deprecation=i.deprecation;T.since=i.since;T.experimental=i.experimental;}var F=B.defaultValue;if(F){T.defaultValue=l(F.value,j);}var G=B.isValid;if(G&&G.value.type==S.FunctionExpression&&G.value.body&&G.value.body.body.length>0&&G.value.body.body[0].type==S.ReturnStatement&&G.value.body.body[0].argument.type==S.CallExpression&&G.value.body.body[0].argument.callee.type==S.MemberExpression&&G.value.body.body[0].argument.callee.object.type==S.Literal&&G.value.body.body[0].argument.callee.object.value instanceof RegExp){var H=G.value.body.body[0].argument.callee.object.value.source;if(/^\^\(.*\)\$$/.test(H)){H=H.slice(2,-2);}T.pattern=H;}T.baseType=E;I.push(T);}}function r(i){return/^\.\//.test(i)?c+i.slice(1):i;}function t(P,j){var n='',B='',E,F,G=/{(.*)}/,H;for(var i=0;i<j.length;i++){if(j[i].tag!=='param'){continue;}H=G.exec(j[i].content);E=j[i].content.indexOf(P);if(H&&E>-1){n=H[1];F=E+P.length;B=j[i].content.substr(F);B=B.replace(/[-]/,'').trim();break;}}return{name:P,type:n,doc:B};}var x={"ExpressionStatement":function(n){if(h(n.expression)){var i=0;var B,E;if(i<n.expression.arguments.length&&n.expression.arguments[i].type===S.Literal){n.expression.arguments[i++].value;}if(i<n.expression.arguments.length&&n.expression.arguments[i].type===S.ArrayExpression){B=n.expression.arguments[i++].elements;}if(i<n.expression.arguments.length&&n.expression.arguments[i].type===S.FunctionExpression){E=n.expression.arguments[i++];}if(B&&E&&E.params){for(var j=0;j<B.length;j++){var F=B[j].type===S.Literal?r(B[j].value):null;var G=j<E.params.length?E.params[j].name:null;if(F&&G){s[G]=F.replace(/\//g,'.');}}}}if(n.expression.type==S.AssignmentExpression&&n.expression.right.type==S.ObjectExpression&&n.expression.left.type==S.MemberExpression){o(n);}if(n.expression.type===S.AssignmentExpression&&n.expression.right.type===S.CallExpression&&n.expression.right.callee.type===S.MemberExpression&&n.expression.right.callee.property.type===S.Identifier&&n.expression.right.callee.property.name==='createType'&&k(n.expression.right.callee.object)=='sap.ui.base.DataType'&&n.expression.right.arguments.length>=2&&n.expression.right.arguments[0].type===S.Literal&&n.expression.right.arguments[1].type===S.ObjectExpression){q(n);}if(f(n.expression)){var H=D.get(n)||D.get(n.expression);var J=m(n.expression,H);if(J){I.push(J);}}},"VariableDeclaration":function(n){if(n.declarations.length==1&&n.declarations[0].init&&f(n.declarations[0].init)){var i=D.get(n)||D.get(n.declarations[0]);var j=m(n.declarations[0].init,i);if(j){I.push(j);}}},"FunctionExpression":function(n){var F=n.body.body;F.forEach(function(i){if(i.expression&&i.expression.type!==S.AssignmentExpression){return;}var P=i;var j=D.get(i);if(j&&j.isPublic()&&P.expression&&P.expression.left&&P.expression.left.property&&P.expression.left.object&&P.expression.left.object.object&&P.expression.left.object.object.name===C){var B={},E=P.expression.right.params?P.expression.right.params:[];B.name=P.expression.left.property.name;B.doc=j.description;B.since=j.since;B.experimental=j.experimental;B.deprecation=j.deprecated;B.type=j.type?j.type:'';B.parameters=[];E.forEach(function(G){var H=t(G.name,j.tags);B.parameters.push(H);});p[B.name]=B;}});}};function y(i){i.methods=p;}function z(j,E,n){c=n.split('/').slice(0,-1).join('/');I=[];p={};s={};C=E.split('.').pop();var B=esprima.parse(j,{comment:true,attachComment:true});A.visit(B,x);for(var i=0;i<I.length;i++){if(I[i].name===E){y(I[i]);return I[i];}}}return{analyze:z};},false);
