/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define([],function(){"use strict";var H={};H.CURRENTLY_HIGHLIGHTED_DOM_REFS=[];H.MUTATION_OBSERVER=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;var a=function a(d,c){if(H.CURRENTLY_HIGHLIGHTED_DOM_REFS.indexOf(d)===-1){H.CURRENTLY_HIGHLIGHTED_DOM_REFS.forEach(function(D){if(this._bIsDomNodeDescendant(d,D)){throw new Error("Desired DOM Ref is parent of DOM Ref which is being highlighted.");}else if(this._bIsDomNodeDescendant(D,d)){throw new Error("Desired DOM Ref is child of DOM Ref which is being highlighted.");}},this);H.CURRENTLY_HIGHLIGHTED_DOM_REFS.push(d);}else{throw new Error("Highlighter instance is already created for this DOM Reference");}this._bIsCaseSensitive=!!c.isCaseSensitive;this._aPreviouslyHighlightedNodes=[];this._aPreviouslyOriginalNodes=[];this._aOldTerms=[];this._aRegExTerms=[];this._bUseExternalStyles=!!c.useExternalStyles;this._oDomRef=d;this._oObserver=null;if(c.shouldBeObserved){this._addMutationObserver();}};a.prototype.highlight=function(t){var T;if(!t){this._restorePreviouslyHighlightedNodes();this._aRegExTerms=[];return;}T=this._formatTerms(t);if(!T||!T.length||this._isNewTermsSameAsOld(T)){return;}this._aOldTerms=T;this._cacheRegExTerms();if(this._aPreviouslyHighlightedNodes&&this._aPreviouslyHighlightedNodes.length>0){this._restorePreviouslyHighlightedNodes();}this._toggleMutationObserver(false);this._highlightSubTree(this._oDomRef);this._toggleMutationObserver(true);};a.prototype._cacheRegExTerms=function(){var r;this._aRegExTerms=[];this._aOldTerms.forEach(function(t){t=this._escapeRegExp(t);r=this._bIsCaseSensitive?new RegExp(t,"g"):new RegExp(t,"gi");this._aRegExTerms.push(r);},this);};a.prototype._escapeRegExp=function(t){return t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,'\\$&');};a.prototype._isNewTermsSameAsOld=function(t){var o=this._aOldTerms.length,i;if(o!==t.length){return false;}this._aOldTerms.sort();t.sort();for(i=0;i<o;i++){if(this._aOldTerms[i]!==t[i]){return false;}}return true;};a.prototype._highlightSubTree=function(r){var n,i;for(i=0;i<r.childNodes.length;i++){n=r.childNodes[i];this._processNode(n);}};a.prototype._processNode=function(n){var t,r,i,m,I;if(n.nodeName==="IFRAME"){this._highlightSubTree(n.contentDocument.body);return;}if(n.nodeType===document.ELEMENT_NODE){this._highlightSubTree(n);}else if(n.nodeType===document.TEXT_NODE){t=n.data;m=[];for(i=0;i<this._aRegExTerms.length;i++){r=this._aRegExTerms[i];if(t.search(r)!==-1){I=true;m.push(r);}}if(I){t=this._highlightTerms(m,t);this._replaceNode(n,t);I=false;}}};a.prototype._formatTerms=function(t){var T=t&&t.trim().split(" "),u;u=T.reduce(function(b,c){if(b.indexOf(c)===-1){b.push(c);}return b;},[]);return u;};a.prototype._replaceNode=function(n,h){var w;if(n.parentNode){w=document.createElement('span');w.innerHTML=h;n.parentNode.replaceChild(w,n);this._aPreviouslyHighlightedNodes.push(w);this._aPreviouslyOriginalNodes.push(n);}};a.prototype._restorePreviouslyHighlightedNodes=function(){var m,o;this._toggleMutationObserver(false);for(var i=0;i<this._aPreviouslyHighlightedNodes.length;i++){m=this._aPreviouslyHighlightedNodes[i];o=this._aPreviouslyOriginalNodes[i];if(m.parentNode){m.parentNode.replaceChild(o,m);}}this._aPreviouslyHighlightedNodes=[];this._aPreviouslyOriginalNodes=[];this._toggleMutationObserver(true);};a.prototype._highlightTerms=function(m,t){var o=this._bUseExternalStyles?'<span class="highlightedText">':'<span class="defaultHighlightedText">',c='</span>',C,b,M={},s,u,i=0,I;m.forEach(function(r){while((b=r.exec(t))!==null){C=b["0"];M[b["index"]]=C;}});for(I in M){u=+I+(i*(o.length+c.length));s=M[I];t=t.substring(0,u)+o+s+c+t.substring(u+s.length);i++;}return t;};a.prototype._addMutationObserver=function(){this._instantiateMutationObserver();this._toggleMutationObserver(true);};a.prototype._removeMutationObserver=function(){this._toggleMutationObserver(false);this._oObserver=null;this._oDomRef=null;};a.prototype._toggleMutationObserver=function(c){if(c){this._oObserver.observe(this._oDomRef,this.oObserverConfig);}else{this._oObserver.disconnect();}};a.prototype._bIsDomNodeDescendant=function(p,c){return p.contains(c);};a.prototype._instantiateMutationObserver=function(){this.oObserverConfig={attributes:false,childList:true,characterData:true,subtree:true};this._oObserver=new H.MUTATION_OBSERVER(this._onMutationDetectionCallback.bind(this));};a.prototype._onMutationDetectionCallback=function(m){var b,n;this._toggleMutationObserver(false);m.forEach(function(M){if(M.type==='childList'){b=M.addedNodes;for(var i=0;i<b.length;i++){n=b[i];this._processNode(n);}}else if(M.type==='characterData'){this._processNode(M.target);}},this);this._toggleMutationObserver(true);};a.prototype.destroy=function(){this._removeMutationObserver();};return a;});
