/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/thirdparty/jquery","sap/ui/documentation/sdk/controller/BaseController","sap/ui/model/json/JSONModel","sap/ui/documentation/sdk/controller/util/ControlsInfo","sap/ui/documentation/sdk/util/ToggleFullScreenHandler","sap/ui/documentation/sdk/controller/util/APIInfo","sap/ui/documentation/sdk/model/formatter","sap/m/Label","sap/m/Link","sap/m/Text","sap/m/HBox","sap/m/ObjectAttribute","sap/m/Popover","sap/m/library"],function(q,B,J,C,T,A,f,L,a,b,H,O,P,l){"use strict";var F=l.FlexWrap;return B.extend("sap.ui.documentation.sdk.controller.SubApiDetail",{NOT_AVAILABLE:'N/A',SECTION_MAP:{"properties":"controlProperties","fields":"properties","special settings":"specialsettings"},formatter:f,onInit:function(){this._objectPage=this.byId("apiDetailObjectPage");},initiate:function(r){var h,c,d,o=function(i){return!i.borrowedFrom;};this._sTopicId=r.sTopicId;this._oModel=r.oModel;this._oControlData=this._oModel.getData();this._aApiIndex=r.aApiIndex;this._aAllowedMembers=r.aAllowedMembers;this._sEntityType=r.sEntityType;this._sEntityId=r.sEntityId!=="undefined"?r.sEntityId:undefined;this._oEntityData=r.oEntityData;this._oContainerController=r.oContainerController;this._oContainerView=r.oContainerView;this.getOwnerComponent=function(){return r.oOwnerComponent;};this._oRouter=this.getRouter();this._allProperties=this._oModel.getProperty("/ui5-metadata/properties");this._allAggregations=this._oModel.getProperty("/ui5-metadata/aggregations");this._allAssociations=this._oModel.getProperty("/ui5-metadata/associations");if(this._allProperties){this._selfProperties=this._allProperties.filter(o);h=this._selfProperties.length>0;this._oModel.setProperty("/bShowBorrowedProps",!h);this._oModel.setProperty("/bHasSelfProps",h);this._oModel.setProperty("/bHasBorrowedProps",this._allProperties.length>this._selfProperties.length);this._oModel.setProperty("/ui5-metadata/properties",h?this._selfProperties:this._allProperties);}if(this._allAggregations){this._selfAggregations=this._allAggregations.filter(o);c=this._selfAggregations.length>0;this._oModel.setProperty("/bShowBorrowedAggr",!c);this._oModel.setProperty("/bHasSelfAggr",c);this._oModel.setProperty("/bHasBorrowedAggr",this._allAggregations.length>this._selfAggregations.length);this._oModel.setProperty("/ui5-metadata/aggregations",c?this._selfAggregations:this._allAggregations);}if(this._allAssociations){this._selfAssociations=this._allAssociations.filter(o);d=this._selfAssociations.length>0;this._oModel.setProperty("/bShowBorrowedAssoc",!d);this._oModel.setProperty("/bHasSelfAssoc",d);this._oModel.setProperty("/bHasBorrowedAssoc",this._allAssociations.length>this._selfAssociations.length);this._oModel.setProperty("/ui5-metadata/associations",d?this._selfAssociations:this._allAssociations);}this.setModel(this._oModel);this._oEntityData.appComponent=this._oControlData.component||this.NOT_AVAILABLE;this._oEntityData.hasSample=this._oControlData.hasSample;this._oEntityData.sample=this._oControlData.hasSample?this._sTopicId:this.NOT_AVAILABLE;this._buildHeaderLayout(this._oControlData,this._oEntityData);setTimeout(function(){this._prettify();this._objectPage.attachEvent("subSectionEnteredViewPort",function(){if(this._sPrettyPrintDelayedCallID){clearTimeout(this._sPrettyPrintDelayedCallID);}this._sPrettyPrintDelayedCallID=setTimeout(function(){var $=q('.sapUxAPObjectPageContainer .APIDetailMethodsSection pre:not(.prettyprint)',this._objectPage.$());if($.length>0){$.addClass('prettyprint');window.prettyPrint();}}.bind(this),200);},this);setTimeout(function(){if(this._sEntityType){this._scrollToEntity(this._sEntityType,this._sEntityId);}setTimeout(function(){this._objectPage.attachEvent("_sectionChange",function(e){var s=e.getParameter("section"),S=e.getParameter("subSection");if(this._oNavigatingTo){if(this._oNavigatingTo===S){this._oNavigatingTo=null;}return;}this._modifyURL(s,S,false);},this);this._objectPage.attachEvent("navigate",function(e){var s=e.getParameter("section"),S=e.getParameter("subSection");this._oNavigatingTo=S;this._modifyURL(s,S,true);},this);}.bind(this),500);}.bind(this),1000);}.bind(this),0);this.searchResultsButtonVisibilitySwitch(this.byId("apiDetailBackToSearch"));},onAfterRendering:function(){this.getView().attachBrowserEvent("click",this.onJSDocLinkClick,this);},onExit:function(){this.getView().detachBrowserEvent("click",this.onJSDocLinkClick,this);},onToggleFullScreen:function(e){T.updateMode(e,this._oContainerView,this._oContainerController);},onBorrowedPropCheckboxClick:function(e){var c=e.getParameter("selected");this._oModel.setProperty("/bShowBorrowedProps",c);this._oModel.setProperty("/ui5-metadata/properties",c?this._allProperties:this._selfProperties);},onBorrowedAggrCheckboxClick:function(e){var c=e.getParameter("selected");this._oModel.setProperty("/bShowBorrowedAggr",c);this._oModel.setProperty("/ui5-metadata/aggregations",c?this._allAggregations:this._selfAggregations);},onBorrowedAssocCheckboxClick:function(e){var c=e.getParameter("selected");this._oModel.setProperty("/bShowBorrowedAssoc",c);this._oModel.setProperty("/ui5-metadata/associations",c?this._allAssociations:this._selfAssociations);},onJSDocLinkClick:function(e){var c=e.target.classList,j=c.contains("jsdoclink"),E=c.contains("sapUISDKExternalLink"),s=decodeURIComponent(e.target.getAttribute("data-target")),d;if(!j&&!E){return;}if(E){this.onDisclaimerLinkPress(e);return;}if(c.contains("scrollToMethod")){d="methods";}else if(c.contains("scrollToEvent")){d="events";}else{return;}this._scrollToEntity(d,s);},_modifyURL:function(s,S,c){var d=s.getTitle().toLowerCase(),e=(S&&S.getTitle()!=='Overview')?S.getTitle():'';if(Object.keys(this.SECTION_MAP).indexOf(d)>=0){d=this.SECTION_MAP[d];}this._oRouter.navToChangeUrlOnly({id:this._sTopicId,entityType:d,entityId:e},c);},_prettify:function(){q('.sapUxAPObjectPageContainer pre',this._objectPage.$()).addClass('prettyprint');window.prettyPrint();},scrollToMethod:function(e){this._scrollToEntity("methods",e.getSource().getText());},scrollToEvent:function(e){this._scrollToEntity("events",e.getSource().getText());},scrollToAnnotation:function(e){this._scrollToEntity("annotations",e.getSource().getText());},_scrollToEntity:function(s,S){var c,d,o;if(!s){return;}s=s.toLowerCase();o=this.byId(s);if(!o){return;}if(S){S=S.toLowerCase();d=o.getSubSections();c=d.filter(function(e){return e.getTitle().toLowerCase()===S;});if(c.length){this._objectPage.scrollToSection(c[0].getId(),250);}}else{this._objectPage.scrollToSection(o.getId(),250);}},_scrollContentToTop:function(){if(this._objectPage&&this._objectPage.$().length>0){this._objectPage.getScrollDelegate().scrollTo(0,0);}},_getHeaderLayoutUtil:function(){if(!this._oHeaderLayoutUtil){var _=function(t,s){return new O({title:t,text:s}).addStyleClass("sapUiTinyMarginBottom");},c=function(o){return new a(o||{});},d=function(o){return new b(o||{});},e=function(o){return new L(o||{});},g=function(o,h){var i=new H(o||{});if(h){i.addStyleClass("sapUiDocumentationHeaderNavLinks sapUiTinyMarginBottom");}return i;};this._oHeaderLayoutUtil={_getControlSampleBlock:function(o,E){return g({items:[e({design:"Bold",text:"Control Sample:"}),c({emphasized:true,text:E.sample,visible:!!E.hasSample,href:"entity/"+o.name}),d({text:E.sample,visible:!E.hasSample})]},true);},_getDocumentationBlock:function(o,E){return g({items:[e({design:"Bold",text:"Documentation:"}),c({emphasized:true,text:o.docuLinkText,href:"topic/"+o.docuLink})]},true);},_getUXGuidelinesBlock:function(o){return g({items:[e({design:"Bold",text:"UX Guidelines:"}),c({emphasized:true,text:o.uxGuidelinesLinkText,href:o.uxGuidelinesLink,target:"_blank"}),new sap.m.Image({src:"./resources/sap/ui/documentation/sdk/images/link-sap.png",tooltip:"Information published on SAP site",press:this.onDisclaimerLinkPress})]},true);},_getExtendsBlock:function(o,E){return g({items:[e({text:"Extends:"}),c({text:o.extendsText,href:"api/"+o.extendsText,visible:o.isDerived}),d({text:o.extendsText,visible:!o.isDerived})]},true);},_getSubclassesBlock:function(o,E){var s=E.extendedBy||E.implementedBy,S;this._aSubClasses=s;if(s.length===1){S=c({text:s[0],href:"api/"+s[0]});}else{S=c({text:o.isClass?"View subclasses":"View implementations",press:this._openSubclassesImplementationsPopover.bind(this)});}return g({items:[e({text:o.isClass?"Known direct subclasses:":"Known direct implementations:"}),S]},true);},_getImplementsBlock:function(o,E){var i=[e({text:"Implements:"})];o.implementsParsed.forEach(function(h){i.push(c({text:h.name,href:"api/"+h.href}));});return g({items:i,wrap:F.Wrap},true).addStyleClass("sapUiDocumentationCommaList");},_getModuleBlock:function(o,E){return _("Module",o.module);},_getLibraryBlock:function(o,E){return _("Library",E.lib);},_getVisibilityBlock:function(o,E){return _("Visibility",o.visibility);},_getAvailableSinceBlock:function(o,E){return _("Available since",o.sinceText);},_getApplicationComponentBlock:function(o,E){return _("Application Component",E.appComponent);}};}return this._oHeaderLayoutUtil;},_openSubclassesImplementationsPopover:function(e){var p=this._aSubClasses.map(function(E){return new a({text:E,href:"api/"+E}).addStyleClass("sapUiTinyMarginBottom sapUiTinyMarginEnd");}),o=this._getSubClassesAndImplementationsPopover(p);o.openBy(e.getSource());},_getSubClassesAndImplementationsPopover:function(c){var p=this._getPopover();if(p.getContent().length>0){p.destroyContent();}(c||[]).forEach(p.addContent,p);return p;},_getPopover:function(){if(!this._oPopover){this._oPopover=new P({placement:"Bottom",showHeader:false}).addStyleClass("sapUiDocumentationSubclassesPopover");}return this._oPopover;},_buildHeaderLayout:function(c,e){var d=0,S=1,g=2,E=3,h=[[],[],[]],o=this._getHeaderLayoutUtil(),s=e.extendedBy||e.implementedBy||[],i=[{creator:"_getControlSampleBlock",exists:c.isClass||c.isNamespace},{creator:"_getDocumentationBlock",exists:c.docuLink!==undefined},{creator:"_getUXGuidelinesBlock",exists:c.uxGuidelinesLink!==undefined},{creator:"_getExtendsBlock",exists:c.isClass},{creator:"_getSubclassesBlock",exists:s.length>0},{creator:"_getImplementsBlock",exists:c.hasImplementsData},{creator:"_getModuleBlock",exists:true},{creator:"_getLibraryBlock",exists:c.kind==="namespace"&&e.lib},{creator:"_getVisibilityBlock",exists:c.visibility},{creator:"_getAvailableSinceBlock",exists:true},{creator:"_getApplicationComponentBlock",exists:true}],j=function(){var k=0,I,G=function(k){if(k<=E){return d;}else if(k<=E*2){return S;}return g;};i.forEach(function(m){var n;if(m.exists){n=o[m.creator].call(this,c,e);I=G(++k);h[I].push(n);}},this);}.bind(this);j();h.forEach(function(k,I){var v=this.byId("headerColumn"+I);v.removeAllContent();if(k.length>0){v.setVisible(true);k.forEach(v.addContent,v);}},this);},onAnnotationsLinkPress:function(){this._scrollToEntity("annotations","Summary");},backToSearch:function(){this.onNavBack();}});});
