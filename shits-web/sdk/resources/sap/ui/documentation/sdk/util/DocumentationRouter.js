/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['sap/m/routing/Router','sap/ui/core/routing/History','sap/ui/thirdparty/hasher',"sap/ui/documentation/sdk/controller/util/ControlsInfo"],function(R,H,a,C){"use strict";a.raw=true;var D=R.extend("sap.ui.documentation.sdk.util.DocumentationRouter",{constructor:function(){R.prototype.constructor.apply(this,arguments);this._URLSeparator=window['sap-ui-documentation-static']?"%23":"#";this.getRoute("entitySamplesLegacyRoute").attachPatternMatched(this._onOldEntityRouteMatched,this);this.getRoute("entityAboutLegacyRoute").attachPatternMatched(this._onOldEntityRouteMatched,this);this.getRoute("entityPropertiesLegacyRoute").attachPatternMatched({entityType:"controlProperties"},this._forwardToAPIRef,this);this.getRoute("entityAggregationsLegacyRoute").attachPatternMatched({entityType:"aggregations"},this._forwardToAPIRef,this);this.getRoute("entityAssociationsLegacyRoute").attachPatternMatched({entityType:"associations"},this._forwardToAPIRef,this);this.getRoute("entityEventsLegacyRoute").attachPatternMatched({entityType:"events"},this._forwardToAPIRef,this);this.getRoute("entityMethodsLegacyRoute").attachPatternMatched({entityType:"methods"},this._forwardToAPIRef,this);this.getRoute("topicIdLegacyRoute").attachPatternMatched(this._onOldTopicRouteMatched,this);this.getRoute("apiIdLegacyRoute").attachPatternMatched(this._onOldApiRouteMatched,this);this.getRoute("sampleLegacyRoute").attachPatternMatched({routeName:"sample"},this._onOldSampleRouteMatched,this);this.getRoute("codeLegacyRoute").attachPatternMatched({routeName:"code"},this._onOldSampleRouteMatched,this);this.getRoute("codeFileLegacyRoute").attachPatternMatched({routeName:"codeFile"},this._onOldSampleRouteMatched,this);this.getRoute("ReleaseNotesLegacyRoute").attachPatternMatched(function(){this.navTo("releaseNotes");},this);},_onOldEntityRouteMatched:function(e){this.navTo("entity",{id:e.getParameter("arguments").id},true);},_forwardToAPIRef:function(e,d){d||(d={});d['id']=e.getParameter("arguments").id;this.navTo("apiId",d);},_onOldSampleRouteMatched:function(e,E){var A=e.getParameter("arguments"),s=A.id;C.loadData().then(function(d){var S=d.samples[s],n;if(!S){this.myNavToWithoutHash("sap.ui.documentation.sdk.view.NotFound","XML",false);}n={entityId:S.contexts?Object.keys(S.contexts)[0]:S.entityId,sampleId:s};if(E.routeName==="codeFile"){n['fileName']=decodeURIComponent(A.fileName);}this.navTo(E.routeName,n,true);}.bind(this));},_onOldTopicRouteMatched:function(e){this.navTo("topicId",{id:e.getParameter("arguments").id.replace(/.html$/,"")},true);},_onOldApiRouteMatched:function(e){var E,s,S,I=e.getParameter("arguments").id;if(I){S=I.split("#");if(S.length===2){I=S[0];E=S[1];S=E.split(":");if(S.length===2){E=S[0];s=S[1];}}I=I.replace(/.html$/,"");if(E==='event'){E="events";}}this.navTo("apiId",{id:I,entityType:E,entityId:s},true);},myNavBack:function(r,d){var h=H.getInstance();var p=h.getPreviousHash();if(p!==undefined){window.history.go(-1);}else{var c=true;this.navTo(r,d,c);}},myNavToWithoutHash:function(v,c,m,d){var o=this._getOwnerComponent(),r=o.byId(o.getManifestEntry("/sap.ui5/rootView").id);r.loaded().then(function(r){var A=r.byId("splitApp"),V=this.getView(v,c);A.addPage(V,m);A.toDetail(V.getId(),"show",d);}.bind(this));},_getOwnerComponent:function(){return this._oOwner;},_destroySampleComponent:function(){var c=this._getOwnerComponent()._oCurrentOpenedSample;if(c){c.destroy();c=null;}}});D.prototype.linkClickHandler=function(e){var E=e.target,$=jQuery(E),A,c=e.ctrlKey||e.metaKey,t;if(!E){return;}if($.hasClass("scrollToMethod")||$.hasClass("scrollToEvent")||$.hasClass("scrollToAnnotation")){if(e.preventDefault){e.preventDefault();}return;}if(c){return;}A=g(E);t=b(A);if(!t||/^blob:/.test(t)||/^https?:\/\//.test(t)||/^test-resources\//.test(t)||/^resources\//.test(t)){return;}if(e.preventDefault){e.preventDefault();}if(t==="#"){t="";}if(window['sap-ui-documentation-static']&&this.shouldConvertHash(t)){t=t.replace("#","%23");}this.parse(t);if(window['sap-ui-documentation-static']){window.history.pushState({},undefined,"#/"+t);}else{window.history.pushState({},undefined,t);}};D.prototype.mouseDownClickHandler=function(e){var p=e.buttons,t=e.target,A=g(t),c=e.ctrlKey||e.metaKey,T;if(A){T=b(A);}if(!T||/^https?:\/\//.test(T)){return;}if(p===2||p===4||(c&&p===1)){T=this.convertToStaticFormat(T);A.setAttribute("href",T);}};D.prototype.popstateHandler=function(){var s=!!window['sap-ui-documentation-static'],r=s?location.hash.replace(/^[#/]/,""):this._processPath(location.pathname);this.parse(r);};D.prototype.attachGlobalLinkHandler=function(){if(!this._bGlobalHandlerAttached){document.body.addEventListener("click",this.linkClickHandler.bind(this),true);window['sap-ui-documentation-static']&&document.body.addEventListener("mousedown",this.mouseDownClickHandler.bind(this),true);this._bGlobalHandlerAttached=true;}};D.prototype.attachPopstateHandler=function(){if(!this._bPopstateHandlerAttached){window.addEventListener('popstate',this.popstateHandler.bind(this));this._bPopstateHandlerAttached=true;}};D.prototype._decodeSpecialRouteArguments=function(e){var A=e.getParameters().arguments,E=[],m,M=[],t;if(A.p1===undefined){if(A.id.indexOf(this._URLSeparator)>-1){t=A.id.split(this._URLSeparator);A.id=t[0];A.p1=t[1];}return{id:decodeURIComponent(A.id),entityId:undefined,entityType:A.p1};}if(/^module:\S+$/.test(A.id)){Object.keys(A).forEach(function(k){var s=A[k],t;if(!s){return;}if(!m&&s.indexOf(this._URLSeparator)!==-1){t=s.split(this._URLSeparator);E.push(t[0]);m=t[1];return;}if(!m){E.push(s);}else{M.push(s);}}.bind(this));return{id:E.join("/"),entityId:M.length?M.join("/"):undefined,entityType:m};}if(A.id.indexOf(this._URLSeparator)!==-1){t=A.id.split(this._URLSeparator);A.p2=A.p1;A.id=t[0];A.p1=t[1];}return{id:decodeURIComponent(A.id),entityType:A.p1,entityId:A.p2?decodeURIComponent(A.p2):undefined};};D.prototype.navTo=function(n,p,r){var P;var s=r?"replaceState":"pushState";this._destroySampleComponent();if(n==="apiId"){if(p.id){p.id=encodeURIComponent(p.id);}if(p.entityId){p.entityId=encodeURIComponent(p.entityId);}}P=this.getURL(n,p);if(n==="apiId"){P=P.replace(/#$/,"");P=decodeURIComponent(P);}this.parse(P);if(window['sap-ui-documentation-static']){window.history[s]({},undefined,"#/"+P.replace("#",this._URLSeparator));}else{window.history[s]({},undefined,P);}return this;};if(!window['sap-ui-documentation-static']){D.prototype._processPath=function(p){var B=document.querySelector("base[href]"),s=B?B.getAttribute("href"):"",c=s.slice(0,s.length-1),h=location.hash,t;if(p.startsWith(s)){p=p.replace(s,"");}else if(p.startsWith(c)){p=p.replace(c,"");}if(h){if(!p&&h.indexOf("module%3A")!==-1){t=h.split("/");h="#"+t[1]+"/"+decodeURIComponent(t[2])+(t[3]?"#"+t[3]:"")+(!t[3]?"/":"")+(t[4]?"/"+decodeURIComponent(t[4]):"");}p+=(p?"#":"")+h.slice(1);}return p;};D.prototype.initialize=function(){var p=this._processPath(location.pathname);this.stop();this.parse(p);this.attachPopstateHandler();this.attachGlobalLinkHandler();return this;};D.prototype.navToChangeUrlOnly=function(p,h){var P;if(p.id){p.id=encodeURIComponent(p.id);}if(p.entityId){p.entityId=encodeURIComponent(p.entityId);}P=this.getURL("apiId",p);P=decodeURIComponent(P);if(h){window.history.pushState({},undefined,P);}else{window.history.replaceState({},undefined,P);}return this;};}else{D.prototype.initialize=function(){R.prototype.initialize.apply(this,arguments);this.attachPopstateHandler();this.attachGlobalLinkHandler();return this;};D.prototype.navToChangeUrlOnly=function(p,h){var P;if(p.id){p.id=encodeURIComponent(p.id);}if(p.entityId){p.entityId=encodeURIComponent(p.entityId);}P=this.getURL("apiId",p);P=decodeURIComponent(P);P=P.replace("#",this._URLSeparator);this.stop();hasher.stop();if(h){hasher.setHash(P);}else{hasher.replaceHash(P);}hasher.init();this.initialize(true);};}D.prototype.shouldConvertHash=function(t){return this.getRoute("apiId").match(t)||this.getRoute("apiSpecialRoute").match(t);};D.prototype.convertToStaticFormat=function(h){var l=window.location,n=h;if(this.shouldConvertHash(h)){n=h.replace("#","%23");}n=l.origin+l.pathname+"#/"+n;return n;};function g(A,m){var I=i(A),d=0;m||(m=3);while(!I&&d++<m){A=A.parentElement;I=i(A);}return A;}function i(A){if(A&&A.nodeName==="A"&&A.getAttribute("target")!=="_blank"){return true;}return false;}function b(A){return A.getAttribute("href");}return D;});
