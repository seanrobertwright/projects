/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/Log","sap/ui/base/ManagedObject","sap/ui/core/Fragment","sap/ui/core/library","sap/ui/model/json/JSONModel","sap/ui/rta/Utils","sap/ui/rta/plugin/iframe/SettingsDialogController","sap/ui/fl/util/getContainerUserInfo"],function(L,M,F,c,J,R,S,g){"use strict";var V=c.ValueState;var _=sap.ui.getCore().getLibraryResourceBundle("sap.ui.rta");var a={dialogTitle:_.getText("IFRAME_SETTINGS_DIALOG_TITLE"),dialogCreateTitle:_.getText("IFRAME_SETTINGS_DIALOG_TITLE"),dialogUpdateTitle:_.getText("IFRAME_SETTINGS_DIALOG_UPDATE_TITLE"),sectionTitle:_.getText("IFRAME_SETTINGS_DIALOG_SECTION_TITLE"),newSectionLabel:_.getText("IFRAME_SETTINGS_DIALOG_NEW_SECTION_LABEL"),nameLabel:_.getText("IFRAME_SETTINGS_DIALOG_NAME_LABEL"),sizeTitle:_.getText("IFRAME_SETTINGS_DIALOG_SIZE_TITLE"),widthLabel:_.getText("IFRAME_SETTINGS_DIALOG_WIDTH_LABEL"),heightLabel:_.getText("IFRAME_SETTINGS_DIALOG_HEIGHT_LABEL"),percentUseLabel:_.getText("IFRAME_SETTINGS_DIALOG_PERCENT_USED"),urlTitle:_.getText("IFRAME_SETTINGS_DIALOG_URL_TITLE"),saveText:_.getText("IFRAME_SETTINGS_DIALOG_BUTTON_SAVE"),cancelText:_.getText("IFRAME_SETTINGS_DIALOG_BUTTON_CANCEL"),urlBuilderText:_.getText("IFRAME_SETTINGS_DIALOG_BUTTON_URL_BUILDER")};function b(s){if(s){a.dialogTitle=a.dialogUpdateTitle;}else{a.dialogTitle=a.dialogCreateTitle;}return new J({text:a,section:{visible:false},asNewSection:{value:false},sectionName:{value:"",valueState:V.None},frameWidth:{value:undefined,valueState:V.None},frameWidthUnit:{value:"%"},frameHeight:{value:undefined,valueState:V.None},frameHeightUnit:{value:"%"},frameUrl:{value:"",valueState:V.None},urlBuilderParameters:{value:[]},unitsOfMeasure:[{name:"%"},{name:"px"},{name:"rem"}]});}var d=M.extend("sap.ui.rta.plugin.iframe.SettingsDialog",{metadata:{library:"sap.ui.rta",events:{opened:{}}}});d.prototype.open=function(s){return new Promise(function(r){this._fnResolve=r;this._createDialog(s);}.bind(this));};d.prototype._createDialog=function(s){var e=false;if(s){e=s.updateMode?s.updateMode:false;}this._oJSONModel=b(e);this._oController=new S(this._oJSONModel,s);F.load({name:"sap.ui.rta.plugin.iframe.SettingsDialog",controller:this._oController}).then(function(o){this._oDialog=o;this._oDialog.addStyleClass(R.getRtaStyleClassName());this._oDialog.setModel(this._oJSONModel);this._openDialog();}.bind(this)).catch(function(E){L.error("Error loading fragment sap.ui.rta.plugin.iframe.SettingsDialog: ",E);});};d.prototype._openDialog=function(){this._oDialog.attachAfterOpen(function(){this.fireOpened();}.bind(this));this._oDialog.attachAfterClose(function(){this._oDialog.destroy();this._oDialog=null;this._fnResolve(this._oController.getSettings());this._oController=null;}.bind(this));this._oDialog.open();};d.buildUrlBuilderParametersFor=function(o){var u=g();var U=Object.keys(u).map(function(s){return{label:s,key:"{$user>/"+s+"}",value:u[s]};});var B=o.getBindingContext();var D;if(B){var e=B.getObject();D=Object.keys(e).filter(function(p){return typeof e[p]!=="object";}).map(function(p){return{label:p,key:"{"+p+"}",value:e[p]};});}else{D=[];}return U.concat(D);};return d;});
