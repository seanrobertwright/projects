/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['sap/ui/base/ManagedObject','sap/ui/qunit/QUnitUtils','sap/ui/test/Opa5','sap/ui/Device',"sap/ui/thirdparty/jquery","sap/ui/test/_OpaLogger"],function(M,Q,O,D,q,_){"use strict";return M.extend("sap.ui.test.actions.Action",{metadata:{properties:{idSuffix:{type:"string"}},publicMethods:["executeOn"]},executeOn:function(){return true;},$:function(c){var a;var e="";if(this.getIdSuffix()){a=c.$(this.getIdSuffix());e=a.length?"":"DOM representation of control '"+c+"' has no element with user-provided ID suffix '"+this.getIdSuffix()+"'";}else{var A=this._getAdapter(c);if(A){a=c.$(A);e=a.length?"":"DOM representation of control '"+c+"' has no element with ID suffix '"+A+"' which is the default adapter for '"+this.getMetadata().getName()+"'";}if(!a||!a.length){a=q(c.getFocusDomRef());if(!a.length){a=c.$();if(!a.length){e+="DOM representation of control '"+c+"' has no focus DOM reference";}}}}if(a.length){this.oLogger.info("Found a DOM reference for the control '"+c+"'. Executing '"+this.getMetadata().getName()+"' on the DOM element with ID '"+a[0].id+"'");return a;}else{this.oLogger.error(e);throw new Error(e);}},getUtils:function(){return O.getUtils()||Q;},init:function(){this.controlAdapters={};this.oLogger=_.getLogger(this.getMetadata().getName());},dropPosition:{BEFORE:"BEFORE",AFTER:"AFTER",CENTER:"CENTER"},_getAdapter:function(c){var g=function(m){var a=this.controlAdapters[m.getName()];if(a){if(q.isFunction(a)){return a(c);}if(typeof a==="string"){return a;}}var p=m.getParent();if(p){return g(p);}return null;}.bind(this);return g(c.getMetadata());},_tryOrSimulateFocusin:function(d,c){var o=d[0];var f=false;var i=d.is(":focus");var I=D.browser.msie&&D.browser.version<12;var b=D.browser.firefox&&D.browser.version>=60;if(i||I||b){f=true;}else{d.focus();var w=d.is(":focus");f=!w;}if(f){this.oLogger.debug("Control "+c+" could not be focused - maybe you are debugging?");this._createAndDispatchFocusEvent("focusin",o);this._createAndDispatchFocusEvent("focus",o);this._createAndDispatchFocusEvent("activate",o);}if(!d.is(":focus")){this.oLogger.error("Control "+c+" could not be focused!");}},_simulateFocusout:function(d){this._createAndDispatchFocusEvent("focusout",d);this._createAndDispatchFocusEvent("blur",d);this._createAndDispatchFocusEvent("deactivate",d);},_createAndDispatchMouseEvent:function(n,d){var l=0;var m;if(D.browser.phantomJS||(D.browser.msie&&(D.browser.version<12))){m=document.createEvent("MouseEvent");m.initMouseEvent(n,true,true,window,0,0,0,0,0,false,false,false,false,l,d);}else{m=new MouseEvent(n,{bubbles:true,cancelable:true,identifier:1,target:d,radiusX:1,radiusY:1,rotationAngle:0,button:l,type:n});}d.dispatchEvent(m);},_createAndDispatchFocusEvent:function(n,d){var f;if(D.browser.phantomJS){f=document.createEvent("FocusEvent");f.initEvent(n,true,false);}else if(D.browser.msie&&(D.browser.version<12)){f=document.createEvent("FocusEvent");f.initFocusEvent(n,true,false,window,0,d);}else{f=new FocusEvent(n,{type:n,target:d,curentTarget:d});}d.dispatchEvent(f);this.oLogger.info("Dispatched focus event: '"+n+"'");},_createAndDispatchDragEvent:function(n,d,o){if(D.browser.msie&&D.browser.version<12){return;}var c=this._getEventCoordinates(d,o);var a=new DataTransfer();var b;if(D.browser.phantomJS||D.browser.edge){b=document.createEvent("DragEvent");b.initDragEvent(n,true,true,window,0,c.x,c.y,c.x,c.y,false,false,false,false,1,d,a);}else{b=new DragEvent(n,{type:n,eventPhase:3,bubbles:true,cancelable:true,defaultPrevented:false,composed:true,returnValue:true,cancelBubble:false,target:d,toElement:d,srcElement:d,radiusX:1,radiusY:1,rotationAngle:0,clientX:c.x,clientY:c.y,dataTransfer:a});}d.dispatchEvent(b);},_getEventCoordinates:function(d,o){var $=q(d);var a=$.offset();var c={x:a.left+$.outerWidth()/2,y:a.top+$.outerHeight()/2};if(!o){return c;}switch(o.position){case this.dropPosition.BEFORE:return{x:a.left,y:a.top};case this.dropPosition.AFTER:return{x:a.left+$.outerWidth(),y:a.top+$.outerHeight()};case this.dropPosition.CENTER:default:return c;}}});});
