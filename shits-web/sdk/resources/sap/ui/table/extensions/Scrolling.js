/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./ExtensionBase","../utils/TableUtils","../library","sap/ui/Device","sap/ui/performance/trace/Interaction","sap/base/Log","sap/ui/thirdparty/jquery"],function(E,T,l,D,I,L,q){"use strict";var S=l.SharedDomRef;var M=1000000;var V=2;var c={HORIZONAL:"HORIZONTAL",VERTICAL:"VERTICAL",BOTH:"BOTH"};function d(s,t){L.debug("sap.ui.table.extensions.Scrolling",s,t);}function e(a){return typeof a.isConnected==="boolean"&&a.isConnected||document.body.contains(a);}function P(a,p){var r=true;var C=false;var b=[];var s={cancel:function(){if(this.isCancelled()||!this.isRunning()){return;}C=true;for(var i=0;i<b.length;i++){b[i]();}d("Process was cancelled: "+p.id);},isCancelled:function(){return C;},addCancelListener:function(i){b.push(i);},isRunning:function(){return r;},getInfo:function(){return p;}};var t;d("Process started: "+p.id);if(typeof a==="function"){t=new Promise(function(){a.apply(this,Array.prototype.slice.call(arguments).concat(s));});}else{t=Promise.resolve();}Object.assign(t,s);t.then(function(){if(s.isCancelled()){d("Process has finished due to cancellation: "+p.id);}else{d("Process has finished: "+p.id);}r=false;});return t;}function f(){this.iIndex=0;this.nOffset=0;this.sOffsetType=f.OffsetType.Pixel;this.bIsInitial=true;}f.OffsetType={Pixel:"Pixel",Percentage:"Percentage",PercentageOfBuffer:"PercentageOfBuffer"};f.prototype.getIndex=function(){return this.iIndex;};f.prototype.getOffset=function(){return this.nOffset;};f.prototype.getOffsetType=function(){return this.sOffsetType;};f.prototype.isOffsetInPixel=function(){return this.sOffsetType===f.OffsetType.Pixel;};f.prototype.isInitial=function(){return this.bIsInitial;};f.prototype.setPosition=function(i,a,O){d("ScrollPosition#setPosition(index: "+i+", offset: "+a+", offsetType: "+O+")");if(!f._isPositiveNumber(i)){return;}if(!f._isPositiveNumber(a)){this.nOffset=0;}this.setIndex(i);this.setOffset(a,O);};f.prototype.setIndex=function(i){d("ScrollPosition#setIndex(index: "+i+")");if(!f._isPositiveNumber(i)){return;}this.bIsInitial=false;this.iIndex=i;};f.prototype.setOffset=function(a,O){d("ScrollPosition#setOffset(offset: "+a+", offsetType: "+O+")");if(!f._isPositiveNumber(a)){return;}this.bIsInitial=false;this.sOffsetType=O in f.OffsetType?O:f.OffsetType.Pixel;if(this.isOffsetInPixel()){this.nOffset=Math.round(a);}else{this.nOffset=Math.min(a,1);}};f.prototype.scrollRows=function(r){var N=this.getIndex()+r;var i=this.getOffset();if(!this.isOffsetInPixel()||N<0){i=0;}this.setPosition(Math.max(0,N),i);};f._isPositiveNumber=function(a){return typeof a==="number"&&!isNaN(a)&&a>=0;};var g=new window.WeakMap();var h=function(t){if(!t){return{};}if(!g.has(t)){g.set(t,{oHorizontalScrollbar:null,iHorizontalScrollPosition:null,oVerticalScrollbar:null,oVerticalScrollPosition:new f(t),bIsScrolledVerticallyByWheel:false,bIsScrolledVerticallyByKeyboard:false,pVerticalScrollUpdateProcess:null,oExternalVerticalScrollbar:null,bIsVerticalScrollbarExternal:false,mTimeouts:{},mAnimationFrames:{},mTouchSessionData:null,aOnRowsUpdatedPreprocessors:[]});}return g.get(t);};h.destroy=function(t){delete g.delete(t);};var j={UpdateFromFirstVisibleRow:{id:"UpdateFromFirstVisibleRow",rank:6},UpdateFromScrollPosition:{id:"UpdateFromScrollPosition",rank:5},RestoreScrollPosition:{id:"RestoreScrollPosition",rank:4},AdjustToTotalRowCount:{id:"AdjustToTotalRowCount",rank:3},OnRowsUpdated:{id:"OnRowsUpdated",rank:3},UpdateFromScrollbar:{id:"UpdateFromScrollbar",rank:2},UpdateFromViewport:{id:"UpdateFromViewport",rank:1},canStart:function(t,p){var a=h(t).pVerticalScrollUpdateProcess;var C=a?a.getInfo():null;if(a&&a.isRunning()&&C.rank>p.rank){d("Cannot start update process "+p.id+" - A higher-ranked update process is currently running ("+C.id+")",t);return false;}return true;},start:function(t,p,a){if(!j.canStart(t,p)){return null;}if(h(t).pVerticalScrollUpdateProcess){h(t).pVerticalScrollUpdateProcess.cancel();}h(t).pVerticalScrollUpdateProcess=new P(a,p);return h(t).pVerticalScrollUpdateProcess;}};var H={onScrollbarScroll:function(a){var N=a.target.scrollLeft;var O=a.target._scrollLeft;I.notifyScrollEvent&&I.notifyScrollEvent(a);if(N!==O){var s=H.getScrollAreas(this);a.target._scrollLeft=N;for(var i=0;i<s.length;i++){var b=s[i];if(b!==a.target&&b.scrollLeft!==N){b.scrollLeft=N;b._scrollLeft=N;}}h(this).iHorizontalScrollPosition=N;}},restoreScrollPosition:function(t){var s=t._getScrollExtension();var a=s.getHorizontalScrollbar();if(a&&h(t).iHorizontalScrollPosition!==null){var b=H.getScrollAreas(t);for(var i=0;i<b.length;i++){var p=b[i];delete p._scrollLeft;}if(a.scrollLeft!==h(t).iHorizontalScrollPosition){a.scrollLeft=h(t).iHorizontalScrollPosition;}else{var r=q.Event("scroll");r.target=a;H.onScrollbarScroll.call(t,r);}}},onScrollbarMouseDown:function(a){this._getKeyboardExtension().setActionMode(false);},addEventListeners:function(t){var s=t._getScrollExtension();var a=s.getHorizontalScrollbar();var b=H.getScrollAreas(t);if(!s._onHorizontalScrollEventHandler){s._onHorizontalScrollEventHandler=H.onScrollbarScroll.bind(t);}for(var i=0;i<b.length;i++){b[i].addEventListener("scroll",s._onHorizontalScrollEventHandler);}if(a){if(!s._onHorizontalScrollbarMouseDownEventHandler){s._onHorizontalScrollbarMouseDownEventHandler=H.onScrollbarMouseDown.bind(t);}a.addEventListener("mousedown",s._onHorizontalScrollbarMouseDownEventHandler);}},removeEventListeners:function(t){var s=t._getScrollExtension();var a=s.getHorizontalScrollbar();var b=H.getScrollAreas(t);if(s._onHorizontalScrollEventHandler){for(var i=0;i<b.length;i++){b[i].removeEventListener("scroll",s._onHorizontalScrollEventHandler);delete b[i]._scrollLeft;}delete s._onHorizontalScrollEventHandler;}if(a&&s._onHorizontalScrollbarMouseDownEventHandler){a.removeEventListener("mousedown",s._onHorizontalScrollbarMouseDownEventHandler);delete s._onHorizontalScrollbarMouseDownEventHandler;}},getScrollAreas:function(t){var a=t.getDomRef();var s;if(a){s=Array.prototype.slice.call(t.getDomRef().querySelectorAll(".sapUiTableCtrlScr"));}var b=[t._getScrollExtension().getHorizontalScrollbar()].concat(s);return b.filter(function(i){return i!=null;});}};var k={performUpdateFromFirstVisibleRow:function(t,b){d("VerticalScrollingHelper.performUpdateFromFirstVisibleRow",t);j.start(t,j.UpdateFromFirstVisibleRow,function(r,a,p){if(b===true){var O=function(){d("VerticalScrollingHelper.performUpdateFromFirstVisibleRow (async: rows update)",t);k._performUpdateFromFirstVisibleRow(t,p).then(r);return false;};k.addOnRowsUpdatedPreprocessor(t,O);p.addCancelListener(function(){var R=k.removeOnRowsUpdatedPreprocessor(t,O);if(R){r();}});}else{k._performUpdateFromFirstVisibleRow(t,p).then(r);}});},_performUpdateFromFirstVisibleRow:function(t,p){return k.adjustScrollPositionToFirstVisibleRow(t,p).then(function(){if(k.isIndexInBuffer(t,t.getFirstVisibleRow())){return k.adjustFirstVisibleRowToScrollPositionInBuffer(t,p);}return Promise.resolve();}).then(function(){return Promise.all([k.scrollViewport(t,p),k.scrollScrollbar(t,p)]);});},performUpdateFromScrollPosition:function(t){d("VerticalScrollingHelper.performUpdateFromScrollPosition",t);j.start(t,j.UpdateFromScrollPosition,function(r,a,p){k.adjustFirstVisibleRowToScrollPosition(t,null,p).then(function(){if(p.isCancelled()){return;}var s=h(t).oVerticalScrollPosition;d("VerticalScrollingHelper.performUpdateFromScrollPosition (async: firstVisibleRow update)",t);if(s.getIndex()>t.getFirstVisibleRow()){s.setIndex(t.getFirstVisibleRow());if(T.isVariableRowHeightEnabled(t)){s.setOffset(1,f.OffsetType.Percentage);}else{s.setOffset(0);}}}).then(function(){return Promise.all([k.scrollViewport(t,p),k.scrollScrollbar(t,p)]);}).then(r);});},performUpdateFromScrollbar:function(t){var _=h(t);d("VerticalScrollingHelper.performUpdateFromScrollbar",t);clearTimeout(_.mTimeouts.largeDataScrolling);delete _.mTimeouts.largeDataScrolling;j.start(t,j.UpdateFromScrollbar,function(r,a,p){if(t._bLargeDataScrolling&&!h(t).bIsScrolledVerticallyByWheel){_.mTimeouts.largeDataScrolling=setTimeout(function(){delete _.mTimeouts.largeDataScrolling;if(t._getScrollExtension().getVerticalScrollbar()!=null){d("VerticalScrollingHelper.performUpdateFromScrollbar (async: large data scrolling)",t);k._performUpdateFromScrollbar(t,p).then(r);}else{d("VerticalScrollingHelper.performUpdateFromScrollbar (async: large data scrolling): No scrollbar",t);}},300);p.addCancelListener(function(){if(_.mTimeouts.largeDataScrolling!=null){clearTimeout(_.mTimeouts.largeDataScrolling);delete _.mTimeouts.largeDataScrolling;r();}});}else{k._performUpdateFromScrollbar(t,p).then(r);}});},_performUpdateFromScrollbar:function(t,p){return k.adjustScrollPositionToScrollbar(t,p).then(function(){return k.adjustFirstVisibleRowToScrollPosition(t,null,p);}).then(function(){if(T.isVariableRowHeightEnabled(t)){return k.scrollViewport(t,p);}if(p.isCancelled()){return Promise.resolve();}var s=h(t).oVerticalScrollPosition;var i=s.getIndex();var a=t._getMaxFirstRenderedRowIndex();var r=t._aRowHeights;switch(s.getOffsetType()){case f.OffsetType.Percentage:var b=Math.max(0,Math.min(r.length-1,i-a));s.setOffset(r[b]*s.getOffset());break;case f.OffsetType.PercentageOfBuffer:s.setOffset(0);break;default:}return Promise.resolve();});},performUpdateFromViewport:function(t){d("VerticalScrollingHelper.performUpdateFromViewport",t);j.start(t,j.UpdateFromViewport,function(r,a,p){k.adjustScrollPositionToViewport(t,p).then(function(){return k.adjustFirstVisibleRowToScrollPosition(t,true,p);}).then(function(){return k.scrollScrollbar(t,p);}).then(r);});},onScrollbarScroll:function(a){I.notifyScrollEvent&&I.notifyScrollEvent(a);if(!j.canStart(this,j.UpdateFromScrollbar)){return;}if(h(this).bIsScrolledVerticallyByKeyboard){d("VerticalScrollingHelper.onScrollbarScroll: Aborted - Scrolled by keyboard",this);return;}this._getKeyboardExtension().setActionMode(false);var b=a.target.scrollTop;var i=a.target._scrollTop;var s=b!==i;delete a.target._scrollTop;if(b===0&&!e(a.target)){d("VerticalScrollingHelper.onScrollbarScroll: Scrollbar is not connected with the DOM",this);}else if(s){d("VerticalScrollingHelper.onScrollbarScroll: Scroll position changed to "+b+" by interaction",this);k.performUpdateFromScrollbar(this);}else{d("VerticalScrollingHelper.onScrollbarScroll: Scroll position changed to "+b+" by API",this);}h(this).bIsScrolledVerticallyByWheel=false;},onViewportScroll:function(a){if(!j.canStart(this,j.UpdateFromViewport)){return;}var b=a.target.scrollTop;var i=a.target._scrollTop;delete a.target._scrollTop;if(b!==i){d("VerticalScrollingHelper.onViewportScroll: Scroll position changed to "+b+" by interaction",this);k.performUpdateFromViewport(this);}else{d("VerticalScrollingHelper.onViewportScroll: Scroll position changed to "+b+" by API",this);}},adjustFirstVisibleRowToScrollPosition:function(t,s,p){if(p&&p.isCancelled()){return Promise.resolve();}s=s===true;var a=h(t).oVerticalScrollPosition;var N=a.getIndex();var O=t.getFirstVisibleRow();var b=k.isIndexInBuffer(t,N);var i=b;d("VerticalScrollingHelper.adjustFirstVisibleRowToScrollPosition:"+" Set \"firstVisibleRow\" from "+O+" to "+N,t);var r=t._setFirstVisibleRowIndex(N,true,i,s);if(!r){if(b){k.adjustFirstVisibleRowToScrollPositionInBuffer(t,true,s);}return Promise.resolve();}return new Promise(function(u){var v=function(w){d("VerticalScrollingHelper.adjustFirstVisibleRowToScrollPosition (async: rows updated):"+" Reason "+w.getParameters().reason,this);if(b){k.adjustFirstVisibleRowToScrollPositionInBuffer(t,true);}u();return false;};k.addOnRowsUpdatedPreprocessor(t,v);if(p){p.addCancelListener(function(){var R=k.removeOnRowsUpdatedPreprocessor(t,v);if(R){u();}});}});},adjustFirstVisibleRowToScrollPositionInBuffer:function(t,F,s,p){if(p&&p.isCancelled()){return Promise.resolve();}F=F===true;s=s===true;var a=h(t).oVerticalScrollPosition;var i=a.getIndex();if(!k.isIndexInBuffer(t,i)){d("VerticalScrollingHelper.adjustFirstVisibleRowToScrollPositionInBuffer:"+" Aborted - Scroll position is not in buffer",t);return Promise.resolve();}var N=i;var v=k.getScrollRangeOfViewport(t);var b=t._getMaxFirstRenderedRowIndex();var r=t._aRowHeights;var R;d("VerticalScrollingHelper.adjustFirstVisibleRowToScrollPositionInBuffer");if(a.getOffsetType()===f.OffsetType.PercentageOfBuffer){var u=v*a.getOffset();N=b;for(R=0;R<r.length;R++){var w=u-r[R];if(w>=0){u=w;N++;}else{break;}}}else{var x=Math.max(0,Math.min(r.length-1,i-b));var y=0;for(R=0;R<x;R++){y+=r[R];if(y>v){N=b+R;break;}}}if(F){t.setProperty("firstVisibleRow",-1,true);}if(i!==N||F){d("VerticalScrollingHelper.adjustFirstVisibleRowToScrollPositionInBuffer:"+" Set \"firstVisibleRow\" to "+N,t);t._setFirstVisibleRowIndex(N,true,null,s);}return Promise.resolve();},adjustScrollPositionToFirstVisibleRow:function(t,p){if(p&&p.isCancelled()){return Promise.resolve();}d("VerticalScrollingHelper.adjustScrollPositionToFirstVisibleRow",t);h(t).oVerticalScrollPosition.setPosition(t.getFirstVisibleRow());return Promise.resolve();},adjustScrollPositionToScrollbar:function(t,p){if(p&&p.isCancelled()){return Promise.resolve();}var s=h(t).oVerticalScrollPosition;var a=k.getScrollPositionOfScrollbar(t);var i=k.getScrollRange(t);var b=k.getScrollRangeRowFraction(t);var N=0;var r=0;var u=f.OffsetType.Percentage;var v;d("VerticalScrollingHelper.adjustScrollPositionToScrollbar",t);if(T.isVariableRowHeightEnabled(t)){if(k.isScrollPositionOfScrollbarInBuffer(t)){var B=k.getScrollRangeBuffer(t);var w=i-B;var x=a-w;var y=x/B;N=t._getMaxFirstRenderedRowIndex();if(k.isIndexInBuffer(t,s.getIndex())){var z=k.getScrollRangeOfViewport(t);var A=z*y;var R=t._aRowHeights;for(var C=0;C<R.length;C++){var F=A-R[C];if(F>=0){A=F;N++;}else{r=Math.round(A);u=f.OffsetType.Pixel;break;}}}else{r=y;u=f.OffsetType.PercentageOfBuffer;}}else{v=a/b;N=Math.floor(v);r=v-N;}}else{var G=i-a;var J=G<1;if(J){N=t._getMaxFirstVisibleRowIndex();r=0;u=f.OffsetType.Pixel;}else{v=a/b;N=Math.floor(v);r=v-N;}}s.setPosition(N,r,u);return Promise.resolve();},adjustScrollPositionToViewport:function(t,p){if(p&&p.isCancelled()){return Promise.resolve();}var s=h(t).oVerticalScrollPosition;var r=t._aRowHeights;var N=t._iRenderedFirstVisibleRow;var i=0;var a=k.getScrollPositionOfViewport(t);d("VerticalScrollingHelper.adjustScrollPositionToViewport",t);for(var R=0;R<r.length;R++){var b=a-r[R];if(b>=0){a=b;N++;}else{i=Math.round(a);break;}}s.setPosition(N,i);return Promise.resolve();},scrollViewport:function(t,p){if(p&&p.isCancelled()){return Promise.resolve();}var s=h(t).oVerticalScrollPosition;var v=t.getDomRef("tableCCnt");var i=k.getScrollRangeOfViewport(t);var r=t._aRowHeights;if(!T.isVariableRowHeightEnabled(t)||!v){d("VerticalScrollingHelper.scrollViewport: Aborted - Guard clause not passed",t);return Promise.resolve();}if(t._getFirstRenderedRowIndex()!==t._iRenderedFirstVisibleRow){d("VerticalScrollingHelper.scrollViewport: Aborted - Rows will be updated",t);return Promise.resolve();}if(i===0){d("VerticalScrollingHelper.scrollViewport: No overflow in viewport - Scroll to 0",t);t._setFirstVisibleRowIndex(0,true);s.setPosition(0);v.scrollTop=0;return Promise.resolve();}var a=s.getIndex();var b=t._getMaxFirstRenderedRowIndex();var u=0;var w=0;var R;d("VerticalScrollingHelper.scrollViewport");switch(s.getOffsetType()){case f.OffsetType.Pixel:case f.OffsetType.Percentage:if(k.isIndexInBuffer(t,a)){var x=0;w=Math.max(0,Math.min(r.length-1,a-b));for(R=0;R<w;R++){x+=r[R];if(x>i){s.setPosition(b+R,i-u);w=R;break;}else{u=x;}}}if(s.isOffsetInPixel()){s.setOffset(Math.min(s.getOffset(),r[w]));}else{s.setOffset(r[w]*s.getOffset());}u+=s.getOffset();if(u>i){s.setOffset(s.getOffset()-(u-i));u=i;}break;case f.OffsetType.PercentageOfBuffer:if(!k.isIndexInBuffer(t,a)){s.setOffset(0);break;}var y=i*s.getOffset();u=Math.round(y);for(R=0;R<r.length;R++){var z=y-r[R];if(z>=0){y=z;w++;}else{s.setPosition(b+w,Math.round(y));break;}}break;default:}d("VerticalScrollingHelper.scrollViewport: Scroll from "+v.scrollTop+" to "+u,t);v.scrollTop=u;v._scrollTop=v.scrollTop;return Promise.resolve();},scrollScrollbar:function(t,p){if(p&&p.isCancelled()){return Promise.resolve();}var _=h(t);var s=_.oVerticalScrollPosition;var i=s.getIndex();var b=k.getScrollRangeBuffer(t);var a=k.getScrollRange(t);var r=a-b;var u=0;var v=0;var w=k.getScrollRangeOfViewport(t);var R=t._aRowHeights;var x;d("VerticalScrollingHelper.scrollScrollbar",t);if(a===0||R.length===0){d("VerticalScrollingHelper.scrollScrollbar: No scrollable content",t);return Promise.resolve();}switch(s.getOffsetType()){case f.OffsetType.Pixel:case f.OffsetType.Percentage:if(k.isIndexInBuffer(t,i)){var y=0;x=Math.max(0,Math.min(R.length-1,i-t._getMaxFirstRenderedRowIndex()));for(var z=0;z<x;z++){y+=R[z];}if(s.isOffsetInPixel()){y+=Math.min(R[x],s.getOffset());}else{y+=R[x]*s.getOffset();}var A=Math.min(y/w,1);var B=b*A;u=r+B;}else{var C=k.getScrollRangeRowFraction(t);u=i*C;if(s.isOffsetInPixel()){x=Math.max(0,Math.min(R.length-1,i-t._iRenderedFirstVisibleRow));u+=C*Math.min(s.getOffset()/R[x],1);}else{u+=C*s.getOffset();}}break;case f.OffsetType.PercentageOfBuffer:if(k.isIndexInBuffer(t,i)){u=r+Math.round(w*s.getOffset());}break;default:}if(u>0&&u<0.5){v=1;}else if(u>=a-0.5&&u<a){v=a-1;}else{v=Math.round(u);}window.cancelAnimationFrame(_.mAnimationFrames.verticalScrollbarUpdate);delete _.mAnimationFrames.verticalScrollbarUpdate;return new Promise(function(F){_.mAnimationFrames.verticalScrollbarUpdate=window.requestAnimationFrame(function(){var G=t._getScrollExtension().getVerticalScrollbar();delete _.mAnimationFrames.verticalScrollbarUpdate;if(G){d("VerticalScrollingHelper.scrollScrollbar (async): Scroll from "+G.scrollTop+" to "+v,t);G.scrollTop=v;G._scrollTop=G.scrollTop;}else{d("VerticalScrollingHelper.scrollScrollbar (async): Not scrolled - No scrollbar available",t);}F();});if(p){p.addCancelListener(function(){if(_.mAnimationFrames.verticalScrollbarUpdate!=null){window.cancelAnimationFrame(_.mAnimationFrames.verticalScrollbarUpdate);delete _.mAnimationFrames.verticalScrollbarUpdate;F();}});}});},getScrollRange:function(t){var s=t._getScrollExtension();var v=s.getVerticalScrollHeight()-s.getVerticalScrollbarHeight();return Math.max(0,v);},getScrollRangeBuffer:function(t){if(!T.isVariableRowHeightEnabled(t)){return 0;}return V*t._getBaseRowHeight();},getScrollPositionOfScrollbar:function(t){var s=t._getScrollExtension();if(s.isVerticalScrollbarVisible()){return s.getVerticalScrollbar().scrollTop;}else{return 0;}},getScrollPositionOfViewport:function(t){var v=t?t.getDomRef("tableCCnt"):null;return v?v.scrollTop:0;},getScrollRangeRowFraction:function(t){var s=t._getScrollExtension();var v=t._getTotalRowCount()-t._getRowCounts().count;var i;if(T.isVariableRowHeightEnabled(t)){i=k.getScrollRange(t)-k.getScrollRangeBuffer(t);var b=s.getVerticalScrollHeight()===M;if(!b){i+=t._getBaseRowHeight();}}else{i=k.getScrollRange(t);}return i/Math.max(1,v);},isScrollPositionOfScrollbarInBuffer:function(t){if(!T.isVariableRowHeightEnabled(t)){return false;}var s=k.getScrollRange(t);var a=k.getScrollPositionOfScrollbar(t);var i=k.getScrollRangeBuffer(t);return s-a<=i;},isIndexInBuffer:function(t,i){if(!T.isVariableRowHeightEnabled(t)){return false;}return i>=t._getMaxFirstRenderedRowIndex();},getScrollRangeOfViewport:function(t){if(!t||!t._aRowHeights){return 0;}var r=t._aRowHeights;var v=t._getBaseRowHeight()*t._getRowCounts().count;if(t._getRowCounts().count>=t._getTotalRowCount()){r=r.slice(0,t._getTotalRowCount());}var i=r.reduce(function(a,b){return a+b;},0)-v;if(i>0){i=Math.ceil(i);}return Math.max(0,i);},onScrollbarMouseDown:function(a){h(this).bIsScrolledVerticallyByWheel=false;h(this).bIsScrolledVerticallyByKeyboard=false;},addOnRowsUpdatedPreprocessor:function(t,p){h(t).aOnRowsUpdatedPreprocessors.push(p);},removeOnRowsUpdatedPreprocessor:function(t,p){if(!p){h(t).aOnRowsUpdatedPreprocessors=[];return false;}var i=h(t).aOnRowsUpdatedPreprocessors.indexOf(p);if(i>-1){h(t).aOnRowsUpdatedPreprocessors.splice(i,1);return true;}return false;},onRowsUpdated:function(a){d("VerticalScrollingHelper.onRowsUpdated: Reason "+a.getParameters().reason,this);if(h(this).aOnRowsUpdatedPreprocessors.length>0){d("VerticalScrollingHelper.onRowsUpdated (preprocessors)",this);var b=h(this).aOnRowsUpdatedPreprocessors.reduce(function(b,p){var _=p.call(this,a);return!(b&&!_);},true);k.removeOnRowsUpdatedPreprocessor(this);if(!b){d("VerticalScrollingHelper.onRowsUpdated (preprocessors): Default prevented",this);return;}}if(!T.isVariableRowHeightEnabled(this)){d("VerticalScrollingHelper.onRowsUpdated: Aborted - Variable row heights not enabled",this);return;}j.start(this,j.OnRowsUpdated,function(r,i,p){k.scrollViewport(this,p).then(function(){return Promise.all([k.adjustFirstVisibleRowToScrollPosition(this,true,p),k.scrollScrollbar(this,p)]);}.bind(this)).then(r);}.bind(this));},restoreScrollPosition:function(t,b){d("VerticalScrollingHelper.restoreScrollPosition",t);var p=j.start(t,j.RestoreScrollPosition,function(r,a,i){if(b!==true){r(i);return;}var O=function(){d("VerticalScrollingHelper.restoreScrollPosition (async: rows updated)",t);r(i);return false;};k.addOnRowsUpdatedPreprocessor(t,O);i.addCancelListener(function(){var R=k.removeOnRowsUpdatedPreprocessor(t,O);if(R){r(i);}});});if(p){p.then(function(a){if(!a.isCancelled()){k._restoreScrollPosition(t);}});}},_restoreScrollPosition:function(t){var s=h(t).oVerticalScrollPosition;var b=s.isInitial();d("VerticalScrollingHelper.restoreScrollPosition: "+"Scroll position is"+(b?" ":" not ")+"initial",t);if(b){k.performUpdateFromFirstVisibleRow(t);}else{k.performUpdateFromScrollPosition(t);}},adjustToTotalRowCount:function(t){d("VerticalScrollingHelper.adjustToTotalRowCount",t);var s=t._getScrollExtension();s.updateVerticalScrollbarVisibility();s.updateVerticalScrollHeight();var p=j.start(t,j.AdjustToTotalRowCount,function(r,a,b){if(h(t).oVerticalScrollPosition.isInitial()){r(b);}else{var O=function(){d("VerticalScrollingHelper.adjustToTotalRowCount (async: rows updated)",t);r(b);return false;};k.addOnRowsUpdatedPreprocessor(t,O);b.addCancelListener(function(){var R=k.removeOnRowsUpdatedPreprocessor(t,O);if(R){r(b);}});}});if(p){p.then(function(a){if(a.isCancelled()||h(t).oVerticalScrollPosition.isInitial()){return;}k.scrollViewport(t);k.performUpdateFromScrollPosition(t);});}},addEventListeners:function(t){var s=t._getScrollExtension();var a=k.getScrollAreas(t);var v=s.getVerticalScrollbar();var b=t.getDomRef("tableCCnt");if(!s._onVerticalScrollEventHandler){s._onVerticalScrollEventHandler=k.onScrollbarScroll.bind(t);}for(var i=0;i<a.length;i++){a[i].addEventListener("scroll",s._onVerticalScrollEventHandler);}if(v){if(!s._onVerticalScrollbarMouseDownEventHandler){s._onVerticalScrollbarMouseDownEventHandler=k.onScrollbarMouseDown.bind(t);}v.addEventListener("mousedown",s._onVerticalScrollbarMouseDownEventHandler);}if(b){if(!s._onViewportScrollEventHandler){s._onViewportScrollEventHandler=k.onViewportScroll.bind(t);}b.addEventListener("scroll",s._onViewportScrollEventHandler);}t.attachEvent("_rowsUpdated",k.onRowsUpdated);},removeEventListeners:function(t){var s=t._getScrollExtension();var a=k.getScrollAreas(t);var v=s.getVerticalScrollbar();var b=t.getDomRef("tableCCnt");if(s._onVerticalScrollEventHandler){for(var i=0;i<a.length;i++){a[i].removeEventListener("scroll",s._onVerticalScrollEventHandler);}delete s._onVerticalScrollEventHandler;}if(v&&s._onVerticalScrollbarMouseDownEventHandler){v.removeEventListener("mousedown",s._onVerticalScrollbarMouseDownEventHandler);delete s._onVerticalScrollbarMouseDownEventHandler;}if(b&&s._onViewportScrollEventHandler){b.removeEventListener("scroll",s._onViewportScrollEventHandler);delete s._onViewportScrollEventHandler;}t.detachEvent("_rowsUpdated",k.onRowsUpdated);},getScrollAreas:function(t){var s=[t._getScrollExtension().getVerticalScrollbar()];return s.filter(function(a){return a!=null;});}};var m={onMouseWheelScrolling:function(O,a){var s=this._getScrollExtension();var v=Math.abs(a.deltaY)>Math.abs(a.deltaX);var i=v?a.deltaY:a.deltaX;var b=v&&a.shiftKey||!v;var p=i>0;var r=false;if(i===0){return;}if(b&&(O.scrollDirection===c.HORIZONAL||O.scrollDirection===c.BOTH)){var t=s.getHorizontalScrollbar();if(a.deltaMode!==window.WheelEvent.DOM_DELTA_PIXEL){var u=T.Column.getMinColumnWidth();i=p?u:-u;}if(p){r=t.scrollLeft===t.scrollWidth-t.offsetWidth;}else{r=t.scrollLeft===0;}if(s.isHorizontalScrollbarVisible()&&!r){a.preventDefault();a.stopPropagation();this._getKeyboardExtension().setActionMode(false);t.scrollLeft=t.scrollLeft+i;}}else if(!b&&(O.scrollDirection===c.VERTICAL||O.scrollDirection===c.BOTH)){var w=s.getVerticalScrollbar();var x=h(this).oVerticalScrollPosition;if(p){r=w.scrollTop===w.scrollHeight-w.offsetHeight;}else{r=w.scrollTop===0;}if(!s.isVerticalScrollbarVisible()||r){return;}a.preventDefault();a.stopPropagation();if(a.deltaMode===window.WheelEvent.DOM_DELTA_PIXEL){var y=i/this._getDefaultRowHeight();if(y>=0){x.scrollRows(Math.max(1,Math.floor(y)));}else{x.scrollRows(Math.min(-1,Math.ceil(y)));}}else if(a.deltaMode===window.WheelEvent.DOM_DELTA_LINE){x.scrollRows(i);}else if(a.deltaMode===window.WheelEvent.DOM_DELTA_PAGE){x.scrollRows(i*this._getRowCounts().count);}h(this).bIsScrolledVerticallyByWheel=true;h(this).bIsScrolledVerticallyByKeyboard=false;this._getKeyboardExtension().setActionMode(false);k.performUpdateFromScrollPosition(this);}},onTouchStart:function(O,a){if(a.type==="touchstart"||a.pointerType==="touch"){var s=this._getScrollExtension();var b=s.getHorizontalScrollbar();var v=s.getVerticalScrollbar();var t=a.touches?a.touches[0]:a;h(this).mTouchSessionData={initialPageX:t.pageX,initialPageY:t.pageY,initialScrollTop:v?v.scrollTop:0,initialScrollLeft:b?b.scrollLeft:0,initialScrolledToEnd:null,touchMoveDirection:null};}},onTouchMoveScrolling:function(O,a){if(a.type!=="touchmove"&&a.pointerType!=="touch"){return;}var s=this._getScrollExtension();var t=h(this).mTouchSessionData;if(!t){return;}var b=a.touches?a.touches[0]:a;var i=(b.pageX-t.initialPageX);var p=(b.pageY-t.initialPageY);var r=false;if(!t.touchMoveDirection){if(i===0&&p===0){return;}t.touchMoveDirection=Math.abs(i)>Math.abs(p)?"horizontal":"vertical";}switch(t.touchMoveDirection){case"horizontal":var u=s.getHorizontalScrollbar();if(u&&(O.scrollDirection===c.HORIZONAL||O.scrollDirection===c.BOTH)){this._getKeyboardExtension().setActionMode(false);if(t.initialScrolledToEnd==null){if(i<0){t.initialScrolledToEnd=u.scrollLeft===u.scrollWidth-u.offsetWidth;}else{t.initialScrolledToEnd=u.scrollLeft===0;}}if(!t.initialScrolledToEnd){u.scrollLeft=t.initialScrollLeft-i;r=true;}}break;case"vertical":var v=s.getVerticalScrollbar();if(v&&(O.scrollDirection===c.VERTICAL||O.scrollDirection===c.BOTH)){this._getKeyboardExtension().setActionMode(false);if(t.initialScrolledToEnd==null){if(p<0){t.initialScrolledToEnd=v.scrollTop===v.scrollHeight-v.offsetHeight;}else{t.initialScrolledToEnd=v.scrollTop===0;}}if(!t.initialScrolledToEnd){v.scrollTop=t.initialScrollTop-p;r=true;}}break;default:}if(r){a.preventDefault();}},addEventListeners:function(t){var s=t._getScrollExtension();var a=m.getEventListenerTargets(t);s._mMouseWheelEventListener=this.addMouseWheelEventListener(a,t,{scrollDirection:c.BOTH});s._mTouchEventListener=this.addTouchEventListener(a,t,{scrollDirection:c.BOTH});},addMouseWheelEventListener:function(a,t,O){var b=m.onMouseWheelScrolling.bind(t,O);for(var i=0;i<a.length;i++){a[i].addEventListener("wheel",b);}return{wheel:b};},addTouchEventListener:function(a,t,O){var b=m.onTouchStart.bind(t,O);var p=m.onTouchMoveScrolling.bind(t,O);var r={};for(var i=0;i<a.length;i++){if(D.support.pointer&&D.system.desktop){a[i].addEventListener("pointerdown",b);a[i].addEventListener("pointermove",p,D.browser.chrome?{passive:true}:false);}else if(D.support.touch){a[i].addEventListener("touchstart",b);a[i].addEventListener("touchmove",p);}}if(D.support.pointer&&D.system.desktop){r={pointerdown:b,pointermove:p};}else if(D.support.touch){r={touchstart:b,touchmove:p};}return r;},removeEventListeners:function(t){var s=t._getScrollExtension();var a=m.getEventListenerTargets(t);function r(b,p){for(var u in p){var v=p[u];if(v){b.removeEventListener(u,v);}}}for(var i=0;i<a.length;i++){r(a[i],s._mMouseWheelEventListener);r(a[i],s._mTouchEventListener);}delete s._mMouseWheelEventListener;delete s._mTouchEventListener;},getEventListenerTargets:function(t){var a=[t.getDomRef("tableCCnt")];return a.filter(function(b){return b!=null;});}};var n={onBeforeRendering:function(a){this._getScrollExtension()._clearCache();},onAfterRendering:function(a){var s=this._getScrollExtension();var r=a!=null&&a.isMarked("renderRows");if(r){s.updateVerticalScrollbarHeight();s.updateVerticalScrollHeight();}else{k.restoreScrollPosition(this,true);}H.restoreScrollPosition(this);},onfocusin:function(a){var r;var C=T.getCellInfo(a.target);var b=this._getScrollExtension().getHorizontalScrollbar();if(C.isOfType(T.CELLTYPE.DATACELL)){r=this.getDomRef("sapUiTableCtrlScr");}else if(C.isOfType(T.CELLTYPE.COLUMNHEADER)){r=this.getDomRef("sapUiTableColHdrScr");}if(r&&b&&C.columnIndex>=this.getComputedFixedColumnCount()){var $=q(b);var i=C.cell[0];var p=this._bRtlMode?$.scrollLeftRTL():b.scrollLeft;var R=r.clientWidth;var s=i.offsetLeft;var t=s+i.offsetWidth;var O=s-p;var u=t-R-p;var N;if(O<0&&u<0){N=p+O;}else if(u>0&&O>0){N=p+u;}if(N!=null){if(this._bRtlMode){$.scrollLeftRTL(N);}else{b.scrollLeft=N;}}}var v=T.getParentCell(this,a.target);if(v){var w=this;var x=function(){var y=v.find(".sapUiTableCellInner");if(y.length>0){if(w._bRtlMode){y.scrollLeftRTL(y[0].scrollWidth-y[0].clientWidth);}else{y[0].scrollLeft=0;}y[0].scrollTop=0;}};Promise.resolve().then(function(){if(D.browser.safari){window.setTimeout(x,0);}else{x();}});}}};var o=E.extend("sap.ui.table.extensions.Scrolling",{_init:function(t,s,a){this._delegate=n;T.addDelegate(t,this._delegate,t);return"ScrollExtension";},_attachEvents:function(){var t=this.getTable();H.addEventListeners(t);k.addEventListeners(t);m.addEventListeners(t);},_detachEvents:function(){var t=this.getTable();H.removeEventListeners(t);k.removeEventListeners(t);m.removeEventListeners(t);},destroy:function(){var t=this.getTable();T.removeDelegate(t,this._delegate);this._delegate=null;this._clearCache();if(h(t).pVerticalScrollUpdateProcess){h(t).pVerticalScrollUpdateProcess.cancel();h(t).pVerticalScrollUpdateProcess=null;}h.destroy(t);E.prototype.destroy.apply(this,arguments);}});o.prototype.scrollVertically=function(b,p,i,a,B){var t=this.getTable();if(!t){return false;}b=b===true;p=p===true;i=i===true;a=a===true;var s=false;var r=t._getTotalRowCount();var R=t._getRowCounts();var F=t.getFirstVisibleRow();var u=p?R.scrollable:1;if(b){if(F+R.count<r){if(B){B();}if(a){setTimeout(function(){t.setFirstVisibleRow(Math.min(F+u,r-R.count));},0);}else{t.setFirstVisibleRow(Math.min(F+u,r-R.count));}s=true;}}else if(F>0){if(B){B();}if(a){setTimeout(function(){t.setFirstVisibleRow(Math.max(F-u,0));},0);}else{t.setFirstVisibleRow(Math.max(F-u,0));}s=true;}if(s&&i){h(t).bIsScrolledVerticallyByKeyboard=true;}return s;};o.prototype.scrollVerticallyMax=function(b,i){var t=this.getTable();if(!t){return false;}if(b==null){b=false;}if(i==null){i=false;}var s=false;var F=t.getFirstVisibleRow();if(b){var a=t._getTotalRowCount()-T.getNonEmptyVisibleRowCount(t);if(F<a){t.setFirstVisibleRow(a);s=true;}}else if(F>0){t.setFirstVisibleRow(0);s=true;}if(s&&i){h(t).bIsScrolledVerticallyByKeyboard=true;}return s;};o.prototype.getHorizontalScrollbar=function(){var t=this.getTable();if(t&&!t._bInvalid&&!h(t).oHorizontalScrollbar){h(t).oHorizontalScrollbar=t.getDomRef(S.HorizontalScrollBar);}return h(t).oHorizontalScrollbar||null;};o.prototype.getVerticalScrollbar=function(i){var t=this.getTable();var b=this.isVerticalScrollbarExternal();if(t&&!t._bInvalid&&!h(t).oVerticalScrollbar){h(t).oVerticalScrollbar=t.getDomRef(S.VerticalScrollBar);if(!h(t).oVerticalScrollbar&&b){h(t).oVerticalScrollbar=h(t).oExternalVerticalScrollbar;}}var s=h(t).oVerticalScrollbar;if(s&&!b&&!i&&!e(s)){return null;}return s||null;};o.prototype.isHorizontalScrollbarVisible=function(){var a=this.getHorizontalScrollbar();return a!=null&&!a.classList.contains("sapUiTableHidden");};o.prototype.isVerticalScrollbarVisible=function(){var v=this.getVerticalScrollbar();return v!=null&&!v.classList.contains("sapUiTableHidden");};o.prototype.isVerticalScrollbarExternal=function(){return h(this.getTable()).bIsVerticalScrollbarExternal;};o.prototype.markVerticalScrollbarAsExternal=function(s){if(s){h(this.getTable()).bIsVerticalScrollbarExternal=true;h(this.getTable()).oExternalVerticalScrollbar=s;}};o.prototype.updateHorizontalScrollbar=function(t){var a=this.getTable();var b=this.getHorizontalScrollbar();if(!a||!b||!t){return;}var $=a.$();var C=t.tableCtrlScrollWidth;if(D.browser.safari){C=Math.max(C,a._getColumnsWidth(a.getComputedFixedColumnCount()));}var i=C>t.tableCtrlScrWidth;if(i){if(!this.isHorizontalScrollbarVisible()){$.addClass("sapUiTableHScr");b.classList.remove("sapUiTableHidden");if(D.browser.safari){var p=$.find(".sapUiTableCtrlScroll, .sapUiTableColHdrScr > .sapUiTableColHdr");p.outerWidth(C);}}var s=t.tableCtrlFixedWidth;if($.find(".sapUiTableRowHdrScr").length>0){s+=t.tableRowHdrScrWidth;}if(a._bRtlMode){b.style.marginRight=s+"px";b.style.marginLeft="";}else{b.style.marginLeft=s+"px";b.style.marginRight="";}var r=a.getDomRef("hsb-content");if(r){r.style.width=C+"px";}}if(!i&&this.isHorizontalScrollbarVisible()){$.removeClass("sapUiTableHScr");b.classList.add("sapUiTableHidden");if(D.browser.safari){$.find(".sapUiTableCtrlScroll, .sapUiTableColHdr").css("width","");}}};o.prototype.updateVerticalScrollbarHeight=function(){var t=this.getTable();var v=this.getVerticalScrollbar();if(!t||!v){return;}v.style.maxHeight=this.getVerticalScrollbarHeight()+"px";v._scrollTop=v.scrollTop;};o.prototype.getVerticalScrollbarHeight=function(){var t=this.getTable();if(!t){return 0;}return t._getRowCounts().scrollable*t._getBaseRowHeight();};o.prototype.updateVerticalScrollbarPosition=function(){var t=this.getTable();var v=this.getVerticalScrollbar();if(!t||!v){return;}var a=t.getDomRef("tableCCnt");if(a){var i=a.offsetTop;var b=t.getDomRef("vsb-bg");if(b){b.style.top=i+"px";}if(t._getRowCounts().fixedTop>0){i+=t._iVsbTop;}v.style.top=i+"px";}};o.prototype.updateVerticalScrollPosition=function(b){var t=this.getTable();if(!t){return;}k.performUpdateFromFirstVisibleRow(t,b);};o.prototype.adjustToTotalRowCount=function(){k.adjustToTotalRowCount(this.getTable());};o.prototype.restoreVerticalScrollPosition=function(){k.restoreScrollPosition(this.getTable());};o.prototype.updateVerticalScrollHeight=function(){var v=this.getVerticalScrollbar();var a=v?v.firstChild:null;if(!a){return;}a.style.height=this.getVerticalScrollHeight()+"px";v._scrollTop=v.scrollTop;};o.prototype.getVerticalScrollHeight=function(b){var t=this.getTable();if(!t){return 0;}var i=t._getTotalRowCount();var v=t._getRowCounts().count;var B=t._getBaseRowHeight();var r;var s;if(T.isVariableRowHeightEnabled(t)){r=Math.max(i,v+1);s=B*(r-1)+k.getScrollRangeBuffer(t);}else{r=Math.max(i,v);s=B*r;}if(b===true){return s;}else{return Math.min(M,s);}};o.prototype.updateVerticalScrollbarVisibility=function(){var t=this.getTable();var a=t?t.getDomRef():null;var v=this.getVerticalScrollbar();if(!a||!v){return;}var b=this.isVerticalScrollbarRequired();if(b&&!this.isVerticalScrollbarVisible()){if(!this.isVerticalScrollbarExternal()){a.classList.add("sapUiTableVScr");}v.classList.remove("sapUiTableHidden");}if(!b&&this.isVerticalScrollbarVisible()){a.classList.remove("sapUiTableVScr");v.classList.add("sapUiTableHidden");}};o.prototype.isVerticalScrollbarRequired=function(){var t=this.getTable();if(!t){return false;}return T.isVariableRowHeightEnabled(t)&&k.getScrollRangeOfViewport(t)>0||t._getTotalRowCount()>t._getRowCounts().count;};o.prototype.registerForMouseWheel=function(a,O){var t=this.getTable();if(E.isEnrichedWith(t,"sap.ui.table.extensions.Synchronization")){return m.addMouseWheelEventListener(a,t,O);}else{L.error("This method can only be used with synchronization enabled.",t,"sap.ui.table.extensions.Scrolling#registerForMouseWheel");return null;}};o.prototype.registerForTouch=function(a,O){var t=this.getTable();if(E.isEnrichedWith(t,"sap.ui.table.extensions.Synchronization")){return m.addTouchEventListener(a,t,O);}else{L.error("This method can only be used with synchronization enabled.",t,"sap.ui.table.extensions.Scrolling#registerForTouch");return null;}};o.prototype._clearCache=function(){h(this.getTable()).oVerticalScrollbar=null;h(this.getTable()).oHorizontalScrollbar=null;};o.ScrollDirection=c;return o;});
