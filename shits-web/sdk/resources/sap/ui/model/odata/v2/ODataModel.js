/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['sap/ui/core/library','sap/ui/thirdparty/URI','sap/ui/model/BindingMode','sap/ui/model/Context','sap/ui/model/Model','sap/ui/model/odata/v2/ODataAnnotations','sap/ui/model/odata/ODataUtils','sap/ui/model/odata/CountMode','sap/ui/model/odata/UpdateMethod','sap/ui/model/odata/OperationMode','sap/ui/model/odata/MessageScope','./ODataContextBinding','./ODataListBinding','sap/ui/model/odata/ODataMetadata','sap/ui/model/odata/ODataPropertyBinding','./ODataTreeBinding','sap/ui/model/FilterProcessor','sap/ui/model/odata/ODataMetaModel','sap/ui/core/message/MessageParser','sap/ui/model/odata/ODataMessageParser','sap/ui/thirdparty/datajs',"sap/base/Log","sap/base/assert","sap/base/util/uid","sap/base/util/UriParameters","sap/base/util/deepEqual","sap/base/util/merge","sap/base/security/encodeURL","sap/ui/thirdparty/jquery","sap/base/util/isPlainObject","sap/base/util/each","sap/base/util/isEmptyObject"],function(c,U,B,C,M,O,a,b,d,e,f,g,h,l,m,o,F,p,q,r,s,L,t,u,v,w,x,y,Q,z,A,D){"use strict";var E=c.MessageType,G={};G[E.Error]=0;G[E.Warning]=1;G[E.Success]=2;G[E.Information]=3;G[E.None]=4;var H=M.extend("sap.ui.model.odata.v2.ODataModel",{constructor:function(S,P){M.apply(this,arguments);var i,j,k,T,W,n,J,R,K,N,V,X,Y,Z,$,_,a1,b1,c1,d1,e1,f1,g1,h1,i1,j1,k1,l1,m1=this;if(typeof(S)==="object"){P=S;S=P.serviceUrl;}if(P){i=P.user;j=P.password;k=P.headers;T=P.tokenHandling;W=P.withCredentials;n=P.maxDataServiceVersion;J=P.useBatch;R=P.refreshAfterChange;K=P.annotationURI;N=P.loadAnnotationsJoined;Y=P.defaultBindingMode;V=P.defaultCountMode;X=P.preliminaryContext;Z=P.defaultOperationMode;$=P.metadataNamespaces;_=P.serviceUrlParams;a1=P.metadataUrlParams;b1=P.json;c1=P.messageParser;d1=P.skipMetadataAnnotationParsing;e1=P.defaultUpdateMethod;f1=P.disableHeadRequestForToken;g1=P.sequentializeRequests;h1=P.disableSoftStateHeader;i1=P.bindableResponseHeaders;j1=P.warmupUrl;k1=P.canonicalRequests;l1=P.tokenHandlingForGet;}this.mPathCache={};this.mInvalidatedPaths={};this.bCanonicalRequests=!!k1;this.bTokenHandlingForGet=!!l1;this.sMessageScope=f.RequestedObjects;this.sWarmupUrl=j1;this.bWarmup=!!j1;this.mSupportedBindingModes={"OneWay":true,"OneTime":true,"TwoWay":true};this.mUnsupportedFilterOperators={"Any":true,"All":true};this.sDefaultBindingMode=Y||B.OneWay;this.bIsMessageScopeSupported=false;this.iPendingDeferredRequests=0;this.bJSON=b1!==false;this.aPendingRequestHandles=[];this.aCallAfterUpdate=[];this.mRequests={};this.mDeferredRequests={};this.mChangedEntities={};this.mChangeHandles={};this.mDeferredGroups={};this.mLaunderingState={};this.sDefaultUpdateMethod=e1||d.Merge;this.bTokenHandling=T!==false;this.bWithCredentials=W===true;this.bUseBatch=J!==false;this.bRefreshAfterChange=R!==false;this.sMaxDataServiceVersion=n;this.bLoadAnnotationsJoined=N!==false;this.sAnnotationURI=K;this.sDefaultCountMode=V||b.Request;this.sDefaultOperationMode=Z||e.Default;this.sMetadataLoadEvent=null;this.oMetadataFailedEvent=null;this.sRefreshGroupId=undefined;this.bIncludeInCurrentBatch=false;this.bSkipMetadataAnnotationParsing=!!d1;this.bDisableHeadRequestForToken=!!f1;this.bSequentializeRequests=!!g1;this.bDisableSoftStateHeader=!!h1;this.aBindableResponseHeaders=i1?i1:null;this.bPreliminaryContext=X||false;this.mMetadataUrlParams=a1||{};if(c1){c1.setProcessor(this);}this.oMessageParser=c1;this.sDefaultChangeGroup="changes";this.setDeferredGroups([this.sDefaultChangeGroup]);this.setChangeGroups({"*":{groupId:this.sDefaultChangeGroup}});this.oData={};this.oMetadata=null;this.oAnnotations=null;this.aUrlParams=[];this.pSequentialRequestCompleted=Promise.resolve();this.pReadyForRequest=Promise.resolve();this.sServiceUrl=S;var n1=S.split("?");if(n1.length>1){this.sServiceUrl=n1[0];if(n1[1]){this.aUrlParams.push(n1[1]);}}this.sServiceUrl=this.sServiceUrl.replace(/\/$/,"");this.sUser=i;this.sPassword=j;if(sap.ui.getCore().getConfiguration().getStatistics()){this.aUrlParams.push("sap-statistics=true");}this.oHeaders={};this.setHeaders(k);if(!this.bDisableSoftStateHeader){this.oHeaders["sap-contextid-accept"]="header";this.mCustomHeaders["sap-contextid-accept"]="header";}var o1=this._getServerUrl();var p1=this.sWarmupUrl||this._createMetadataUrl("/$metadata");this.oSharedServerData=H._getSharedData("server",o1);this.oSharedServiceData=H._getSharedData("service",this.sServiceUrl);this.oSharedMetaData=H._getSharedData("meta",p1);this.bUseCache=this._cacheSupported(p1);if(!this.oSharedMetaData.oMetadata||this.oSharedMetaData.oMetadata.bFailed){this.oMetadata=new l(p1,{async:true,cacheKey:this.bUseCache?p1:undefined,user:this.sUser,password:this.sPassword,headers:this.mCustomHeaders,namespaces:$,withCredentials:this.bWithCredentials});if(!this.bWarmup){this.oSharedMetaData.oMetadata=this.oMetadata;}}else{this.oMetadata=this.oSharedMetaData.oMetadata;}this.oAnnotations=new O(this.oMetadata,{source:this.sAnnotationURI,skipMetadata:this.bSkipMetadataAnnotationParsing,headers:this.mCustomHeaders,combineEvents:true,cacheKey:this._getAnnotationCacheKey(p1),useCache:this.bUseCache});if(!this.bDisableSoftStateHeader){delete this.mCustomHeaders["sap-contextid-accept"];}this.oAnnotations.attachAllFailed(this.onAnnotationsFailed,this);this.oAnnotations.attachSomeLoaded(this.onAnnotationsLoaded,this);this.pAnnotationsLoaded=this.oAnnotations.loaded();if(_){this.aUrlParams=this.aUrlParams.concat(a._createUrlParamsArray(_));}this.onMetadataFailed=function(q1){m1.fireMetadataFailed(q1.getParameters());};if(!this.oMetadata.isLoaded()){this.oMetadata.attachFailed(this.onMetadataFailed);}this.oMetadata.loaded().then(function(){m1._initializeMetadata();});if(this.bJSON){if(this.sMaxDataServiceVersion==="3.0"){this.oHeaders["Accept"]="application/json;odata=fullmetadata";}else{this.oHeaders["Accept"]="application/json";}}else{this.oHeaders["Accept"]="application/atom+xml,application/atomsvc+xml,application/xml";}if(this.bTokenHandling){if(this.oSharedServiceData.securityToken){this.oHeaders["x-csrf-token"]=this.oSharedServiceData.securityToken;}else if(this.oSharedServerData.securityToken){this.oSharedServiceData.securityToken=this.oSharedServerData.securityToken;this.oHeaders["x-csrf-token"]=this.oSharedServiceData.securityToken;}}this.oHeaders["Accept-Language"]=sap.ui.getCore().getConfiguration().getLanguageTag();this.oHeaders["DataServiceVersion"]="2.0";this.oHeaders["MaxDataServiceVersion"]="2.0";if(this.sMaxDataServiceVersion){this.oHeaders["MaxDataServiceVersion"]=this.sMaxDataServiceVersion;}},metadata:{publicMethods:["read","create","update","remove","submitChanges","getServiceMetadata","metadataLoaded","hasPendingChanges","getPendingChanges","refresh","refreshMetadata","resetChanges","setDefaultCountMode","setDefaultBindingMode","getDefaultBindingMode","getDefaultCountMode","setProperty","getSecurityToken","refreshSecurityToken","setHeaders","getHeaders","setUseBatch","setDeferredBatchGroups","getDeferredBatchGroups","setChangeBatchGroups","getChangeBatchGroups"]}});H.M_EVENTS={MetadataLoaded:"metadataLoaded",MetadataFailed:"metadataFailed",AnnotationsLoaded:"annotationsLoaded",AnnotationsFailed:"annotationsFailed",BatchRequestFailed:"batchRequestFailed",BatchRequestSent:"batchRequestSent",BatchRequestCompleted:"batchRequestCompleted"};H.prototype.attachBatchRequestFailed=function(i,j,k){this.attachEvent("batchRequestFailed",i,j,k);return this;};H.prototype.detachBatchRequestFailed=function(i,j){this.detachEvent("batchRequestFailed",i,j);return this;};H.prototype.fireBatchRequestFailed=function(P){this.fireEvent("batchRequestFailed",P);return this;};H.prototype.attachBatchRequestSent=function(i,j,k){this.attachEvent("batchRequestSent",i,j,k);return this;};H.prototype.detachBatchRequestSent=function(i,j){this.detachEvent("batchRequestSent",i,j);return this;};H.prototype.fireBatchRequestSent=function(P){this.fireEvent("batchRequestSent",P);return this;};H.prototype.attachBatchRequestCompleted=function(i,j,k){this.attachEvent("batchRequestCompleted",i,j,k);return this;};H.prototype.detachBatchRequestCompleted=function(i,j){this.detachEvent("batchRequestCompleted",i,j);return this;};H.prototype.fireBatchRequestCompleted=function(P){this.fireEvent("batchRequestCompleted",P);return this;};H.mSharedData={server:{},service:{},meta:{}};H._getSharedData=function(S,k){var i=this.mSharedData[S][k];if(!i){i={};this.mSharedData[S][k]=i;}return i;};H.prototype._initializeMetadata=function(){if(this.bDestroyed){return;}this.bIsMessageScopeSupported=this.oMetadata._isMessageScopeSupported();var i=function(){this.fireMetadataLoaded({metadata:this.oMetadata});L.debug(this+" - metadataloaded fired");}.bind(this);this.initialize();if(this.bLoadAnnotationsJoined){this.oAnnotations.loaded().then(i,this.fireMetadataFailed.bind(this));}else{i();}};H.prototype.refreshMetadata=function(){if(this.oMetadata&&this.oMetadata.refresh){return this.oMetadata.refresh();}};H.prototype.fireAnnotationsLoaded=function(P){this.fireEvent("annotationsLoaded",P);return this;};H.prototype.attachAnnotationsLoaded=function(i,j,k){this.attachEvent("annotationsLoaded",i,j,k);return this;};H.prototype.detachAnnotationsLoaded=function(i,j){this.detachEvent("annotationsLoaded",i,j);return this;};H.prototype.fireAnnotationsFailed=function(P){this.fireEvent("annotationsFailed",P);L.debug(this+" - annotationsfailed fired");return this;};H.prototype.attachAnnotationsFailed=function(i,j,k){this.attachEvent("annotationsFailed",i,j,k);return this;};H.prototype.detachAnnotationsFailed=function(i,j){this.detachEvent("annotationsFailed",i,j);return this;};H.prototype.fireMetadataLoaded=function(P){this.fireEvent("metadataLoaded",P);return this;};H.prototype.attachMetadataLoaded=function(i,j,k){this.attachEvent("metadataLoaded",i,j,k);return this;};H.prototype.detachMetadataLoaded=function(i,j){this.detachEvent("metadataLoaded",i,j);return this;};H.prototype.fireMetadataFailed=function(P){this.fireEvent("metadataFailed",P);return this;};H.prototype.attachMetadataFailed=function(i,j,k){this.attachEvent("metadataFailed",i,j,k);return this;};H.prototype.detachMetadataFailed=function(i,j){this.detachEvent("metadataFailed",i,j);return this;};H.prototype._createEventInfo=function(R,k,n){var J={};J.url=R.requestUri;J.method=R.method;J.async=R.async;J.headers=R.headers;if(n){J.requests=[];for(var i=0;i<n.length;i++){var K={};if(Array.isArray(n[i])){var N=n[i];for(var j=0;j<N.length;j++){var R=N[j].request;var P=n[i][j].response;K={};K.url=R.requestUri;K.method=R.method;K.headers=R.headers;if(P){K.response={};if(R._aborted){K.success=false;K.response.statusCode=0;K.response.statusText="abort";}else{K.success=true;if(P.message){K.response.message=P.message;P=P.response;K.response.responseText=P.body;K.success=false;}K.response.headers=P.headers;K.response.statusCode=P.statusCode;K.response.statusText=P.statusText;}}J.requests.push(K);}}else{var R=n[i].request;var P=n[i].response;K.url=R.requestUri;K.method=R.method;K.headers=R.headers;if(P){K.response={};if(R._aborted){K.success=false;K.response.statusCode=0;K.response.statusText="abort";}else{K.success=true;if(P.message){K.response.message=P.message;P=P.response;K.response.responseText=P.body;K.success=false;}K.response.headers=P.headers;K.response.statusCode=P.statusCode;K.response.statusText=P.statusText;}}J.requests.push(K);}}}if(k){J.response={};J.success=true;if(k.message){J.response.message=k.message;J.success=false;}if(k.response){k=k.response;}if(k&&k.statusCode!=undefined){J.response.headers=k.headers;J.response.statusCode=k.statusCode;J.response.statusText=k.statusText;J.response.responseText=k.body!==undefined?k.body:k.responseText;}}J.ID=R.requestID;return J;};H.prototype._createRequestID=function(){var R;R=u();return R;};H.prototype._getServerUrl=function(){var S,i;S=new U(this.sServiceUrl).absoluteTo(document.baseURI);i=new U("/").absoluteTo(S).toString();return i;};H.prototype._createMetadataUrl=function(i){if(i.indexOf(this.sServiceUrl)==-1){if(!i.startsWith("/")){i="/"+i;}i=this.sServiceUrl+i;}var j=v.fromURL(i||window.location.href);var k=Object.assign({},this.mMetadataUrlParams);Array.from(j.keys()).forEach(function(K){k[K]=j.get(K);});var n=a._createUrlParamsArray(k);var J=i.split("?");if(J.length>1){i=J[0];}return this._addUrlParams(i,n);};H.prototype._addUrlParams=function(i,j){var k=[];if(this.aUrlParams){k=k.concat(this.aUrlParams);}if(j){k=k.concat(j);}if(k&&k.length>0){i+="?"+k.join("&");}return i;};H.prototype._createRequestUrl=function(P,i,j,k){return this._createRequestUrlWithNormalizedPath(this._normalizePath(P,i),j,k);};H.prototype._createRequestUrlWithNormalizedPath=function(n,i,j){var k="";if(!j){k=this.sServiceUrl+n;}else{k=n.substr(n.indexOf('/')+1);}return this._addUrlParams(k,i);};H.prototype._importData=function(j,k,R,P,n,K,J){var N=this,S,T,V,W;P=P||"";K=K||"";if(j.results&&Array.isArray(j.results)){S=[];A(j.results,function(i,b1){var K=N._getKey(b1);K=N._importData(b1,k,R,P.substr(0,P.lastIndexOf("/")),n,K);if(K){S.push(K);}});return S;}else{if(K){P="/"+K;n+=K.substr(K.indexOf("("));}else{K=this._getKey(j);}if(!K){return K;}V=this._getEntity(K);W=V;if(!V||(V.__metadata&&V.__metadata.invalid)){if(!W){W=j;}V=j;K=this._addEntity(V);}if(this.aBindableResponseHeaders){var X={};for(var Y in R.headers){var Z=Y.toLowerCase();if(this.aBindableResponseHeaders.indexOf(Z)>-1){X[Z]=R.headers[Y];}}if(!D(X)){if(!j.__metadata){j.__metadata={};}j.__metadata.headers=X;}}A(j,function(i,b1){if(b1&&(b1.__metadata&&b1.__metadata.uri||b1.results)&&!b1.__deferred){var c1=P+"/"+i;var d1=n+"/"+i;T=N._importData(b1,k,R,c1,d1);if(Array.isArray(T)){V[i]={__list:T};}else{if(W[i]&&W[i].__ref){if(W[i].__ref!==T){N.mInvalidatedPaths[P.substr(P.lastIndexOf("("))+"/"+i]="/"+T;}}V[i]={__ref:T};}}else if(!b1||!b1.__deferred){if(W[i]&&b1===null){N.mInvalidatedPaths[P.substr(P.lastIndexOf("("))+"/"+i]=null;}V[i]=b1;}});var $={};$[K]=V;if(this.hasContext("/"+K)&&this.getContext("/"+K).isPreliminary()){var _=this.getContext("/"+K);_.setUpdated(true);_.setPreliminary(false);}this._updateChangedEntities($);k[K]=true;P=P||'/'+K;n=n||P;var a1=this.resolveFromCache(n);if(a1==="/"+K||(a1&&a1.split("/").length>2)){this._writePathCache(a1,"/"+K,J);}this._writePathCache(P,"/"+K,J);this._writePathCache(n,"/"+K,J,true);return K;}};H.prototype._writePathCache=function(P,i,j,k){var n,J,K,N,S,R;if(P&&i){if(!this.mPathCache[P]){this.mPathCache[P]={};}if(!j&&P.lastIndexOf("/")===0){i=P;}this.mPathCache[P].canonicalPath=i;if(k){S=P.split("/");for(R=3;R<S.length;R+=1){K=S.slice(0,R).join("/");N=this.mPathCache[K];if(N){n=N.canonicalPath+P.slice(K.length);J=this.mPathCache[n];if(J){J.canonicalPath=i;}}}}}};H.prototype._removeReferences=function(j){var k=this,n;if(!j){return j;}if(j.results){n=[];A(j.results,function(i,J){n.push(k._removeReferences(J));});return n;}else{A(j,function(P,i){if(i){if(i["__ref"]||i["__list"]){delete j[P];}}});return j;}};H.prototype._restoreReferences=function(j,V){var k=this,K,n,R;function J(K){var n=V[K];if(!n){n=k._getObject("/"+K);t(n,"ODataModel inconsistent: "+K+" not found!");if(n){n=x({},n);V[K]=n;k._restoreReferences(n,V);}}return n;}if(!V){V={};}A(j,function(P,N){if(N){if(N.__ref){K=N.__ref;n=J(K);if(n){j[P]=n;}delete N.__ref;}else if(N.__list){R=[];A(N.__list,function(i,K){n=J(K);if(n){R.push(n);}});delete N.__list;N.results=R;}}});return j;};H.prototype.removeData=function(){this.oData={};};H.prototype.initialize=function(){var i=this.getBindings();i.forEach(function(j){j.initialize();});};H.prototype.invalidate=function(i){var j;for(var k in this.oData){j=this.oData[k];if(!i||i(k,j)){j.__metadata.invalid=true;}}};H.prototype.invalidateEntry=function(i){var j;if(typeof i==="string"){if(i.indexOf("/")===0){j=this._getObject(i);}else{j=this.oData[i];}}else if(i instanceof C){j=this._getObject(i.getPath());}if(j&&j.__metadata){j.__metadata.invalid=true;}};H.prototype.invalidateEntityType=function(i){var j;for(var k in this.oData){j=this.oData[k];if(j.__metadata.type===i){j.__metadata.invalid=true;}}};H.prototype.refresh=function(i,R,j){if(typeof i==="string"){j=i;i=false;R=false;}if(R){this.removeData();}this._refresh(i,j);};H.prototype._refresh=function(i,j,k,n){var J=this.getBindings();this.sRefreshGroupId=j;J.forEach(function(K){K._refresh(i,k,n);});this.sRefreshGroupId=undefined;};H.prototype.checkUpdate=function(i,j,k,n){if(j){if(!this.sUpdateTimer){this.sUpdateTimer=setTimeout(function(){this.checkUpdate(i,false,k);}.bind(this),0);}return;}if(this.sUpdateTimer){clearTimeout(this.sUpdateTimer);this.sUpdateTimer=null;}var J=this.getBindings();J.forEach(function(K){if(!n||this.isMetaModelPath(K.getPath())){K.checkUpdate(i,k);}}.bind(this));this._processAfterUpdate();};H.prototype.checkDataState=function(i){var j=this.getBindings();j.forEach(function(k){if(k.checkDataState){k.checkDataState(i);}});};H.prototype.bindProperty=function(P,i,j){var k=new m(this,P,i,j);return k;};H.prototype.bindList=function(P,i,S,j,k){var n=new h(this,P,i,S,j,k);return n;};H.prototype.bindTree=function(P,i,j,k,S){var n=new o(this,P,i,j,k,S);return n;};H.prototype.createBindingContext=function(P,i,j,k,R){var n,J,N,K,S,T=this,V;if(i!==null&&typeof i==="object"&&!(i instanceof sap.ui.model.Context)){R=k;k=j;j=i;i=undefined;}if(typeof i=="function"){R=j;k=i;j=undefined;i=undefined;}if(typeof i=="boolean"){R=i;k=undefined;j=undefined;i=undefined;}if(typeof j=="function"){R=k;k=j;j=undefined;}if(typeof j=="boolean"){R=j;k=undefined;j=undefined;}if(typeof k=="boolean"){R=k;k=undefined;}if(j){V=j.canonicalRequest;}V=this._isCanonicalRequestNeeded(V);n=this.resolve(P,i,V);if(!n&&V){n=this.resolve(P,i);}S=this.resolveDeep(P,i);if(!n){if(k){k(null);}return null;}if(R===undefined){R=this._isReloadNeeded(n,j);}if(!R){J=this.resolve(P,i,true);if(J){N=this.getContext(J,S);}else{N=null;}if(k){k(N);}return N;}function W(_){var a1=_?T._getKey(_):null,b1=!(P===""||P.indexOf("/")>0),c1=null,d1,e1;N=null;if(a1){N=T.getContext('/'+a1,S);c1={__ref:a1};}if(i&&Y&&b1){d1=i.getPath();d1=d1.substr(1);e1=T._getEntity(d1);if(e1){e1[P]=c1;}}k(N);}function X(_){var a1;if(_.statusCode=='404'&&i&&Y){var b1=i.getPath();b1=b1.substr(1);a1=T._getEntity(b1);if(a1){a1[P]={__ref:null};}}k(null);}if(k){var Y=!P.startsWith("/");if(n){var Z=[],$=this.createCustomParams(j);if($){Z.push($);}if(j&&(j.batchGroupId||j.groupId)){K=j.groupId||j.batchGroupId;}this.read(P,{groupId:K,urlParameters:Z,success:W,error:X,context:i,canonicalRequest:V});}else{k(null);}}if(j&&j.createPreliminaryContext){n=this.resolve(P,i,V);if(!n&&V){n=this.resolve(P,i);}N=this.getContext(n,S);return N;}};H.prototype._updateContext=function(i,P){if(!P.startsWith("/")){throw new Error("Path "+P+" must start with a / ");}i.sPath=P;this.mContexts[P]=i;};H.prototype._splitEntries=function(i){return i.replace(/\s/g,"").split(',').map(function(j){return j.split("/");});};H.prototype._filterOwnSelect=function(S,i){var j,k;if(!i){return[];}k=i.map(function(P){return P.name;});j=S.filter(function(n){return n.length===1;}).map(function(n){return n[0];});if(S.length===0||j.indexOf("*")!==-1||j.indexOf("**")!==-1){return k;}else{return j.filter(function(n){return k.indexOf(n)!==-1;});}};H.prototype._filterOwnExpand=function(i,S){return i.map(function(j){return j[0];}).filter(function(V,j,k){return k.indexOf(V)===j;}).filter(function(V){return S.length===0||S.some(function(j){return j.indexOf(V)===0||j.indexOf("**")===0;});});};H.prototype._filterSelectByNavProp=function(i,n){return i.filter(function(S){return S[0]===n;}).map(function(S){return S.length>1?S.slice(1):["**"];});};H.prototype._filterExpandByNavProp=function(i,n){return i.filter(function(S){return S.length>1&&S[0]===n;}).map(function(S){return S.slice(1);});};H.prototype._isReloadNeeded=function(P,k){var n=this,J=this.oMetadata,K,N=this._getObject(P),R=[],S=[];if(!this.oMetadata.isLoaded()){return true;}K=this.oMetadata._getEntityTypeByPath(P);if(this._isCreatedEntity(N)){return false;}function T(K,N,S,R){var V,W,X,Y,Z,$,_,a1,b1;if(!K){return false;}if(N===null){return false;}if(!N){return true;}if(N.__metadata&&N.__metadata.invalid){return true;}V=n._filterOwnSelect(S,K.property);for(var i=0;i<V.length;i++){b1=V[i];if(N[b1]===undefined){return true;}}W=n._filterOwnExpand(R,S);for(var i=0;i<W.length;i++){a1=W[i];X=N[a1];if(X===null){continue;}if(X===undefined||X.__deferred){return true;}Y=J._getEntityTypeByNavProperty(K,a1);$=n._filterSelectByNavProp(S,a1);_=n._filterExpandByNavProp(R,a1);if(X.__ref){Z=n._getEntity(X.__ref);if(T(Y,Z,$,_)){return true;}}if(X.__list){for(var j=0;j<X.__list.length;j++){Z=n._getEntity(X.__list[j]);if(T(Y,Z,$,_)){return true;}}}}return false;}if(k){if(k.select){S=this._splitEntries(k.select);}if(k.expand){R=this._splitEntries(k.expand);}}return T(K,N,S,R);};H.prototype.createCustomParams=function(P){var i=[],j,S={expand:true,select:true};for(var n in P){if(n in S){i.push("$"+n+"="+y(P[n]));}if(n==="custom"){j=P[n];for(n in j){if(n.indexOf("$")===0){L.warning(this+" - Trying to set OData parameter '"+n+"' as custom query option!");}else if(typeof j[n]==='string'){i.push(n+"="+y(j[n]));}else{i.push(n);}}}}return i.join("&");};H.prototype.bindContext=function(P,i,j){var k=new g(this,P,i,j);return k;};H.prototype.setDefaultCountMode=function(i){this.sDefaultCountMode=i;};H.prototype.getDefaultCountMode=function(){return this.sDefaultCountMode;};H.prototype._addEntity=function(i){var k=this._getKey(i);this.oData[k]=i;return k;};H.prototype._removeEntity=function(k){k=k&&a._normalizeKey(k);delete this.oData[k];delete this.mChangedEntities[k];delete this.mContexts["/"+k];};H.prototype._getEntity=function(k){var i=this.oData[k];if(!i){k=k&&a._normalizeKey(k);i=this.oData[k];}return i;};H.prototype._getKey=function(V){var k,i;if(V instanceof C){k=V.getPath().substr(1);}else if(V&&V.__metadata&&V.__metadata.uri){i=V.__metadata.uri;k=i.substr(i.lastIndexOf("/")+1);}else if(typeof V==='string'){k=V.substr(V.lastIndexOf("/")+1);}if(!this.oData[k]){k=k&&a._normalizeKey(k);}return k;};H.prototype.getKey=function(V){return this._getKey(V);};H.prototype.createKey=function(j,k){var n=this.oMetadata._getEntityTypeByPath(j),K=j,J=this,N,P;t(n,"Could not find entity type of collection \""+j+"\" in service metadata!");K+="(";if(n.key.propertyRef.length===1){N=n.key.propertyRef[0].name;t(N in k,"Key property \""+N+"\" is missing in object!");P=this.oMetadata._getPropertyMetadata(n,N);K+=encodeURIComponent(a.formatValue(k[N],P.type));}else{A(n.key.propertyRef,function(i,R){if(i>0){K+=",";}N=R.name;t(N in k,"Key property \""+N+"\" is missing in object!");P=J.oMetadata._getPropertyMetadata(n,N);K+=N;K+="=";K+=encodeURIComponent(a.formatValue(k[N],P.type));});}K+=")";return K;};H.prototype.getProperty=function(P,i,j){var V=this._getObject(P,i);if(!j){return V;}if(!z(V)){return V;}V=x({},V);if(j===true){return this._restoreReferences(V);}else{return this._removeReferences(V);}};H.prototype.getObject=function(P,n,J){if(z(n)){J=n;n=undefined;}var K=this,R=this.resolve(P,n),V=this._getObject(R),N=this.oMetadata._getEntityTypeByPath(R),S=[],T=[];if(!N||!z(V)||!V.__metadata||!V.__metadata.uri){return V;}if(!J||!(J.select||J.expand)){return x({},V);}function W(N,V,T,S){var X,Y,Z,$,_,a1,b1,c1,d1,e1,f1,g1,h1;if(!V){return undefined;}if(!N){return undefined;}Z=K._filterOwnSelect(T,N.property);Y={};for(var i=0;i<Z.length;i++){g1=Z[i];if(V[g1]!==undefined){Y[g1]=V[g1];}else{L.fatal("No data loaded for select property: "+g1+" of entry: "+K.getKey(V));return undefined;}}if(V.__metadata){Y.__metadata=V.__metadata;}X=K._filterOwnExpand(S,T);for(var i=0;i<X.length;i++){f1=X[i];_=V[f1];a1=K.oMetadata._getEntityTypeByNavProperty(N,f1);d1=K._filterSelectByNavProp(T,f1);e1=K._filterExpandByNavProp(S,f1);if(_&&_.__ref){c1=K._getObject("/"+_.__ref);b1=W(a1,c1,d1,e1);if(b1!==undefined){Y[f1]=b1;}else{L.fatal("No data loaded for expand property: "+f1+" of entry: "+K.getKey(b1));return undefined;}}if(_&&_.__list){h1=[];for(var j=0;j<_.__list.length;j++){c1=K._getObject("/"+_.__list[j]);b1=W(a1,c1,d1,e1);if(b1!==undefined){h1.push(b1);}else{L.fatal("No data loaded for expand property: "+f1+" of entry: "+K.getKey(b1));return undefined;}}Y[f1]=h1;}}$=K._filterOwnSelect(T,N.navigationProperty);for(var k=0;k<$.length;k++){f1=$[k];if(X.indexOf(f1)===-1){var i1=Y.__metadata.uri+"/"+f1;Y[f1]={__deferred:{uri:i1}};}}return Y;}if(J.select){T=this._splitEntries(J.select);}if(J.expand){S=this._splitEntries(J.expand);}V=W(N,V,T,S);return V;};H.prototype._getObject=function(P,i,j){var n=this.isLegacySyntax()?this.oData:null,k,J,R,S,K,N,T,V,W;R=this.resolve(P,i,this.bCanonicalRequests);if(!R&&this.bCanonicalRequests){R=this.resolve(P,i);}if(!R){return n;}if(this._isMetadataPath(R)){if(this.oMetadata&&this.oMetadata.isLoaded()){if(this.isMetaModelPath(R)){S=R.indexOf('/##');W=this.getMetaModel();if(!this.bMetaModelLoaded){return null;}K=R.substr(0,S);N=R.substr(S+3);T=W.getMetaContext(K);n=W.getProperty(N,T);}else{n=this.oMetadata._getAnnotation(R);}}}else{if(R==="/"){return this.oData;}var X=R.split("/"),Y=0;V=X[1];X.splice(0,2);k=this.mChangedEntities[V];J=this._getEntity(V);n=j?J:k||J;while(n&&X[Y]){var Z=k&&k.hasOwnProperty(X[Y]);k=k&&k[X[Y]];J=J&&J[X[Y]];n=j||!Z?J:k;if(n){if(n.__ref){k=this.mChangedEntities[n.__ref];J=this._getEntity(n.__ref);n=j?J:k||J;}else if(n.__list){n=n.__list;}else if(n.__deferred){n=undefined;}}Y++;}}if(z(k)){n=j?J:x({},J,k);}return n;};H.prototype.updateSecurityToken=function(){if(this.bTokenHandling){if(!this.oSharedServiceData.securityToken){this.refreshSecurityToken();}if(this.bTokenHandling){this.oHeaders["x-csrf-token"]=this.oSharedServiceData.securityToken;}}};H.prototype.resetSecurityToken=function(){delete this.oSharedServiceData.securityToken;delete this.oHeaders["x-csrf-token"];delete this.pSecurityToken;};H.prototype.getSecurityToken=function(){var T=this.oSharedServiceData.securityToken;if(!T){this.refreshSecurityToken();T=this.oSharedServiceData.securityToken;}return T;};H.prototype.securityTokenAvailable=function(){if(!this.pSecurityToken){if(this.oSharedServiceData.securityToken){this.pSecurityToken=Promise.resolve(this.oSharedServiceData.securityToken);}else{this.pSecurityToken=new Promise(function(i,j){this.refreshSecurityToken(function(){i(this.oSharedServiceData.securityToken);}.bind(this),function(){j();},true);}.bind(this));}}return this.pSecurityToken;};H.prototype.refreshSecurityToken=function(S,i,j){var T;var k=this;var n=this._createRequestUrlWithNormalizedPath("/");var J={abort:function(){this.request.abort();}};function K(V,W){if(W){T=k._getHeader("x-csrf-token",W.headers);k._setSessionContextIdHeader(k._getHeader("sap-contextid",W.headers));if(T){k.oSharedServerData.securityToken=T;k.oSharedServiceData.securityToken=T;k.pSecurityToken=Promise.resolve(T);k.oHeaders["x-csrf-token"]=T;}else{k.resetSecurityToken();k.bTokenHandling=false;}}if(S){S(V,W);}}function N(V){k.resetSecurityToken();k.bTokenHandling=false;k._handleError(V);if(i){i(V);}}function P(V){J.request=R("GET",N);}function R(V,i){var W=k._createRequest(n,"",V,k._getHeaders(undefined,true),null,null,!!j);W.headers["x-csrf-token"]="Fetch";return k._request(W,K,i,undefined,undefined,k.getServiceMetadata());}if(this.bDisableHeadRequestForToken){J.request=R("GET",N);}else{J.request=R("HEAD",P);}return J;};H.prototype._submitRequest=function(R,S,j){var k=this,n,J,K,N,P;N=new Promise(function(i,$){P=i;});function T(i,$){if(S){S(i,$);}P();}function V(i){if(k.bTokenHandling&&i.response){var $=k._getHeader("x-csrf-token",i.response.headers);if(!R.bTokenReset&&i.response.statusCode=='403'&&$&&$.toLowerCase()==="required"){k.resetSecurityToken();R.bTokenReset=true;X();return;}}if(j){j(i);}P();}function W(R){if(k.bTokenHandling&&(R.method!=="GET"||k.bTokenHandlingForGet)){k.pReadyForRequest=k.securityTokenAvailable();}return k.pReadyForRequest;}function X(){if(k.bTokenHandling){delete R.headers["x-csrf-token"];}W(R).then(function(i){if(k.bTokenHandling&&(R.method!=="GET"||k.bTokenHandlingForGet)){R.headers["x-csrf-token"]=i;}Z();},function(){Z();});}function Y($,R,_){var a1,b1=R.eventInfo.requests;if(b1){A(b1,function(i,R){if(Array.isArray(R)){R.forEach(function(R){A(R.parts,function(i,c1){a1=k._createEventInfo(R.request,c1.fnError);k["fireRequest"+$](a1);});});}else{if(R.parts){A(R.parts,function(i,c1){a1=k._createEventInfo(R.request,c1.fnError);k["fireRequest"+$](a1);});}else{a1=k._createEventInfo(R.request,R.fnError);k["fireRequest"+$](a1);}}});if(R.eventInfo.batch){a1=k._createEventInfo(R,_,b1);k["fireBatchRequest"+$](a1);}}}function Z(){if(k.sSessionContextId){R.headers["sap-contextid"]=k.sSessionContextId;}J=k._request(R,T,V,n,undefined,k.getServiceMetadata());if(R.eventInfo){Y("Sent",R,null);delete R.eventInfo;}if(K){J.abort();}}n=k._getODataHandler(R.requestUri);if(this.bSequentializeRequests){this.pSequentialRequestCompleted.then(function(){X();});this.pSequentialRequestCompleted=N;}else{X();}return{abort:function(){if(J){J.abort();}K=true;}};};H.prototype._setSessionContextIdHeader=function(S){if(S){this.sSessionContextId=S;}};H.prototype._submitSingleRequest=function(R){var j=this,k,n={},J={},K={};function N(S,T){if(S===undefined&&T.statusCode===200){P({message:"Response did not contain a valid OData result",response:T});return;}function V(S,T){for(var i=0;i<R.parts.length;i++){if(R.parts[i].request._aborted){j._processAborted(R.parts[i].request,T);}else if(R.parts[i].fnSuccess){R.parts[i].fnSuccess(S,T);}}if(R.request.requestUri.indexOf("$count")===-1){j.checkUpdate(false,false,J);if(R.bRefreshAfterChange){j._refresh(false,undefined,n,K);}}}j._processSuccess(R.request,T,V,J,n,K);j._invalidatePathCache();j._setSessionContextIdHeader(j._getHeader("sap-contextid",T.headers));}function P(S){if(S.message=="Request aborted"){for(var i=0;i<R.parts.length;i++){j._processAborted(R.parts[i].request,S);}}else{for(var i=0;i<R.parts.length;i++){j._processError(R.parts[i].request,S,R.parts[i].fnError);}}j._processAfterUpdate();}R.request.eventInfo={requests:R.parts,batch:false};k=this._submitRequest(R.request,N,P);return k;};H.prototype._submitBatchRequest=function(k,R,S,n){var J=this,K={},N={},P={};function T(j,$,_){for(var i=0;i<j.parts.length;i++){if(_||j.parts[i].request._aborted){J._processAborted(j.parts[i].request,$);}else if($.message){J._processError(j.parts[i].request,$,j.parts[i].fnError);}else{J._processSuccess(j.parts[i].request,$,j.parts[i].fnSuccess,N,K,P);}}}function V($,_){if($===undefined&&_.statusCode===200){W({message:"Response did not contain a valid OData batch result",response:_});return;}var a1,b1,c1,d1=$.__batchResponses;if(d1){var i,j;for(i=0;i<d1.length;i++){a1=d1[i];if(Array.isArray(R[i])){if(a1.message){for(j=0;j<R[i].length;j++){b1=R[i][j];T(b1,a1);b1.response=a1;}}else{c1=a1.__changeResponses;for(j=0;j<c1.length;j++){var e1=c1[j];b1=R[i][j];T(b1,e1);b1.response=e1;}}}else{b1=R[i];T(b1,a1);b1.response=a1;}}J._invalidatePathCache();J.checkUpdate(false,false,N);}J._processSuccess(k,_,S,N,K,P,true,R);J._setSessionContextIdHeader(J._getHeader("sap-contextid",_.headers));}function W(j){var $=j.message=="Request aborted";A(R,function(i,_){if(Array.isArray(_)){_.forEach(function(_){T(_,j,$);});}else{T(_,j,$);}});J._processAfterUpdate();if($){J._processAborted(k,j,true);}else{J._processError(k,j,n,true,R);}}k.eventInfo={requests:R,batch:true};var X=this._submitRequest(k,V,W);function Y(j){var n;for(var i=0;i<j.parts.length;i++){n=j.parts[i].fnError;if(!j.parts[i].request._aborted&&n){n(I);}}}var Z={abort:function(j){A(R,function(i,$){if(Array.isArray($)){$.forEach(function($){Y($);});}else{Y($);}});if(n&&!j){n(I);}X.abort();}};return Z;};H.prototype._invalidatePathCache=function(){var i=this,j;if(Object.keys(this.mInvalidatedPaths).length>0){Object.keys(this.mPathCache).forEach(function(k){for(var n in i.mInvalidatedPaths){j=k.indexOf(n);if(j>-1){if(j+n.length!==k.length){var J=k.substr(j+n.length);i.mPathCache[k].canonicalPath=i.mInvalidatedPaths[n]===null?null:i.mInvalidatedPaths[n]+J;}else{i.mPathCache[k].canonicalPath=i.mInvalidatedPaths[n];}}}});}this.mInvalidatedPaths={};};H.prototype._createBatchRequest=function(i){var j,R,k={},P={},n=true;P.__batchRequests=i;for(var J in i){if(i[J]&&i[J].__changeRequests||i[J]&&i[J].headers&&!i[J].headers['sap-cancel-on-close']){n=false;break;}}j=this.sServiceUrl+"/$batch";if(this.aUrlParams.length>0){j+="?"+this.aUrlParams.join("&");}Q.extend(k,this.mCustomHeaders,this.oHeaders);k["Accept"]="multipart/mixed";delete k["Content-Type"];k['sap-cancel-on-close']=n;R={headers:k,requestUri:j,method:"POST",data:P,user:this.sUser,password:this.sPassword,async:true};R.withCredentials=this.bWithCredentials;return R;};H.prototype.abortInternalRequest=function(j,P){var R=this.mRequests;var k,n;if(P){k=P.requestKey;n=P.path;}if(j in this.mDeferredGroups){R=this.mDeferredRequests;}var J=function(N){for(var i=0;i<N.parts.length;i++){N.parts[i].requestHandle.abort();}};var K=R[j];if(K){if(k in K.map){J(K.map[k]);}else if(n){A(K.map,function(k,i){if(k.indexOf(n)>=0){J(i);}});}else if(j&&!P){A(K.map,function(i,N){J(N);});}}};H.prototype._pushToRequestQueue=function(R,i,j,k,S,n,J,K){var N=R[i],P=k.key?k.key:k.method+":"+k.requestUri;if(this.bWarmup){return;}if(!N){N={};N.map={};N.requests=[];R[i]=N;}if(P in N.map&&(k.key||k.method==='GET')){var T=N.map[P];var V=T.request;k.deepPath=V.deepPath;if(this.sMessageScope===f.BusinessObject){k.headers["sap-message-scope"]=V.headers["sap-message-scope"];}if(T.bRefreshAfterChange===undefined){T.bRefreshAfterChange=K;}if(!k.key){T.parts.push({request:k,fnSuccess:S,fnError:n,requestHandle:J});}if(k.method==="GET"){delete V.data;}else{V.method=k.method;V.headers=k.headers;V.data=k.data;V.requestUri=k.requestUri;if(k.method==="PUT"){delete V.headers["x-http-method"];}if(V._aborted){delete V._aborted;}}}else{var T={request:k,bRefreshAfterChange:K,parts:[{request:k,fnSuccess:S,fnError:n,requestHandle:J}]};if(k.method==="GET"){N.requests.push(T);}else{if(!N.changes){N.changes={};}var W=N.changes[j];if(!W){W=[];N.changes[j]=W;}T.changeSetId=j;W.push(T);}N.map[P]=T;}};H.prototype._collectChangedEntities=function(j,k,n){var J=this;if(j.changes){A(j.changes,function(K,N){for(var i=0;i<N.length;i++){if(N[i].bRefreshAfterChange){var R=N[i].request,P="/"+R.requestUri.split("?")[0],S,T;if(R.method==="POST"||R.method==="DELETE"){var V=J.oMetadata._getEntityTypeByPath(P);if(V){n[V.entityType]=true;}}else{S=J._getObject(P);if(S){T=J._getKey(S);}else if(P.lastIndexOf("/")===0){T=J._getKey(P);}if(T){k[T]=true;}}}}});}};H.prototype._processRequestQueue=function(R,j,S,k){var n=this,P,J=[];function K(T,W){for(var i=0;i<T.parts.length;i++){var V=T.parts[i];if(V.request._aborted){n._processAborted(T.request,null);T.parts.splice(i,1);i--;}else if(W){V.request._handle=W;W.iRelevantRequests++;}}}function N(){return{iRelevantRequests:0,oRequestHandle:{},abort:function(){this.iRelevantRequests--;if(this.iRelevantRequests===0&&this.oRequestHandle){this.oRequestHandle.abort(true);if(S){S({},undefined);}}}};}if(this.bUseBatch){A(R,function(i,T){if(i===j||!j){var V={},W={};n._collectChangedEntities(T,V,W);if(Object.keys(V).length||Object.keys(W).length){n.bIncludeInCurrentBatch=true;n._refresh(false,i,V,W);n.bIncludeInCurrentBatch=false;}}});A(R,function(T,V){if(T===j||!j){var W=[],X=[],Y,Z;var $=N();if(V.changes){A(V.changes,function(b1,c1){Y={__changeRequests:[]};Z=[];for(var i=0;i<c1.length;i++){P='/'+n.getKey(c1[i].request.data);n.increaseLaundering(P,c1[i].request.data);K(c1[i],$);if(c1[i].parts.length>0){n.removeInternalMetadata(c1[i].request.data);Y.__changeRequests.push(c1[i].request);Z.push(c1[i]);}}if(Y.__changeRequests&&Y.__changeRequests.length>0){W.push(Y);X.push(Z);}});}if(V.requests){var _=V.requests;for(var i=0;i<_.length;i++){K(_[i],$);if(_[i].parts.length>0){W.push(_[i].request);X.push(_[i]);}}}if(W.length>0){var a1=n._createBatchRequest(W);$.oRequestHandle=n._submitBatchRequest(a1,X,S,k);J.push($.oRequestHandle);}delete R[T];}});}else{A(R,function(T,V){if(T===j||!j){if(V.changes){A(V.changes,function(Y,Z){for(var i=0;i<Z.length;i++){var X=N();P='/'+n.getKey(Z[i].request.data);n.increaseLaundering(P,Z[i].request.data);K(Z[i],X);if(Z[i].parts.length>0){n.removeInternalMetadata(Z[i].request.data);X.oRequestHandle=n._submitSingleRequest(Z[i]);J.push(X.oRequestHandle);}}});}if(V.requests){var W=V.requests;for(var i=0;i<W.length;i++){var X=N();K(W[i],X);if(W[i].parts.length>0){X.oRequestHandle=n._submitSingleRequest(W[i]);J.push(X.oRequestHandle);}}}delete R[T];}});}this.checkDataState(this.mLaunderingState);return J.length==1?J[0]:J;};H.prototype._processRequestQueueAsync=function(R){var i=this;if(!this.pCallAsync){this.pCallAsync=this.oMetadata.loaded().then(function(){return Promise.resolve().then(function(){i._processRequestQueue(R);i.pCallAsync=undefined;});});}};H.prototype._processSuccess=function(R,i,S,j,k,n,J,K){var N=i.data,P,T,V,W,X,Y,Z,$={},_={},a1=this;if(!J){T=!(i.statusCode===204||i.statusCode==='204');V=R.requestUri;W=V.replace(this.sServiceUrl,"");if(!W.startsWith('/')){W='/'+W;}var b1=this._normalizePath(W);var c1=this.oMetadata._getEntityTypeByPath(b1);var d1=c1?!c1.isFunction:true;W=this._normalizePath(W,undefined,d1);this.decreaseLaundering(W,R.data);this._decreaseDeferredRequestCount(R);if(T&&N===undefined&&i){this._parseResponse(i,R);L.fatal(this+" - No data was retrieved by service: '"+i.requestUri+"'");a1.fireRequestCompleted({url:i.requestUri,type:"GET",async:i.async,info:"Accept headers:"+this.oHeaders["Accept"],infoObject:{acceptHeaders:this.oHeaders["Accept"]},success:false});return false;}if(N&&!N.__metadata&&N.results&&!Array.isArray(N.results)){N=N.results;}if(!i._imported&&N&&(Array.isArray(N)||typeof N=='object')){P=x({},N);if(R.key||R.created){a1._importData(P,$,i,undefined,undefined,undefined,c1&&c1.isFunction);}else{a1._importData(P,$,i,W,R.deepPath,undefined,c1&&c1.isFunction);}i._imported=true;}Y=this._getEntity(R.key);if($&&Y&&Y.__metadata.created&&Y.__metadata.created.functionImport){var e1=[];var f1=Y["$result"];if(f1&&f1.__list){A($,function(h1){e1.push(h1);});f1.__list=e1;}else if(f1&&f1.__ref){A($,function(h1){f1.__ref=h1;});}}if(!T){X=W.split("/");if(X[1]){_[X[1]]=R;var g1={};g1[X[1]]=R.data;this._updateChangedEntities(g1);}if(R.method==="DELETE"&&X[2]!=="$links"){this._removeEntity(X[1]);}}if(T&&R.method==="POST"){Z=this.oMetadata._getEntityTypeByPath(W);if(Z){n[Z.entityType]=true;}if(R.key){if(R.created){var h1=this._getKey(N);var i1=this.getContext("/"+R.key);i1.bCreated=false;this._updateContext(i1,'/'+h1);i1.setUpdated(true);this.callAfterUpdate(function(){i1.setUpdated(false);});Y=this._getEntity(h1);if(Y){delete Y.__metadata.created;}}this._removeEntity(R.key);}}this._parseResponse(i,R,$,_);Q.extend(j,$);Q.extend(k,_);this._updateETag(R,i);}if(S){S(N,i);}var j1=this._createEventInfo(R,i,K);if(J){this.fireBatchRequestCompleted(j1);}else{this.fireRequestCompleted(j1);}return true;};H.prototype._processError=function(R,i,j,k,n){var P,J=this._handleError(i,R);if(!k){P='/'+this.getKey(R.data);this.decreaseLaundering(P,R.data);this._decreaseDeferredRequestCount(R);}if(j){j(J);}var K=this._createEventInfo(R,J,n);if(k){this.fireBatchRequestCompleted(K);this.fireBatchRequestFailed(K);}else{this.fireRequestCompleted(K);this.fireRequestFailed(K);}};var I={message:"Request aborted",statusCode:0,statusText:"abort",headers:{},responseText:""};H.prototype._processAborted=function(R,i,j){var P;if(!j){P='/'+this.getKey(R.data);this.decreaseLaundering(P,R.data);this._decreaseDeferredRequestCount(R);}if(i){var k=this._createEventInfo(R,I);k.success=false;if(j){this.fireBatchRequestCompleted(k);}else{this.fireRequestCompleted(k);}}};H.prototype._processAfterUpdate=function(){var j=this.aCallAfterUpdate;this.aCallAfterUpdate=[];for(var i=0;i<j.length;i++){j[i]();}};H.prototype._processChange=function(k,i,j,J){var P,K,N,R,S,T,V,W,X,Y,Z,$=this;if(J&&this.mChangedEntities[k]&&this.mChangedEntities[k].__metadata){this.mChangedEntities[k].__metadata.deepPath=J;}else if(!J&&this.mChangedEntities[k]&&this.mChangedEntities[k].__metadata&&this.mChangedEntities[k].__metadata.deepPath){J=this.mChangedEntities[k].__metadata.deepPath;}K=this.oMetadata._getEntityTypeByPath(k);if(!j){j="MERGE";}P=x({},this._getObject('/'+k,true),i);if(i.__metadata&&i.__metadata.created){R=i.__metadata.created.method?i.__metadata.created.method:"POST";k=i.__metadata.created.key;V=true;N=i.__metadata.created;if(i.__metadata.created.functionImport){N.urlParameters=this._createFunctionImportParameters(i.__metadata.created.key,R,P);P=undefined;}else{delete P.__metadata['uri'];}}else if(j==="MERGE"){R="MERGE";Z=this._getEntity(k);}else{R="PUT";}if(P&&P.__metadata){for(var n in P.__metadata){if(n!=='type'&&n!=='uri'&&n!=='etag'&&n!=='content_type'&&n!=='media_src'){delete P.__metadata[n];}}}if(P&&K){var _=this.oMetadata._getNavigationPropertyNames(K);_.forEach(function(c1){delete P[c1];});}if(R==="MERGE"&&K&&Z){A(P,function(c1,d1){if(c1!=='__metadata'){if(w(Z[c1],d1)&&!$.isLaundering('/'+k+'/'+c1)){delete P[c1];}}});var a1="/"+k,b1;A(P,function(c1,d1){if(c1!=='__metadata'){b1=$.getProperty(a1+"/"+c1+"/#@sap:unit");if(b1){if(P[b1]===undefined){P[b1]=Z[b1];}}}});}P=this._removeReferences(P);X=N&&N.urlParameters?a._createUrlParamsArray(N.urlParameters):undefined;W=N?this._getHeaders(N.headers):this._getHeaders();S=N&&N.eTag?N.eTag:this.getETag(P);T=this._createRequestUrl('/'+k,null,X,this.bUseBatch);Y=this._createRequest(T,J,R,W,P,S,undefined,true);if(V){Y.created=true;}if(this.bUseBatch){Y.requestUri=Y.requestUri.replace(this.sServiceUrl+'/','');}return Y;};H.prototype._resolveGroup=function(k){var i,j,P,n,J,K;j=this.oMetadata._getEntityTypeByPath(k);K=this._getObject('/'+k);if(K){P=K.__metadata.created;if(P){return{groupId:P.groupId,changeSetId:P.changeSetId};}}if(this.mChangeGroups[j.name]){i=this.mChangeGroups[j.name];n=i.groupId;J=i.single?u():i.changeSetId;}else if(this.mChangeGroups['*']){i=this.mChangeGroups['*'];n=i.groupId;J=i.single?u():i.changeSetId;}return{groupId:n,changeSetId:J};};H.prototype._updateETag=function(R,i){var j,k,n;j=R.requestUri.replace(this.sServiceUrl+'/','');if(!j.startsWith("/")){j="/"+j;}k=this._getObject(j.split("?")[0]);n=this._getHeader("etag",i.headers);if(k&&k.__metadata&&n){k.__metadata.etag=n;}};H.prototype._handleError=function(i,R){var P={},T;var j="The following problem occurred: "+i.message;P.message=i.message;if(i.response){this._parseResponse(i.response,R);if(this.bTokenHandling){T=this._getHeader("x-csrf-token",i.response.headers);if(i.response.statusCode=='403'&&T&&T.toLowerCase()==="required"){this.resetSecurityToken();}}j+=i.response.statusCode+","+i.response.statusText+","+i.response.body;P.statusCode=i.response.statusCode;P.statusText=i.response.statusText;P.headers=i.response.headers;P.responseText=i.response.body;}L.fatal(j);return P;};H.prototype.getData=function(P,i,j){return this.getProperty(P,i,j);};H.prototype._getODataHandler=function(i){if(i.indexOf("$batch")>-1){return s.batchHandler;}else if(i.indexOf("$count")>-1){return undefined;}else if(this.bJSON){return s.jsonHandler;}else{return s.atomHandler;}};H.prototype.getETag=function(P,i,j){if(typeof P=="object"){j=P;P="";}return this._getETag(P,i,j);};H.prototype._getETag=function(P,i,j){if(!j||!j.__metadata){j=this._getObject(P,i);}if(j&&j.__metadata){return j.__metadata.etag;}return null;};H.prototype.forceEntityUpdate=function(k){var i=this.mChangedEntities[k];if(i&&i.__metadata){i.__metadata.etag='*';}else{L.error(this+" - Entity with key "+k+" does not exist or has no change");}};H.prototype._createRequest=function(i,j,k,n,J,K,N,P){N=N!==false;if(K&&k!=="GET"){n["If-Match"]=K;}if(!n["Content-Type"]&&k!=="DELETE"&&k!=="GET"){if(this.bJSON){n["Content-Type"]="application/json";}else{n["Content-Type"]="application/atom+xml";}}if(i.indexOf("$count")>-1){n["Accept"]="text/plain, */*;q=0.5";}if(k==="MERGE"&&!this.bUseBatch){n["x-http-method"]="MERGE";k="POST";}if(this.sMessageScope===f.BusinessObject){if(this.bIsMessageScopeSupported){n["sap-message-scope"]=this.sMessageScope;}else{L.error("Message scope 'sap.ui.model.odata.MessageScope.BusinessObject' is not"+" supported by the service: "+this.sServiceUrl,undefined,"sap.ui.model.odata.v2.ODataModel");}}P=P&&this.sMessageScope===f.BusinessObject&&this.bIsMessageScopeSupported;var R={headers:n,requestUri:i,method:k,user:this.sUser,password:this.sPassword,async:N,deepPath:j,updateAggregatedMessages:P};if(J){R.data=J;}if(this.bWithCredentials){R.withCredentials=this.bWithCredentials;}R.requestID=this._createRequestID();return R;};H.prototype._processRequest=function(P,i,j){var R,k,n=false,J=this;if(this.bWarmup){return{abort:function(){}};}if(j){this.iPendingDeferredRequests++;}R={abort:function(){if(j&&!n){J.iPendingDeferredRequests--;}if(!n&&i){i(I);}if(k){k._aborted=true;if(k._handle){k._handle.abort();}}n=true;}};this.oMetadata.loaded().then(function(){k=P(R);if(k){k.deferred=!!j;}J._processRequestQueueAsync(J.mRequests);if(n){R.abort();}});return R;};H.prototype.update=function(P,i,j){var S,k,R,n,J,K,N,T,V,W,X,Y,Z,$,_,a1=this,b1,c1,d1;if(j){T=j.groupId||j.batchGroupId;V=j.changeSetId;J=j.context;S=j.success;k=j.error;K=j.eTag;X=j.headers;W=j.urlParameters;$=j.refreshAfterChange;d1=j.canonicalRequest;if(j.merge!==undefined){Y=j.merge?"MERGE":"PUT";}}d1=this._isCanonicalRequestNeeded(d1);_=T in a1.mDeferredGroups;$=this._getRefreshAfterChange($,T);N=a._createUrlParamsArray(W);X=this._getHeaders(X);Y=Y?Y:this.sDefaultUpdateMethod;K=K||this._getETag(P,J,i);b1=this._normalizePath(P,J,d1);c1=this.resolveDeep(P,J);return this._processRequest(function(e1){n=a1._createRequestUrlWithNormalizedPath(b1,N,a1.bUseBatch);R=a1._createRequest(n,c1,Y,X,i,K);Z=a1.mRequests;if(_){Z=a1.mDeferredRequests;}a1._pushToRequestQueue(Z,T,V,R,S,k,e1,$);return R;},k,_);};H.prototype.create=function(P,i,j){var R,k,n,J,S,K,N,T,V,W,X,Y,Z,$,_,a1,b1=this,c1,d1,e1;if(j){J=j.context;N=j.urlParameters;S=j.success;K=j.error;Y=j.groupId||j.batchGroupId;$=j.changeSetId;X=j.eTag;V=j.headers;_=j.refreshAfterChange;e1=j.canonicalRequest;}e1=this._isCanonicalRequestNeeded(e1);_=this._getRefreshAfterChange(_,Y);W=a._createUrlParamsArray(N);V=this._getHeaders(V);Z="POST";a1=Y in b1.mDeferredGroups;c1=b1._normalizePath(P,J,e1);d1=this.resolveDeep(P,J);return this._processRequest(function(f1){k=b1._createRequestUrlWithNormalizedPath(c1,W,b1.bUseBatch);R=b1._createRequest(k,d1,Z,V,i,X);R.created=true;n=b1.oMetadata._getEntityTypeByPath(c1);R.entityTypes={};if(n){R.entityTypes[n.entityType]=true;}T=b1.mRequests;if(a1){T=b1.mDeferredRequests;}b1._pushToRequestQueue(T,Y,$,R,S,K,f1,_);return R;},K,a1);};H.prototype.remove=function(P,i){var j,k,S,n,R,J,K,N,T,V,W,X,Y,Z,$,_,a1=this,b1,c1,d1=this.bCanonicalRequests;if(i){K=i.groupId||i.batchGroupId;N=i.changeSetId;j=i.context;S=i.success;n=i.error;T=i.eTag;X=i.headers;W=i.urlParameters;V=i.refreshAfterChange;d1=i.canonicalRequest;}d1=this._isCanonicalRequestNeeded(d1);V=this._getRefreshAfterChange(V,K);Y=a._createUrlParamsArray(W);X=this._getHeaders(X);Z="DELETE";T=T||this._getETag(P,j);_=K in a1.mDeferredGroups;b1=this._normalizePath(P,j,d1);c1=this.resolveDeep(P,j);function e1(f1,g1){k=J.substr(J.lastIndexOf('/')+1);if(k.indexOf('?')!==-1){k=k.substr(0,k.indexOf('?'));}a1._removeEntity(k);if(S){S(f1,g1);}}return this._processRequest(function(f1){J=a1._createRequestUrlWithNormalizedPath(b1,Y,a1.bUseBatch);R=a1._createRequest(J,c1,Z,X,undefined,T);$=a1.mRequests;if(_){$=a1.mDeferredRequests;}a1._pushToRequestQueue($,K,N,R,e1,n,f1,V);return R;},n,_);};H.prototype.callFunction=function(i,P){var R,j,k,n,J,K,S,N,T="GET",V,W,X,Y,Z=this,$,_,a1,b1,c1,d1,e1,f1={};if(P){V=P.groupId||P.batchGroupId;W=P.changeSetId;T=P.method?P.method:T;J=Object.assign({},P.urlParameters);Y=P.eTag;S=P.success;N=P.error;X=P.headers;e1=P.refreshAfterChange;}e1=this._getRefreshAfterChange(e1,V);if(!i.startsWith("/")){L.fatal(this+" callFunction: path '"+i+"' must be absolute!");return;}X=this._getHeaders(X);c1=new Promise(function(g1,h1){a1=g1;b1=h1;});d1=this._processRequest(function(g1){k=Z.oMetadata._getFunctionImportMetadata(i,T);t(k,Z+": Function "+i+" not found in the metadata !");if(!k){b1();return;}var h1=k.entitySet||k.entitySetPath;if(h1){f1.$result={__list:[]};if(k.returnType&&k.returnType.indexOf("Collection")==-1){f1.$result={__ref:{}};}}if(k.parameter!=null){A(k.parameter,function(i1,j1){f1[j1.name]=Z._createPropertyValue(j1.type);if(J&&J[j1.name]!==undefined){f1[j1.name]=J[j1.name];J[j1.name]=a.formatValue(J[j1.name],j1.type);}else{L.warning(Z+" - No value for parameter '"+j1.name+"' found!'");}});}$=i.substring(1)+"('"+u()+"')";f1.__metadata={uri:Z.sServiceUrl+'/'+$,created:{key:i.substring(1),success:S,error:N,headers:X,method:T,groupId:V,changeSetId:W,eTag:Y,functionImport:true}};$=Z._addEntity(f1);_=Z.getContext("/"+$);Z._writePathCache("/"+$,"/"+$);a1(_);K=a._createUrlParamsArray(J);j=Z._createRequestUrlWithNormalizedPath(i,K,Z.bUseBatch);R=Z._createRequest(j,Z.resolveDeep(i,_),T,X,undefined,Y);R.key=$;n=Z.mRequests;if(V in Z.mDeferredGroups){n=Z.mDeferredRequests;}Z._pushToRequestQueue(n,V,W,R,S,N,g1,e1);return R;},N);d1.contextCreated=function(){return c1;};return d1;};H.prototype._createFunctionImportParameters=function(i,j,P){var k=Q.extend(true,{},P);delete k.__metadata;delete k["$result"];var n=this.oMetadata._getFunctionImportMetadata(i,j);t(n,this+": Function "+i+" not found in the metadata !");if(!n){return;}if(n.parameter!=null){A(n.parameter,function(J,K){if(k&&k[K.name]!==undefined){k[K.name]=a.formatValue(k[K.name],K.type);}});}return k;};H.prototype.read=function(P,i){var j,k,n,J,K,N,R,S,T,V,W,X,Y,Z,$,_,a1,b1,c1,d1,e1,f1,g1,h1=this;if(i){Z=i.canonicalRequest;$=i.context;_=i.error;a1=i.filters;b1=i.groupId||i.batchGroupId;c1=i.headers;d1=i.sorters;e1=i.success;f1=i.updateAggregatedMessages;g1=i.urlParameters;}Z=this._isCanonicalRequestNeeded(Z);if(this.sRefreshGroupId){b1=this.sRefreshGroupId;}Y=a._createUrlParamsArray(g1);c1=this._getHeaders(c1,true);N="GET";n=this._getETag(P,$);var i1={abort:function(){if(T){T._aborted=true;}}};var j1=P;var k1=P.indexOf("$count");if(k1!==-1){j1=P.substring(0,k1-1);}S=this._normalizePath(j1,$,Z);R=this._normalizePath(P,$,Z);j=this.resolveDeep(P,$);function l1(m1){W=a.createSortParams(d1);if(W){Y.push(W);}k=h1.oMetadata._getEntityTypeByPath(S);J=F.groupFilters(a1);K=a.createFilterParams(J,h1.oMetadata,k);if(K){Y.push(K);}X=h1._createRequestUrlWithNormalizedPath(R,Y,h1.bUseBatch);T=h1._createRequest(X,j,N,c1,null,n,undefined,f1);V=h1.mRequests;if(b1 in h1.mDeferredGroups){V=h1.mDeferredRequests;}h1._pushToRequestQueue(V,b1,null,T,e1,_,m1,false);return T;}if(this.bUseBatch&&this.bIncludeInCurrentBatch){T=l1(i1);return i1;}else{return this._processRequest(l1,_);}};H.prototype.getServiceMetadata=function(){if(this.oMetadata&&this.oMetadata.isLoaded()){return this.oMetadata.getServiceMetadata();}};H.prototype.metadataLoaded=function(){var i=this.oMetadata.loaded();if(this.bLoadAnnotationsJoined){var j=function(){return i;};return this.pAnnotationsLoaded.then(j,j);}else{return i;}};H.prototype.annotationsLoaded=function(){return this.pAnnotationsLoaded;};H.prototype.isMetadataLoadingFailed=function(){return this.oMetadata.isFailed();};H.prototype.getServiceAnnotations=function(){var i=this.oAnnotations.getData();return D(i)?null:i;};H.prototype.onAnnotationsFailed=function(i){this.fireAnnotationsFailed(i.getParameters());};H.prototype.onAnnotationsLoaded=function(i){this.fireAnnotationsLoaded(i.getParameters());};H.prototype.addAnnotationUrl=function(i){var j=[].concat(i),k=[],n=[],J=[],K=this;j.forEach(function(N){var P=N.indexOf("$metadata");if(P>=0){N=K._createMetadataUrl(N);k.push(N);}else{n.push(N);}});return this.oMetadata._addUrl(k).then(function(P){return Promise.all(P.map(function(N){J=J.concat(N.entitySets);return K.oAnnotations.addSource({type:"xml",data:N["metadataString"]});}));}).then(function(){return K.oAnnotations.addSource(n);}).then(function(P){return{annotations:K.oAnnotations.getData(),entitySets:J};});};H.prototype.addAnnotationXML=function(X,S){return this.oAnnotations.addSource({type:"xml",data:X});};H.prototype.submitChanges=function(P){var R,j,k,S,n,J,K,N=false,T,V,W=this.bRefreshAfterChange,X,Y=this;if(P){j=P.groupId||P.batchGroupId;S=P.success;n=P.error;if(P.merge!==undefined){T=P.merge?"MERGE":"PUT";}}if(j&&!this.mDeferredGroups[j]){L.fatal(this+" submitChanges: \""+j+"\" is not a deferred group!");}V=x({},Y.mChangedEntities);this.oMetadata.loaded().then(function(){A(V,function(c1,d1){k=Y._resolveGroup(c1);if(k.groupId===j||!j){R=Y._processChange(c1,d1,T||Y.sDefaultUpdateMethod);R.key=c1;X=d1.__metadata&&d1.__metadata.created?d1.__metadata.created:{};var J={abort:function(){R._aborted=true;}};if(k.groupId in Y.mDeferredGroups){Y._pushToRequestQueue(Y.mDeferredRequests,k.groupId,k.changeSetId,R,X.success,X.error,J,W);}}});var Z,$,_,a1,b1,i;for(Z in Y.mDeferredRequests){_=Y.mDeferredRequests[Z];for($ in _.changes){a1=_.changes[$];for(i=a1.length-1;i>=0;i--){b1=a1[i];if(b1.bRefreshAfterChange===undefined){b1.bRefreshAfterChange=W;}}}}K=Y._processRequestQueue(Y.mDeferredRequests,j,S,n);if(N){J.abort();}if(Array.isArray(K)&&K.length==0&&S){S({},undefined);}});J={abort:function(){if(K){if(Array.isArray(K)){K.forEach(function(J){J.abort();});}else{K.abort();}}else{N=true;}}};return J;};H.prototype._updateChangedEntities=function(i){var j=this,R,k,n;function J(K,N,P){A(N,function(S){var T=P+'/'+S;if(z(N[S])&&z(K[S])){J(K[S],N[S],T);if(D(N[S])){delete N[S];}}else if(w(N[S],K[S])&&!j.isLaundering(T)){delete N[S];if(P===R){k=j.oMetadata._getEntityTypeByPath(R);n=k&&j.oMetadata._getNavPropertyRefInfo(k,S);if(n&&N[n.name]){K[n.name]=N[n.name];delete N[n.name];}}}});}A(i,function(K,N){if(K in j.mChangedEntities){var P=j._getObject('/'+K,null,true);var S=j._getObject('/'+K);x(P,N);R='/'+K;var T=j.removeInternalMetadata(S).deepPath;J(P,S,R);if(D(S)){delete j.mChangedEntities[K];j.abortInternalRequest(j._resolveGroup(K).groupId,{requestKey:K});}else{j.mChangedEntities[K]=S;S.__metadata={deepPath:T};Q.extend(S.__metadata,P.__metadata);}}});};H.prototype.resetChanges=function(P,j){var k=this,n,J={},K,N;if(j){if(P){P.forEach(function(i){k.oMetadata.loaded().then(function(){A(k.mDeferredGroups,function(R){k.abortInternalRequest(R,{path:i.substring(1)});});});});}else{this.oMetadata.loaded().then(function(){A(k.mDeferredGroups,function(i){k.abortInternalRequest(i);});});}}if(P){A(P,function(R,S){k.getEntityByPath(S,null,J);if(J&&J.propertyPath!==undefined){n=J.propertyPath.split("/");var T=J.key;K=k.mChangedEntities[T];for(var i=0;i<n.length-1;i++){if(K.hasOwnProperty(n[i])){K=K[n[i]];}else{K=undefined;}}if(K){delete K[n[n.length-1]];}if(k.mChangedEntities[T]){N=k.mChangedEntities[T].__metadata;delete k.mChangedEntities[T].__metadata;if(D(k.mChangedEntities[T])||!J.propertyPath){k.oMetadata.loaded().then(function(){k.abortInternalRequest(k._resolveGroup(T).groupId,{requestKey:T});});delete k.mChangedEntities[T];sap.ui.getCore().getMessageManager().removeMessages(k.getMessagesByEntity(T,true));}else{k.mChangedEntities[T].__metadata=N;}}else{L.warning(k+" - resetChanges: "+S+" is not changed");}}});}else{A(this.mChangedEntities,function(i,R){k.oMetadata.loaded().then(function(){k.abortInternalRequest(k._resolveGroup(i).groupId,{requestKey:i});});delete k.mChangedEntities[i];sap.ui.getCore().getMessageManager().removeMessages(k.getMessagesByEntity(i,true));});}this.checkUpdate(true);return this.oMetadata.loaded();};H.prototype.setProperty=function(P,V,j,k){var n,J,R,K,N,S,T,W,X,Y,Z,$,_={},a1={},b1,c1,d1,e1=false,f1=this,g1,h1,i1,j1,k1,l1,m1;function n1(p1,q1){A(q1,function(X){if(z(q1[X])&&z(p1[X])){n1(p1[X],q1[X]);if(D(q1[X])){delete q1[X];}}else if(w(q1[X],p1[X])){delete q1[X];}});}T=this.resolve(P,j);m1=this.resolveDeep(P,j);S=this.getEntityByPath(T,null,a1);if(!S){return false;}J=T.substring(T.lastIndexOf("/")+1);X=a1.key;N=this._getObject('/'+X,null,true);n=this._getObject(P,j,true);if(!this.mChangedEntities[X]){$=S.__metadata;S={};S.__metadata=Object.assign({},$);if(a1.propertyPath.length>0){var o1=m1.lastIndexOf(a1.propertyPath);S.__metadata.deepPath=m1.substring(0,o1-1);}this.mChangedEntities[X]=S;}c1=this.mChangedEntities[X];W=a1.propertyPath.split("/");for(var i=0;i<W.length-1;i++){if(!c1.hasOwnProperty(W[i])){c1[W[i]]={};}c1=c1[W[i]];}e1=N.__metadata.created&&N.__metadata.created.functionImport;c1[J]=V;h1=this.oMetadata._getEntityTypeByPath(a1.key);i1=h1&&this.oMetadata._getNavPropertyRefInfo(h1,J);j1=i1&&N[i1.name]&&N[i1.name].__ref;if(j1&&i1.keys.length===1){if(V===null){l1=null;}else{k1={};i1.keys.forEach(function(p1){k1[p1]=S[p1]!==undefined?S[p1]:N[p1];});k1[i1.keys[0]]=V;l1=this.createKey(i1.entitySet,k1);}c1[i1.name]={__ref:l1};}if(w(V,n)&&!this.isLaundering('/'+X)&&!e1){$=this.mChangedEntities[X].__metadata;g1=$&&$.created;delete this.mChangedEntities[X].__metadata;if(!g1){n1(N,this.mChangedEntities[X]);}if(D(this.mChangedEntities[X])){delete this.mChangedEntities[X];_[X]=true;this.checkUpdate(false,k,_);f1.oMetadata.loaded().then(function(){f1.abortInternalRequest(f1._resolveGroup(X).groupId,{requestKey:X});});return true;}this.mChangedEntities[X].__metadata=$;}Y=this._resolveGroup(X);R=this.mRequests;if(Y.groupId in this.mDeferredGroups){R=this.mDeferredRequests;K=this._processChange(X,{__metadata:S.__metadata},this.sDefaultUpdateMethod);}else{K=this._processChange(X,this._getObject('/'+X),this.sDefaultUpdateMethod);}K.key=X;b1=c1.__metadata&&c1.__metadata.created?c1.__metadata.created:{};d1=this._getRefreshAfterChange(undefined,Y.groupId);this.oMetadata.loaded().then(function(){Z={abort:function(){K._aborted=true;}};f1._pushToRequestQueue(R,Y.groupId,Y.changeSetId,K,b1.success,b1.error,Z,d1);f1._processRequestQueueAsync(f1.mRequests);});_[X]=true;this.checkUpdate(false,k,_);return true;};H.prototype._isHeaderPrivate=function(i){switch(i.toLowerCase()){case"accept":case"accept-language":case"maxdataserviceversion":case"dataserviceversion":return true;case"x-csrf-token":return this.bTokenHandling;case"sap-contextid-accept":case"sap-contextid":return!this.bDisableSoftStateHeader;default:return false;}};H.prototype.setHeaders=function(i){var j={},k=this;this.mCustomHeaders={};if(i){A(i,function(n,J){if(k._isHeaderPrivate(n)){L.warning(this+" - modifying private header: '"+n+"' not allowed!");}else{j[n]=J;}});this.mCustomHeaders=j;}if(this.oAnnotations){this.oAnnotations.setHeaders(this.mCustomHeaders);}};H.prototype._getHeaders=function(i,j){var k={},n=this;if(i){A(i,function(J,K){if(n._isHeaderPrivate(J)){L.warning(this+" - modifying private header: '"+J+"' not allowed!");}else{k[J]=K;}});}return Q.extend({'sap-cancel-on-close':!!j},this.mCustomHeaders,k,this.oHeaders);};H.prototype.getHeaders=function(){return Q.extend({},this.mCustomHeaders,this.oHeaders);};H.prototype._getHeader=function(i,j){var k;for(k in j){if(k.toLowerCase()===i.toLowerCase()){return j[k];}}return null;};H.prototype.hasPendingChanges=function(i){var j=!D(this.mChangedEntities);if(i){j=j||this.iPendingDeferredRequests>0;}return j;};H.prototype.hasPendingRequests=function(){return this.aPendingRequestHandles.length>0;};H.prototype.getPendingChanges=function(){return x({},this.mChangedEntities);};H.prototype.updateBindings=function(i){this.checkUpdate(i);};H.prototype.setTokenHandlingEnabled=function(T){this.bTokenHandling=T;};H.prototype.setUseBatch=function(i){this.bUseBatch=i;};H.prototype.formatValue=function(V,T){return a.formatValue(V,T);};H.prototype.deleteCreatedEntry=function(i){var j=this,k,n;if(i){var k=i.getPath().substr(1);n=this._resolveGroup(k).groupId;j.oMetadata.loaded().then(function(){j.abortInternalRequest(n,{requestKey:k});});j._removeEntity(k);sap.ui.getCore().getMessageManager().removeMessages(this.getMessagesByEntity(i.getPath(),true));}};H.prototype.createEntry=function(P,j){var S,k,R,n,J,K,N,T,V,W,X,Y,Z,$,_,a1={},b1,c1="POST",d1=this,e1,f1,g1;if(j){_=j.properties;V=j.groupId||j.batchGroupId;W=j.changeSetId;K=j.context;S=j.success;k=j.error;b1=j.created;J=j.eTag;Z=j.headers;Y=j.urlParameters;X=j.refreshAfterChange;g1=j.canonicalRequest;}g1=this._isCanonicalRequestNeeded(g1);Z=Z||{};X=this._getRefreshAfterChange(X,V);V=V?V:this.sDefaultChangeGroup;T=a._createUrlParamsArray(Y);var h1={abort:function(){if(R){R._aborted=true;}}};if(!P.startsWith("/")&&!K){P="/"+P;}f1=d1._normalizePath(P,K,g1);e1=d1.resolveDeep(P,K);function i1(){var j1;var k1=d1.oMetadata._getEntityTypeByPath(f1);if(!k1){t(k1,"No Metadata for collection "+f1+" found");return undefined;}if(typeof _==="object"&&!Array.isArray(_)){a1=x({},_);}else{for(var i=0;i<k1.property.length;i++){var l1=k1.property[i];var m1=(_?_.indexOf(l1.name):-1)>-1;if(!_||m1){a1[l1.name]=d1._createPropertyValue(l1.type);if(m1){_.splice(_.indexOf(l1.name),1);}}}if(_){t(_.length===0,"No metadata for the following properties found: "+_.join(","));}}var n1=d1.oMetadata._getEntitySetByType(k1);var o1="('"+u()+"')";N=n1.name+o1;if(e1&&d1.oMetadata._isCollection(e1)){e1=e1+o1;}a1.__metadata={type:""+k1.entityType,uri:d1.sServiceUrl+'/'+N,created:{key:f1.substring(1),success:S,error:k,headers:Z,urlParameters:Y,groupId:V,changeSetId:W,eTag:J},deepPath:e1};N=d1._addEntity(x({},a1));d1.mChangedEntities[N]=a1;n=d1._createRequestUrlWithNormalizedPath(f1,T,d1.bUseBatch);R=d1._createRequest(n,e1,c1,Z,a1,J);j1=d1.getContext("/"+N,e1);j1.bCreated=true;R.key=N;R.created=true;$=d1.mRequests;if(V in d1.mDeferredGroups){$=d1.mDeferredRequests;}d1.oMetadata.loaded().then(function(){d1._pushToRequestQueue($,V,W,R,S,k,h1,X);d1._processRequestQueueAsync(d1.mRequests);});return j1;}if(b1){this.oMetadata.loaded().then(function(){b1(i1());});}else if(this.oMetadata.isLoaded()){return i1();}else{L.error("Tried to use createEntry without created-callback, before metadata is available!");}};H.prototype._isCreatedEntity=function(i){return!!(i&&i.__metadata&&i.__metadata.created);};H.prototype._createPropertyValue=function(T){var j=this.oMetadata._splitName(T);var n=j.namespace;var k=j.name;if(n.toUpperCase()!=='EDM'){var J={};var K=this.oMetadata._getObjectMetadata("complexType",k,n);t(K,"Complex type "+T+" not found in the metadata !");for(var i=0;i<K.property.length;i++){var P=K.property[i];J[P.name]=this._createPropertyValue(P.type);}return J;}else{return this._getDefaultPropertyValue(k,n);}};H.prototype._getDefaultPropertyValue=function(T,n){return undefined;};H.prototype._normalizePath=function(P,i,j){if(P&&P.indexOf('?')!==-1){P=P.substr(0,P.indexOf('?'));}if(!i&&!P.startsWith("/")){L.fatal(this+" path "+P+" must be absolute if no Context is set");}return this.resolve(P,i,j)||this.resolve(P,i);};H.prototype.getRefreshAfterChange=function(){return this.bRefreshAfterChange;};H.prototype.setRefreshAfterChange=function(R){this.bRefreshAfterChange=R;};H.prototype.isList=function(P,i){P=this.resolve(P,i);return P&&P.substr(P.lastIndexOf("/")).indexOf("(")===-1;};H.prototype._isMetadataPath=function(P){var i=false;if(P&&P.indexOf('/#')>-1){i=true;}return i;};H.prototype.isMetaModelPath=function(P){return P.indexOf("##")==0||P.indexOf("/##")>-1;};H.prototype._request=function(R,S,i,j,k,n){var J;if(this.bDestroyed){return{abort:function(){}};}var K=this;function N(P){return function(){if(K.aPendingRequestHandles){var T=K.aPendingRequestHandles.indexOf(J);if(T>-1){K.aPendingRequestHandles.splice(T,1);}}if(!(J&&J.bSuppressErrorHandlerCall)){P.apply(this,arguments);}};}J=s.request(R,N(S||s.defaultSuccess),N(i||s.defaultError),j,k,n);if(R.async!==false){this.aPendingRequestHandles.push(J);}return J;};H.prototype.destroy=function(){this.bDestroyed=true;M.prototype.destroy.apply(this,arguments);if(this.aPendingRequestHandles){for(var i=this.aPendingRequestHandles.length-1;i>=0;i--){var R=this.aPendingRequestHandles[i];if(R&&R.abort){R.bSuppressErrorHandlerCall=true;R.abort();}}delete this.aPendingRequestHandles;}if(this.sMetadataLoadEvent){clearTimeout(this.sMetadataLoadEvent);}if(this.oMetadataFailedEvent){clearTimeout(this.oMetadataFailedEvent);}if(this.oMetadata){this.oMetadata.detachFailed(this.onMetadataFailed);if(!this.oMetadata.isLoaded()&&!this.oMetadata.hasListeners("loaded")){this.oMetadata.destroy();delete this.oSharedMetaData.oMetadata;}delete this.oMetadata;delete this.pMetadataLoaded;}if(this.oMetaModel){this.oMetaModel.destroy();delete this.oMetaModel;}if(this.oAnnotations){this.oAnnotations.detachSomeLoaded(this.onAnnotationsLoaded);this.oAnnotations.detachAllFailed(this.onAnnotationsFailed);this.oAnnotations.destroy();delete this.oAnnotations;delete this.pAnnotationsLoaded;}};H.prototype.setDeferredBatchGroups=function(i){this.setDeferredGroups(i);};H.prototype.setDeferredGroups=function(i){var j=this;this.mDeferredGroups={};A(i,function(k,n){j.mDeferredGroups[n]=n;});};H.prototype.getDeferredBatchGroups=function(){return this.getDeferredGroups();};H.prototype.getDeferredGroups=function(){return Object.keys(this.mDeferredGroups);};H.prototype.setChangeBatchGroups=function(i){A(i,function(j,k){k.groupId=k.batchGroupId;});this.setChangeGroups(i);};H.prototype.setChangeGroups=function(i){this.mChangeGroups=i;};H.prototype.getChangeBatchGroups=function(){return this.getChangeGroups();};H.prototype.getChangeGroups=function(){return this.mChangeGroups;};H.prototype.setMessageParser=function(P){if(!(P instanceof q)){L.error("Given MessageParser is not of type sap.ui.core.message.MessageParser");return this;}P.setProcessor(this);this.oMessageParser=P;return this;};H.prototype._parseResponse=function(R,i,j,k){try{if(!this.oMessageParser){this.oMessageParser=new r(this.sServiceUrl,this.oMetadata);this.oMessageParser.setProcessor(this);}this.oMessageParser.parse(R,i,j,k,this.bIsMessageScopeSupported);}catch(n){L.error("Error parsing OData messages: "+n);}};H.prototype.callAfterUpdate=function(i){this.aCallAfterUpdate.push(i);};H.prototype.getMetaModel=function(){var i=this;if(!this.oMetaModel){this.oMetaModel=new p(this.oMetadata,this.oAnnotations,{addAnnotationUrl:this.addAnnotationUrl.bind(this),annotationsLoadedPromise:this.pAnnotationsLoaded});this.oMetaModel.loaded().then(function(){i.bMetaModelLoaded=true;i.checkUpdate(false,false,null,true);},function(j){var k=j.message,n;if(!k&&j.xmlDoc&&j.xmlDoc.parseError){k=j.xmlDoc.parseError.reason;n=j.xmlDoc.parseError.srcText;}L.error("error in ODataMetaModel.loaded(): "+k,n,"sap.ui.model.odata.v2.ODataModel");});}return this.oMetaModel;};H.prototype.getOriginalProperty=function(P,i){return this._getObject(P,i,true);};H.prototype.getEntityByPath=function(P,i,j){var R=M.prototype.resolve.call(this,P,i);if(!R){return null;}var k=R.split("/"),n=null,J=[];while(k.length>0){var K=k.join("/"),N=this._getObject(K);if(z(N)){var S=this._getKey(N);if(S){n=N;break;}}J.unshift(k.pop());}if(n){j.propertyPath=J.join("/");j.key=S;return n;}return null;};H.prototype.resolveFromCache=function(P){if(!this.mPathCache){return undefined;}var S,i="",j,n,k;j=this.mPathCache[P]?this.mPathCache[P].canonicalPath:undefined;if(P&&j!==P){S=j||P;if(!j){k=S.lastIndexOf("/");i=S.substr(k);S=S.substr(0,k);}n=this.resolveFromCache(S);if(n&&n!==S){j=n+i;}}return j;};H.prototype.resolve=function(P,i,j){var R=M.prototype.resolve.call(this,P,i);if(R&&!this._isMetadataPath(R)&&j){var k=this.resolveFromCache(R);if(!k){k=this.oMetadata._calculateCanonicalPath(R);k=this.resolveFromCache(k)||k;}this._writePathCache(R,k);return k;}return R;};H.prototype.resolveDeep=function(P,i){var R=M.prototype.resolve.call(this,P,i);if(P&&!P.startsWith("/")){R=i?i.sDeepPath+'/'+P:R;}if(P===""){R=i?i.sDeepPath:R;}return R;};H.prototype.isLaundering=function(P,i){var R=this.resolve(P,i);return(R in this.mLaunderingState)&&this.mLaunderingState[R]>0;};H.prototype.increaseLaundering=function(P,i){if(!i){return;}for(var n in i){if(n==="__metadata"){continue;}var j=i[n];if(z(j)){this.increaseLaundering(P+"/"+n,j);}else{var T=P+"/"+n;if(!(T in this.mLaunderingState)){this.mLaunderingState[T]=0;}this.mLaunderingState[T]++;}}if(!(P in this.mLaunderingState)){this.mLaunderingState[P]=0;}this.mLaunderingState[P]++;};H.prototype.decreaseLaundering=function(P,i){if(!i){return;}for(var n in i){if(n==="__metadata"){continue;}var j=i[n],T=P+"/"+n;if(z(j)){this.decreaseLaundering(T,j);}else{if(T in this.mLaunderingState){this.mLaunderingState[T]--;if(this.mLaunderingState[T]===0){delete this.mLaunderingState[T];}}}}this.mLaunderingState[P]--;if(this.mLaunderingState[P]===0){delete this.mLaunderingState[P];}};H.prototype._getRefreshAfterChange=function(R,i){if(R===undefined&&!(i in this.mDeferredGroups)){return this.bRefreshAfterChange;}return R;};H.prototype.getMessagesByEntity=function(j,k){var n=j,J=[],P;function K(J){var N=[];for(var i=0;i<J.length;i++){if(!k||(k&&!J[i].persistent)){N.push(J[i]);}}return N;}if(!n.startsWith('/')){n='/'+n;}if(this.mMessages){for(P in this.mMessages){if(typeof n=="string"&&n.length>0&&P.startsWith(n)){J=J.concat(K(this.mMessages[P]));}}return J;}return null;};H.prototype._cacheSupported=function(i){var j=/\/~[\w\-]+~[A-Z0-9]?/;var k=[i];if(this.sAnnotationURI){if(!Array.isArray(this.sAnnotationURI)){this.sAnnotationURI=[this.sAnnotationURI];}k=k.concat(this.sAnnotationURI);}k=k.filter(function(n){return n.indexOf("sap-context-token")===-1;});k=k.filter(function(n){return!j.test(n);});return k.length===0?true:false;};H.prototype._getAnnotationCacheKey=function(i){var j;if(this.bUseCache){if(!this.bSkipMetadataAnnotationParsing){j=i+"#annotations";}if(this.sAnnotationURI){if(!Array.isArray(this.sAnnotationURI)){this.sAnnotationURI=[this.sAnnotationURI];}this.sAnnotationURI=this.sAnnotationURI.map(function(k){return k+"#annotations";});j=this.bSkipMetadataAnnotationParsing?this.sAnnotationURI.join("_"):j+"_"+this.sAnnotationURI.join("_");}}return j;};H.prototype.canonicalRequestsEnabled=function(){return this.bCanonicalRequests;};H.prototype._decreaseDeferredRequestCount=function(R){if(R.deferred){this.iPendingDeferredRequests--;}};H.prototype.enableCanonicalRequests=function(i){this.bCanonicalRequests=!!i;};H.prototype.getMessageScope=function(){return this.sMessageScope;};H.prototype.setMessageScope=function(i){if(i!==f.RequestedObjects&&i!==f.BusinessObject){throw new Error("Unsupported message scope: "+i);}this.sMessageScope=i;};H.prototype.messageScopeSupported=function(){var i=this;return this.metadataLoaded().then(function(){return i.bIsMessageScopeSupported;});};H.prototype.getContext=function(P,i){var j=M.prototype.getContext.apply(this,arguments);if(i){j.sDeepPath=i;}else if(!i&&!j.sDeepPath){j.sDeepPath=P;}return j;};H.prototype.hasContext=function(P){return this.mContexts[P];};H.prototype.removeInternalMetadata=function(i){var j,k,K,V;if(i&&i.__metadata){j=i.__metadata.created;k=i.__metadata.deepPath;delete i.__metadata.created;delete i.__metadata.deepPath;for(K in i){V=i[K];if(Array.isArray(V)){V.forEach(H.prototype.removeInternalMetadata);}else if(typeof V==="object"){H.prototype.removeInternalMetadata(V);}}}return{created:j,deepPath:k};};H.prototype._isCanonicalRequestNeeded=function(i){if(i!==undefined){return!!i;}else{return!!this.bCanonicalRequests;}};H.prototype.filterMatchingMessages=function(i,P){var j=this;return this.mMessages[i].filter(function(k){return j.isMessageMatching(k,P);});};H.prototype.isMessageMatching=function(i,P){var j=i.fullTarget,k=P.length;return j===P||j.startsWith(P)&&(P==="/"||j[k]==="/"||j[k]==="(");};H.prototype.getMessages=function(i){return this.getMessagesByPath(i.sDeepPath,true).sort(function(j,k){return G[j.type]-G[k.type];});};return H;});
