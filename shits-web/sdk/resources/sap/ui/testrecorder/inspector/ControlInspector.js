/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/base/Object","sap/ui/thirdparty/jquery","sap/ui/testrecorder/CommunicationBus","sap/ui/testrecorder/CommunicationChannels","sap/ui/testrecorder/inspector/DOMMutation","sap/ui/support/supportRules/ui/external/Highlighter","sap/ui/test/_ControlFinder","sap/ui/testrecorder/inspector/ControlAPI","sap/ui/testrecorder/inspector/ControlInspectorRepo","sap/ui/testrecorder/Constants","sap/ui/testrecorder/DialectRegistry","sap/ui/testrecorder/Dialects","sap/ui/testrecorder/controlSelectors/ControlSelectorGenerator","sap/ui/testrecorder/codeSnippets/POMethodUtil","sap/ui/testrecorder/codeSnippets/RawSnippetUtil","sap/ui/testrecorder/codeSnippets/CodeSnippetProvider","sap/ui/testrecorder/ui/models/SharedModel"],function(B,$,C,a,D,H,_,b,c,d,e,f,g,P,R,h,S){"use strict";var o=null;var i=new H(d.HIGHLIGHTER_ID);var s=Object.assign({},S.getData().settings);var j=B.extend("sap.ui.testrecorder.inspector.ControlInspector",{constructor:function(){if(!o){Object.apply(this,arguments);this._mutation=new D(this.getAllControlData);}else{return o;}}});j.prototype.init=function(){this._mutation.start();C.subscribe(a.REQUEST_ALL_CONTROLS_DATA,this.getAllControlData.bind(this));C.subscribe(a.REQUEST_CONTROL_DATA,this.getControlData.bind(this));C.subscribe(a.REQUEST_CODE_SNIPPET,this.getCodeSnippet.bind(this));C.subscribe(a.HIGHLIGHT_CONTROL,this.highlightControl.bind(this));C.subscribe(a.SET_DIALECT,this.setDialect.bind(this));C.subscribe(a.UPDATE_SETTINGS,this.updateSettings.bind(this));C.subscribe(a.CLEAR_SNIPPETS,this.clearSnippets.bind(this));};j.prototype.getAllControlData=function(){C.publish(a.RECEIVE_ALL_CONTROLS_DATA,{renderedControls:b.getAllControlData().renderedControls,framework:b.getFrameworkData().framework});c.clear();};j.prototype.getControlData=function(m){var l=b.getControlData(m);C.publish(a.RECEIVE_CONTROL_DATA,l);};j.prototype.getCodeSnippet=function(m){var l=Object.assign({},m,{settings:s});var n=c.findSelector(m.domElementId);var p=n?Promise.resolve(n):g.getSelector(l);return p.then(function(q){n=q;return h.getSnippet({controlSelector:q,action:l.action,settings:s});}).then(function(q){c.save(m,n,q);var r=s.multipleSnippets?c.getSnippets():[q];if(e.getActiveDialect()===f.RAW){return R.getJSON(r,s);}else{return P.getPOMethod(r,s);}}).then(function(q){C.publish(a.RECEIVE_CODE_SNIPPET,{codeSnippet:q});}).catch(function(E){C.publish(a.RECEIVE_CODE_SNIPPET,{error:"Could not generate code snippet for "+JSON.stringify(m)+". Details: "+E,domElementId:l.domElementId});});};j.prototype.highlightControl=function(m){if(m.domElementId){i.highlight(m.domElementId);}else if(m.controlId){var l=_._findElements({id:m.controlId})[0];if(l){i.highlight(l.id);}}};j.prototype.setDialect=function(l){if(e.getActiveDialect()!==l){e.setActiveDialect(l);C.publish(a.DIALECT_CHANGED,{dialect:l});c.getRequests().forEach(this.getCodeSnippet.bind(this));}};j.prototype.updateSettings=function(m){Object.assign(s,m);var r=c.getRequests();if(k(m,"multipleSnippets")){this.clearSnippets();if(r.length){this.getCodeSnippet(r[r.length-1]);}}if(k(m,["preferViewId"])){c.clear();}if(k(m,["formatAsPOMethod","preferViewId"])){if(s.multipleSnippets){r.forEach(this.getCodeSnippet.bind(this));}else if(r.length){this.getCodeSnippet(r[r.length-1]);}}};j.prototype.clearSnippets=function(){c.clear();C.publish(a.RECEIVE_CODE_SNIPPET,{codeSnippet:""});};j.prototype.stop=function(){this._mutation.stop();};function k(m,K){var l=$.isArray(K)?K:[K];return l.filter(function(n){return m[n]!==null&&m[n]!==undefined;}).length;}o=new j();return o;},true);
