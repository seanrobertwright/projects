/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/thirdparty/jquery","sap/ui/base/Object","sap/ui/testrecorder/CommunicationBus","sap/ui/testrecorder/CommunicationChannels"],function(q,B,C,a){"use strict";var u=null;var I="sap-ui-test-recorder-frame";var F={MIN:"32px",MID:"50%",MAX:"100%"};var b={MIN:"180px",MAX:"100%"};var U=B.extend("sap.ui.testrecorder.UIContextInjector",{constructor:function(){if(!u){this._sIdentifier=g();Object.apply(this,arguments);}else{return u;}}});U.prototype.injectFrame=function(t,o){window.communicationWindows=window.communicationWindows||{};this.fnOnClose=o;this._generateTestRecorderUrl();this._isInIframe=t.indexOf("window")===-1;if(this._isInIframe){this._openFrame();}else{this._openWindow();}window.communicationWindows.testRecorder.addEventListener("beforeunload",function(){if(!this._dockStarted&&!this._closeTriggered){this.close();}}.bind(this));C.subscribe(a.HIDE_IFRAME,this.hideFrame.bind(this));C.subscribe(a.SHOW_IFRAME,this.showFrame.bind(this));C.subscribe(a.RESIZE_IFRAME_UP,this.resizeFrameUp.bind(this));C.subscribe(a.RESIZE_IFRAME_DOWN,this.resizeFrameDown.bind(this));C.subscribe(a.CLOSE_IFRAME,this.close.bind(this));C.subscribe(a.DOCK_IFRAME,this.dockFrame.bind(this));C.subscribe(a.OPEN_NEW_WINDOW,this.openNewWindow.bind(this));};U.prototype.hideFrame=function(h){var f=document.getElementById(I).style;this._originalFrameSize={width:f.width,height:f.height};f.width=b.MIN;f.height=F.MIN;};U.prototype.showFrame=function(h){var f=document.getElementById(I).style;if(this._originalFrameSize){f.width=this._originalFrameSize.width;f.height=this._originalFrameSize.height;this._originalFrameSize=null;}else{f.width=b.MAX;f.height=F.MID;}};U.prototype.resizeFrameUp=function(){var f=document.getElementById(I).style;switch(f.height){case F.MIN:f.height=F.MID;break;case F.MID:f.height=F.MAX;break;default:f.height=F.MAX;}};U.prototype.resizeFrameDown=function(){var f=document.getElementById(I).style;switch(f.height){case F.MAX:f.height=F.MID;break;case F.MID:f.height=F.MIN;break;default:f.height=F.MIN;}};U.prototype.dockFrame=function(){this._dockStarted=true;this.close();this._openFrame();};U.prototype.openNewWindow=function(){this._dockStarted=true;this.close();this._openWindow();};U.prototype._openWindow=function(){window.communicationWindows.testRecorder=window.open(this._sUrl,"sapUiTestRecorder","width=1024,height=700,status=no,toolbar=no,menubar=no,resizable=yes,location=no,directories=no,scrollbars=yes");window.communicationWindows.testRecorder.window.onload=function(){window.communicationWindows.testRecorder.document.title="Test Recorder";};this._isInIframe=false;this._dockStarted=false;this._closeTriggered=false;};U.prototype._openFrame=function(){var f=document.createElement("IFRAME");f.id=I;f.src=this._sUrl;f.style.width=b.MAX;f.style.height=F.MID;f.style.position="absolute";f.style.left="0";f.style.bottom="0";f.style.border="none";f.style.borderRadius="1px";f.style.zIndex="1001";f.style.boxShadow="1px -10px 42px -4px #888";document.body.appendChild(f);window.communicationWindows.testRecorder=f.contentWindow;this._dockStarted=false;this._isInIframe=true;this._closeTriggered=false;};U.prototype.close=function(){if(this._closeTriggered){return;}this._closeTriggered=true;if(this._isInIframe){var f=document.getElementById(I);var c=f&&f.contentWindow;if(c){c.onerror=q.noop;f.src="about:blank";c.document.write('');c.close();if(typeof CollectGarbage=="function"){CollectGarbage();}f.remove();}}else if(window.communicationWindows.testRecorder){window.communicationWindows.testRecorder.close();}if(!this._dockStarted){window.communicationWindows={};this.fnOnClose();}};U.prototype.getCommunicationInfo=function(){return{origin:this._sOrigin,identifier:this._sIdentifier,url:this._sUrl};};U.prototype._generateTestRecorderUrl=function(){this._sUrl=q.sap.getModulePath("sap.ui.testrecorder.ui","/overlay.html?sap-ui-testrecorder-origin="+window.location.protocol+"//"+window.location.host+"&"+"sap-ui-testrecorder-frame-identifier="+this._sIdentifier);var f=new window.URI(this._sUrl);this._sOrigin=(f.protocol()||window.location.protocol.replace(':',''))+'://'+(f.host()||window.location.host);};function g(){return''+Date.now();}u=new U();return u;},true);
