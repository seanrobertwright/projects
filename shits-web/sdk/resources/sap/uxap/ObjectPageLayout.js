/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/thirdparty/jquery","sap/ui/base/ManagedObjectObserver","sap/ui/core/ResizeHandler","sap/ui/core/Configuration","sap/ui/core/Control","sap/ui/Device","sap/ui/core/delegate/ScrollEnablement","./ObjectPageSectionBase","./ObjectPageSection","./ObjectPageSubSection","./ObjectPageHeaderContent","./LazyLoading","./ObjectPageLayoutABHelper","./ThrottledTaskHelper","sap/m/ScrollBar","sap/ui/core/library","./library","./ObjectPageLayoutRenderer","sap/base/Log","sap/base/util/array/diff","sap/ui/dom/getScrollbarSize","sap/base/assert","sap/base/util/merge","sap/ui/events/KeyCodes","sap/ui/dom/getFirstEditableInput"],function(q,M,R,C,a,D,S,O,b,c,d,L,A,T,e,f,l,g,h,i,j,k,m,K,n){"use strict";var o=f.TitleLevel;var p=f.AccessibleLandmarkRole;var r=l.ObjectPageSubSectionLayout;var s=a.extend("sap.uxap.ObjectPageLayout",{metadata:{library:"sap.uxap",properties:{showAnchorBar:{type:"boolean",defaultValue:true},showAnchorBarPopover:{type:"boolean",defaultValue:true},upperCaseAnchorBar:{type:"boolean",defaultValue:true},backgroundDesignAnchorBar:{type:"sap.m.BackgroundDesign",group:"Appearance"},height:{type:"sap.ui.core.CSSSize",defaultValue:"100%"},enableLazyLoading:{type:"boolean",defaultValue:false},subSectionLayout:{type:"sap.uxap.ObjectPageSubSectionLayout",defaultValue:r.TitleOnTop},sectionTitleLevel:{type:"sap.ui.core.TitleLevel",group:"Appearance",defaultValue:o.Auto},useIconTabBar:{type:"boolean",group:"Misc",defaultValue:false},showHeaderContent:{type:"boolean",group:"Misc",defaultValue:true},useTwoColumnsForLargeScreen:{type:"boolean",group:"Appearance",defaultValue:false},showTitleInHeaderContent:{type:"boolean",group:"Appearance",defaultValue:false},showOnlyHighImportance:{type:"boolean",group:"Behavior",defaultValue:false},isChildPage:{type:"boolean",group:"Appearance",defaultValue:false},alwaysShowContentHeader:{type:"boolean",group:"Behavior",defaultValue:false},headerContentPinnable:{type:"boolean",group:"Behavior",defaultValue:true},toggleHeaderOnTitleClick:{type:"boolean",group:"Behavior",defaultValue:true},preserveHeaderStateOnScroll:{type:"boolean",group:"Behavior",defaultValue:false},showEditHeaderButton:{type:"boolean",group:"Behavior",defaultValue:false},flexEnabled:{type:"boolean",group:"Misc",defaultValue:false},showFooter:{type:"boolean",group:"Behavior",defaultValue:false}},associations:{selectedSection:{type:"sap.uxap.ObjectPageSection",multiple:false}},defaultAggregation:"sections",aggregations:{sections:{type:"sap.uxap.ObjectPageSection",multiple:true,singularName:"section"},headerTitle:{type:"sap.uxap.IHeaderTitle",multiple:false},headerContent:{type:"sap.ui.core.Control",multiple:true,singularName:"headerContent"},footer:{type:"sap.m.IBar",multiple:false},landmarkInfo:{type:"sap.uxap.ObjectPageAccessibleLandmarkInfo",multiple:false},_anchorBar:{type:"sap.uxap.AnchorBar",multiple:false,visibility:"hidden"},_iconTabBar:{type:"sap.m.IconTabBar",multiple:false,visibility:"hidden"},_headerContent:{type:"sap.uxap.IHeaderContent",multiple:false,visibility:"hidden"},_customScrollBar:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"}},events:{toggleAnchorBar:{parameters:{fixed:{type:"boolean"}}},sectionChange:{parameters:{section:{type:"sap.uxap.ObjectPageSection"},subSection:{type:"sap.uxap.ObjectPageSubSection"}}},editHeaderButtonPress:{},navigate:{parameters:{section:{type:"sap.uxap.ObjectPageSection"},subSection:{type:"sap.uxap.ObjectPageSubSection"}}}},dnd:{draggable:false,droppable:true},designtime:"sap/uxap/designtime/ObjectPageLayout.designtime"}});s.HEADER_CALC_DELAY=350;s.DOM_CALC_DELAY=200;s.MAX_SNAP_POSITION_OFFSET=20;s.HEADER_MAX_ALLOWED_NON_SROLLABLE_PERCENTAGE=0.6;s.TITLE_LEVEL_AS_ARRAY=Object.keys(o);s.EVENTS={TITLE_PRESS:"_titlePress",TITLE_MOUSE_OVER:"_titleMouseOver",TITLE_MOUSE_OUT:"_titleMouseOut",PIN_UNPIN_PRESS:"_pinUnpinPress",VISUAL_INDICATOR_MOUSE_OVER:"_visualIndicatorMouseOver",VISUAL_INDICATOR_MOUSE_OUT:"_visualIndicatorMouseOut",HEADER_VISUAL_INDICATOR_PRESS:"_headerVisualIndicatorPress",TITLE_VISUAL_INDICATOR_PRESS:"_titleVisualIndicatorPress"};s.BREAK_POINTS={TABLET:1024,PHONE:600};s.MEDIA={PHONE:"sapUxAPObjectPageLayout-Std-Phone",TABLET:"sapUxAPObjectPageLayout-Std-Tablet",DESKTOP:"sapUxAPObjectPageLayout-Std-Desktop"};s.DYNAMIC_HEADERS_MEDIA={PHONE:"sapFDynamicPage-Std-Phone",TABLET:"sapFDynamicPage-Std-Tablet",DESKTOP:"sapFDynamicPage-Std-Desktop"};s.DIV="div";s.HEADER="header";s.FOOTER="section";s.SHOW_FOOTER_CLASS_NAME="sapUxAPObjectPageFloatingFooterShow";s.HIDE_FOOTER_CLASS_NAME="sapUxAPObjectPageFloatingFooterHide";s.NO_NAVIGATION_CLASS_NAME="sapUxAPObjectPageNoNavigation";s.prototype._getFirstEditableInput=function(u){var v=this.getDomRef(u);return n(v);};s.prototype._focusFirstEditableInput=function(u){this._getFirstEditableInput(u).focus();};s._getNextTitleLevelEntry=function(u){var v=s.TITLE_LEVEL_AS_ARRAY.indexOf(u),w=v!==-1,H=w&&(v!==s.TITLE_LEVEL_AS_ARRAY.length-1);if(!w){return o.Auto;}return s.TITLE_LEVEL_AS_ARRAY[H?v+1:v];};s._getLibraryResourceBundle=function(){return sap.ui.getCore().getLibraryResourceBundle("sap.uxap");};s.prototype.init=function(){this.oCore=sap.ui.getCore();this._bFirstRendering=true;this._bDomReady=false;this._bPinned=false;this._bStickyAnchorBar=false;this._bHeaderInTitleArea=false;this._bHeaderExpanded=true;this._bHeaderBiggerThanAllowedHeight=false;this._bDelayDOMBasedCalculations=true;this._iStoredScrollTop=0;this._oStoredScrolledSubSectionInfo={};this._bAllContentFitsContainer=false;this._bIsFooterAanimationGoing=false;this._bInternalAnchorBarVisible=true;this._oVisibleSubSections=0;this._$footerWrapper=[];this._$opWrapper=[];this._$anchorBar=[];this._$titleArea=[];this._$stickyAnchorBar=[];this._$headerContent=[];this._$stickyHeaderContent=[];this._bMobileScenario=false;this._oSectionInfo={};this._aSectionBases=[];this._sScrolledSectionId="";this._iScrollToSectionDuration=600;this._$spacer=[];this.iHeaderContentHeight=0;this.iStickyHeaderContentHeight=0;this.iHeaderTitleHeight=0;this.iHeaderTitleHeightStickied=0;this.iAnchorBarHeight=0;this.iFooterHeight=0;this.iTotalHeaderSize=0;this._oScrollContainerLastState={};this._iREMSize=parseInt(q("body").css("font-size"));this._iOffset=parseInt(0.25*this._iREMSize);this._iResizeId=null;this._iAfterRenderingDomReadyTimeout=null;this._oABHelper=new A(this);this._initializeScroller();};s.prototype.onBeforeRendering=function(){var H,P;this._deregisterScreenSizeListener();if(this._oLazyLoading){this._oLazyLoading.destroy();}this._oLazyLoading=new L(this);this._deregisterCustomEvents();if(!this.getVisible()){return;}if(!this.getSelectedSection()){this._bHeaderExpanded=true;}this._bMobileScenario=l.Utilities.isPhoneScenario(this._getCurrentMediaContainerRange());this._bTabletScenario=l.Utilities.isTabletScenario(this._getCurrentMediaContainerRange());if(this._checkAlwaysShowContentHeader()){this._bHeaderExpanded=true;}this._bHeaderInTitleArea=this._shouldPreserveHeaderInTitleArea();this._createHeaderContent();this._getHeaderContent().setContentDesign(this._getHeaderDesign());this._oABHelper._getAnchorBar().setProperty("upperCase",this.getUpperCaseAnchorBar(),true);this._storeScrollLocation();this._applyUxRules();if(!q.isEmptyObject(this._oSectionInfo)&&this._bFirstRendering){this._preloadSectionsOnBeforeFirstRendering();this._bFirstRendering=false;}this._bStickyAnchorBar=false;this._handleExpandButtonPressEventLifeCycle(false);this._attachTitlePressHandler();H=this._getHeaderContent();if(H&&H.supportsPinUnpin()){P=this.getHeaderContentPinnable()&&!this.getPreserveHeaderStateOnScroll();this._getHeaderContent().setPinnable(P);if(P){this._attachPinPressHandler();}}this._attachVisualIndicatorsPressHandlers(this._handleDynamicTitlePress,this);if(D.system.desktop){this._attachVisualIndicatorMouseOverHandlers(this._addHoverClass,this._removeHoverClass,this);this._attachTitleMouseOverHandlers(this._addHoverClass,this._removeHoverClass,this);}if(this.getFooter()&&this._bIsFooterAanimationGoing){this._onToggleFooterAnimationEnd(this.getFooter());}};s.prototype.setBackgroundDesignAnchorBar=function(B){var u=this.getBackgroundDesignAnchorBar();if(u===B){return this;}this.setProperty("backgroundDesignAnchorBar",B);this._oABHelper._getAnchorBar().setBackgroundDesign(B);return this;};s.prototype.setToggleHeaderOnTitleClick=function(u){var v=this.getHeaderTitle(),w=this.setProperty("toggleHeaderOnTitleClick",u,true);if(!v||!v.supportsToggleHeaderOnTitleClick()){h.warning("Setting toggleHeaderOnTitleClick will not take effect as it is not supported in the ObjectPageHeader, read the API Doc for more information",this);return w;}u=this.getProperty("toggleHeaderOnTitleClick");this._updateToggleHeaderVisualIndicators();this._updateTitleVisualState();return w;};s.prototype._attachTitlePressHandler=function(){var u=this.getHeaderTitle();if(t(u)&&!this._bAlreadyAttachedTitlePressHandler){u.attachEvent(s.EVENTS.TITLE_PRESS,this._handleDynamicTitlePress,this);this._bAlreadyAttachedTitlePressHandler=true;}};s.prototype._toggleHeaderVisibility=function(u){var H=this._getHeaderContent();if(t(H)){H.$().toggleClass("sapUxAPObjectPageHeaderContentHidden",!u);}};s.prototype._snapHeader=function(u){var I,H=this._getHeaderContent();if(H&&H.supportsPinUnpin()&&this._bPinned){this._unPin();H.getAggregation("_pinButton").setPressed(false);u=true;}this._toggleHeaderTitle(false,true);this._toggleHeaderVisibility(u);this._moveAnchorBarToTitleArea();if(u){this._moveHeaderToContentArea();this._bHeaderExpanded=false;this._updateToggleHeaderVisualIndicators();this._adjustHeaderHeights();this._requestAdjustLayout(true);I=(this._$opWrapper.scrollTop()<=(this._getSnapPosition()+1));if(I){this._scrollTo(this._getSnapPosition()+1);}return;}this._bHeaderExpanded=false;this._updateToggleHeaderVisualIndicators();this._adjustHeaderHeights();this._requestAdjustLayout();};s.prototype._expandHeader=function(u){this._toggleHeaderTitle(true,true);this._toggleHeaderVisibility(true);if(u){this._moveAnchorBarToTitleArea();this._moveHeaderToTitleArea();this._bHeaderExpanded=true;this._updateToggleHeaderVisualIndicators();this._adjustHeaderHeights();this._requestAdjustLayout();return;}this._moveAnchorBarToContentArea();this._moveHeaderToContentArea();this._scrollTo(0,0,0);this._bHeaderExpanded=true;this._updateToggleHeaderVisualIndicators();};s.prototype._handleDynamicTitlePress=function(){if(!this.getToggleHeaderOnTitleClick()||!this._hasVisibleDynamicTitleAndHeader()){return;}var E=!this._bHeaderExpanded,I,u,v;if(E){I=(this._$opWrapper.scrollTop()<=(this._getSnapPosition()+1));u=!this._headerBiggerThanAllowedToBeExpandedInTitleArea()&&(this._shouldPreserveHeaderInTitleArea()||!I);this._expandHeader(u);if(!u){this._scrollTo(0,0);}}else{v=!this._shouldPreserveHeaderInTitleArea()&&(!this._bAllContentFitsContainer||this._headerBiggerThanAllowedToBeExpandedInTitleArea());this._snapHeader(v);}this.getHeaderTitle()._getFocusSpan().$().focus();};s.prototype._attachPinPressHandler=function(){var H=this._getHeaderContent();if(t(H)&&!this._bAlreadyAttachedPinPressHandler){H.attachEvent(s.EVENTS.PIN_UNPIN_PRESS,this._onPinUnpinButtonPress,this);this._bAlreadyAttachedPinPressHandler=true;}};s.prototype._handleExpandButtonPressEventLifeCycle=function(u){var H=this.getHeaderTitle(),v=this._hasDynamicTitle(),E;if(H&&!v){E=H.getAggregation("_expandButton");if(E){E[u?"attachPress":"detachPress"](this._handleExpandButtonPress,this);}}};s.prototype._adjustSelectedSectionByUXRules=function(){var u=this.oCore.byId(this.getSelectedSection()),v=u&&this._sectionCanBeRenderedByUXRules(u);if(!v){if(this._oFirstVisibleSection){u=this._oFirstVisibleSection;this.setAssociation("selectedSection",u.getId(),true);}else{this.setAssociation("selectedSection",null,true);return;}}};s.prototype._sectionCanBeRenderedByUXRules=function(u){var v=u.getBindingInfo("subSections");if((!u||!u.getVisible()||!u._getInternalVisible())&&!v){return false;}var w=this._aSectionBases.map(function(x){return x.getId();});return(w.indexOf(u.getId())>-1);};s.prototype._getSectionsToRender=function(){this._adjustSelectedSectionByUXRules();var u=this.oCore.byId(this.getSelectedSection());if(this.getUseIconTabBar()&&u){return[u];}else{return this.getSections();}};s.prototype._preloadSectionsOnBeforeFirstRendering=function(){var u=this._getSectionsToPreloadOnBeforeFirstRendering();this._connectModelsForSections(u);if(this.getEnableLazyLoading()){u.forEach(function(v){this.fireEvent("subSectionPreload",{subSection:v});},this);}};s.prototype._getSectionsToPreloadOnBeforeFirstRendering=function(){var u,v,I;if(!this.getEnableLazyLoading()){return this._getSectionsToRender();}if(this.getUseIconTabBar()){return this._oLazyLoading.getSubsectionsToPreload(this._grepCurrentTabSectionBases());}this._adjustSelectedSectionByUXRules();v=this.oCore.byId(this.getSelectedSection());if(!v||(v===this._oFirstVisibleSection)){return this._oLazyLoading.getSubsectionsToPreload(this._aSectionBases);}I=this.indexOfSection(v);var F=function(w){var x=w.isA("sap.uxap.ObjectPageSection")?w:w.getParent();return this.indexOfSection(x)>=I;}.bind(this);u=this._aSectionBases.filter(F);return this._oLazyLoading.getSubsectionsToPreload(u);};s.prototype._grepCurrentTabSectionBases=function(){var F=[],u,v;this._adjustSelectedSectionByUXRules();u=this.oCore.byId(this.getSelectedSection());if(u){var w=u.getId();this._aSectionBases.forEach(function(x){v=x.getParent();if(v&&v.getId()===w){F.push(x);}});}return F;};s.prototype.onAfterRendering=function(){var H=this._getHeaderContent(),F=this.getFooter(),u,w=this._getWidth(this);this._iResizeId=R.register(this,this._onUpdateScreenSize.bind(this));this._ensureCorrectParentHeight();this._cacheDomElements();if(this._hasDynamicTitle()){this.addStyleClass("sapUxAPObjectPageHasDynamicTitle");}if(w>0){this._updateMedia(w,s.MEDIA);}this._$opWrapper.on("scroll.OPL",this._onScroll.bind(this));if(this._bDomReady&&this.$().parents(":hidden").length===0){this._onAfterRenderingDomReady();}else{if(this._iAfterRenderingDomReadyTimeout){clearTimeout(this._iAfterRenderingDomReadyTimeout);}this._iAfterRenderingDomReadyTimeout=setTimeout(this._onAfterRenderingDomReady.bind(this),this._getDOMCalculationDelay());}if(H&&H.supportsPinUnpin()){this.$().toggleClass("sapUxAPObjectPageLayoutHeaderPinnable",H.getPinnable());}if(F){u=s._getLibraryResourceBundle().getText("FOOTER_ARIA_LABEL");F.$().attr("aria-label",u);}this._handleExpandButtonPressEventLifeCycle(true);};s.prototype._onAfterRenderingDomReady=function(){var u,v,w;if(this._bIsBeingDestroyed){return;}this._adjustSelectedSectionByUXRules();u=this.getSelectedSection();v=this.oCore.byId(u);this._iAfterRenderingDomReadyTimeout=null;this._bDomReady=true;this._adjustHeaderHeights();this._initAnchorBarScroll();if(u){if(this.getUseIconTabBar()){this._setSelectedSectionId(u);this._setCurrentTabSection(v);this._bAllContentFitsContainer=this._hasSingleVisibleFullscreenSubSection(v);this._checkSubSectionVisibilityChange();}else{this.scrollToSection(u,0);}}this._toggleScrolling(!this._bAllContentFitsContainer);if(D.system.desktop){this._$opWrapper.on("scroll.OPL",this.onWrapperScroll.bind(this));}this._registerOnContentResize();this.getHeaderTitle()&&this._shiftHeaderTitle();this.getFooter()&&this._shiftFooter();this._setSectionsFocusValues();if(this._preserveHeaderStateOnScroll()){this._overridePreserveHeaderStateOnScroll();}if(!this._bHeaderExpanded){w=!this._shouldPreserveHeaderInTitleArea()&&!this._bAllContentFitsContainer;this._snapHeader(w);}this._restoreScrollPosition();this.oCore.getEventBus().publish("sap.ui","ControlForPersonalizationRendered",this);this._updateMedia(this._getWidth(this),s.MEDIA);if(this._hasDynamicTitle()){this._updateMedia(this._getWidth(this),s.DYNAMIC_HEADERS_MEDIA);}this._updateToggleHeaderVisualIndicators();this._updateTitleVisualState();this.fireEvent("onAfterRenderingDOMReady");};s.prototype._toggleScrolling=function(E){if(this._$opWrapper.length){this._$opWrapper.get(0).style.overflowY=E?"auto":"hidden";}};s.prototype._shiftFooter=function(){var $=this.$("footerWrapper"),u=this._calculateShiftOffset();$.css(u.sStyleAttribute,u.iMarginalsOffset+"px");};s.prototype._calculateShiftOffset=function(){var H=0,u=this.oCore.getConfiguration().getRTL()?"left":"right",v=this._hasVerticalScrollBar(),w=this._iOffset,x;if(D.system.desktop){x=j().width;H=x;if(!v){H=0;w+=x;}}return{"sStyleAttribute":u,"iActionsOffset":w,"iMarginalsOffset":H};};s.prototype._getDOMCalculationDelay=function(){return this._bDelayDOMBasedCalculations?s.HEADER_CALC_DELAY:0;};s.prototype.exit=function(){if(this._oScroller){this._oScroller.destroy();this._oScroller=null;}this._deregisterScreenSizeListener();if(this._iContentResizeId){R.deregister(this._iContentResizeId);}if(this._iAfterRenderingDomReadyTimeout){clearTimeout(this._iAfterRenderingDomReadyTimeout);}if(this._oObserver){this._oObserver.disconnect();this._oObserver=null;}this._deregisterCustomEvents();this._oFirstVisibleSection=null;this._oFirstVisibleSubSection=null;};s.prototype._getCustomScrollBar=function(){if(!this.getAggregation("_customScrollBar")){var v=new e(this.getId()+"-vertSB",{scrollPosition:0,scroll:this.onCustomScrollerScroll.bind(this),visible:false});this.setAggregation("_customScrollBar",v,true);}return this.getAggregation("_customScrollBar");};s.prototype.onWrapperScroll=function(E){var u=Math.max(E.target.scrollTop,0);if(this._getCustomScrollBar()){if(this.allowCustomScroll===true){this.allowCustomScroll=false;return;}this.allowInnerDiv=true;this._getCustomScrollBar().setScrollPosition(u);}};s.prototype.onCustomScrollerScroll=function(E){var u=Math.max(this._getCustomScrollBar().getScrollPosition(),0);if(this.allowInnerDiv===true){this.allowInnerDiv=false;return;}this.allowCustomScroll=true;q(this._$opWrapper).scrollTop(u);};s.prototype.setShowOnlyHighImportance=function(v){var u=this.getShowOnlyHighImportance();if(u!==v){this.setProperty("showOnlyHighImportance",v,true);this.getSections().forEach(function(w){w._updateImportance();});}return this;};s.prototype.setIsHeaderContentAlwaysExpanded=function(v){var u=this.getAlwaysShowContentHeader();var w=(D.system.phone||D.system.tablet);if(u!==v){this.setProperty("alwaysShowContentHeader",v,w);}return this;};s.prototype.setShowEditHeaderButton=function(v){var u=this.getShowEditHeaderButton(),H=this.getAggregation("_headerContent");if(u!==v){this.setProperty("showEditHeaderButton",v,true);H&&H.invalidate();}return this;};s.prototype._initializeScroller=function(){if(this._oScroller){return;}this._oScroller=new S(this,this.getId()+"-scroll",{horizontal:false,vertical:true});};s.prototype.setSelectedSection=function(I){var v,u;if(I instanceof O){I=I.getId();}else if(I!=null&&typeof I!=="string"){k(false,"setSelectedSection(): sId must be a string, an instance of sap.uxap.ObjectPageSection or null");return this;}if(I===this.getSelectedSection()){return this;}if(I===null){this.setAssociation("selectedSection",null,true);this._expandHeader(this._bHeaderInTitleArea);this._requestAdjustLayoutAndUxRules(true);return this;}this.scrollToSection(I);v=b._getClosestSection(I);u=(v instanceof b)?v.getId():v;return this.setAssociation("selectedSection",u,true);};s.prototype._ensureCorrectParentHeight=function(){if(this._bCorrectParentHeightIsSet){return;}if(this.getParent().getHeight&&["","auto"].indexOf(this.getParent().getHeight())!==-1){this.$().parent().css("height","100%");}this._bCorrectParentHeightIsSet=true;};s.prototype._cacheDomElements=function(){this._$footerWrapper=q(document.getElementById(this.getId()+"-footerWrapper"));this._$titleArea=q(document.getElementById(this.getId()+"-headerTitle"));this._$anchorBar=q(document.getElementById(this.getId()+"-anchorBar"));this._$stickyAnchorBar=q(document.getElementById(this.getId()+"-stickyAnchorBar"));this._$opWrapper=q(document.getElementById(this.getId()+"-opwrapper"));this._$spacer=q(document.getElementById(this.getId()+"-spacer"));this._$headerContent=q(document.getElementById(this.getId()+"-headerContent"));this._$stickyHeaderContent=q(document.getElementById(this.getId()+"-stickyHeaderContent"));this._$contentContainer=q(document.getElementById(this.getId()+"-scroll"));this._$sectionsContainer=q(document.getElementById(this.getId()+"-sectionsContainer"));this._oScroller._$Container=this._$opWrapper;this._bDomElementsCached=true;};s.prototype._handleExpandButtonPress=function(E){this._expandHeader(true);};s.prototype._toggleHeaderTitle=function(E,u){var H=this.getHeaderTitle();this._$titleArea.toggleClass("sapUxAPObjectPageHeaderStickied",!E);this._$titleArea.toggleClass("sapUxAPObjectPageHeaderSnappedTitleOnMobile",this._hasDynamicTitleWithSnappedTitleOnMobile()&&!E);if(E){H&&H.unSnap(u);}else{H&&H.snap(u);}};s.prototype._moveHeaderToTitleArea=function(){this._$headerContent.children().appendTo(this._$stickyHeaderContent);this._bHeaderInTitleArea=true;this._bSupressModifyOnScrollOnce=true;};s.prototype._moveHeaderToContentArea=function(){if(this._bHeaderInTitleArea){this._$headerContent.append(this._$stickyHeaderContent.children());this._$stickyHeaderContent.children().remove();this._bHeaderInTitleArea=false;}};s.prototype._updateNavigation=function(){if(this.getShowAnchorBar()){this._oABHelper._buildAnchorBar();}};s.prototype._applyUxRules=function(I){var u,v,V,w,x,y,U,F,z,B,E,G,H={};u=this.getSections()||[];w=0;y=this.getShowAnchorBar();U=this.getUseIconTabBar();F=null;this._cleanMemory();u.forEach(function(J){if(!J.getVisible()){return true;}this._registerSectionBaseInfo(J);v=J.getSubSections()||[];V=0;z=null;v.forEach(function(N){if(!N.getVisible()){return true;}this._registerSectionBaseInfo(N);x=N.getVisibleBlocksCount();if(x===0){N._setInternalVisible(false,I);h.info("ObjectPageLayout :: noVisibleBlock UX rule matched","subSection "+N.getTitle()+" forced to hidden");}else{N._setInternalVisible(true,I);H[N.getId()]=true;V++;if(!z){z=N;}if(this._shouldApplySectionTitleLevel(N)){N._setInternalTitleLevel(this._determineSectionBaseInternalTitleLevel(N));}}},this);if(V==0){J._setInternalVisible(false,I);h.info("ObjectPageLayout :: noVisibleSubSection UX rule matched","section "+J.getTitle()+" forced to hidden");}else{J._setInternalVisible(true,I);H[J.getId()]=true;if(!F){F=J;G=V;}if(this.getSubSectionLayout()===r.TitleOnTop&&V===1&&z.getTitle().trim()!==""){h.info("ObjectPageLayout :: TitleOnTop.sectionGetSingleSubSectionTitle UX rule matched","section "+J.getTitle()+" is taking its single subsection title "+z.getTitle());J._setInternalTitle(z.getTitle(),I);H[z.getId()]=false;z._setBorrowedTitleDomId(J.getId()+"-title");}else{J._setInternalTitle("",I);}if(V===1&&!z.getTitle().trim()){z._setBorrowedTitleDomId(J.getId()+"-title");}if(this._shouldApplySectionTitleLevel(J)){J._setInternalTitleLevel(this._determineSectionBaseInternalTitleLevel(J));}w++;}if(U){H[J.getId()]=false;}},this);if(w<=1){y=false;h.info("ObjectPageLayout :: notEnoughVisibleSection UX rule matched","anchorBar forced to hidden");if(U&&F){H[F.getId()]=true;}}else if(F&&y){B=true;H[F.getId()]=false;h.info("ObjectPageLayout :: firstSectionTitleHidden UX rule matched","section "+F.getTitle()+" title forced to hidden");}this.toggleStyleClass(s.NO_NAVIGATION_CLASS_NAME,w<=1);Object.keys(H).forEach(function(J){this.oCore.byId(J)._setInternalTitleVisible(H[J],I);}.bind(this));if(y){this._oABHelper._buildAnchorBar();}this._setInternalAnchorBarVisible(y,I);this._oFirstVisibleSection=F;this._oFirstVisibleSubSection=this._getFirstVisibleSubSection(F);this._bAllContentFitsContainer=(w===1)&&(V===1)&&this._oFirstVisibleSubSection.hasStyleClass(c.FIT_CONTAINER_CLASS);if(B&&(G===1)){E=this.getAggregation("_anchorBar").getContent();if(E.length){this._oFirstVisibleSubSection._setBorrowedTitleDomId(E[0].getId()+"-content");}}this._checkSubSectionVisibilityChange();};s.prototype._checkSubSectionVisibilityChange=function(){var u=this.getUseIconTabBar(),v=u&&sap.ui.getCore().byId(this.getSelectedSection()),w=v?[v]:this._getVisibleSections(),V={},I;w.forEach(function(x){x.getSubSections().forEach(function(y){I=y.getVisible()&&y._getInternalVisible();if(I){V[y.getId()]=y;}});});if(i(Object.keys((this._oVisibleSubSections)),Object.keys(V)).length){this._oVisibleSubSections=V;this.fireEvent("_subSectionVisibilityChange",{visibleSubSections:V});}};s.prototype.setUseIconTabBar=function(v){var u=this.getUseIconTabBar();if(v!=u){this._applyUxRules();}this.setProperty("useIconTabBar",v);return this;};s.prototype._setCurrentTabSection=function(u,I){if(!u){return;}var v;if(u instanceof sap.uxap.ObjectPageSubSection){v=u;u=u.getParent();}else{v=this._getFirstVisibleSubSection(u);}if(this._oCurrentTabSection!==u){this._renderSection(u);this._oCurrentTabSection=u;}this._oCurrentTabSubSection=v;};s.prototype._renderSection=function(u){var $=this.$().find(".sapUxAPObjectPageContainer"),v;if(u&&$.length){v=this.oCore.createRenderManager();this.getSections().forEach(function(w){if((w.getId()===u.getId())){v.renderControl(u);}else{v.cleanupControlWithoutRendering(w);}});v.flush($[0]);v.destroy();}};s.prototype.setShowAnchorBarPopover=function(v,u){var w=this.getProperty("showAnchorBarPopover"),v=this.validateProperty("showAnchorBarPopover",v),x=this.getSelectedSection();if(v===w){return this;}this._oABHelper._getAnchorBar().setShowPopover(v);this._oABHelper._buildAnchorBar();this._setSelectedSectionId(x);return this.setProperty("showAnchorBarPopover",v,true);};s.prototype._getInternalAnchorBarVisible=function(){return this._bInternalAnchorBarVisible;};s.prototype._setInternalAnchorBarVisible=function(v,I){if(v!=this._bInternalAnchorBarVisible){this._bInternalAnchorBarVisible=v;if(I===true){this.invalidate();}}};s.prototype.setUpperCaseAnchorBar=function(v){this._oABHelper._getAnchorBar().setProperty("upperCase",v);return this.setProperty("upperCaseAnchorBar",v,true);};s.prototype._requestAdjustLayout=function(I){if(!this._oLayoutTask){this._oLayoutTask=new T(this._updateScreenHeightSectionBasesAndSpacer,s.DOM_CALC_DELAY,this);}if(!I){h.debug("ObjectPageLayout :: _requestAdjustLayout","delayed by "+s.DOM_CALC_DELAY+" ms because of dom modifications");}return this._oLayoutTask.reSchedule(I,{}).catch(function(u){});};s.prototype._requestAdjustLayoutAndUxRules=function(I){this._setSectionInfoIsDirty(true);if(!this._oUxRulesTask){this._oUxRulesTask=new T(this._adjustLayoutAndUxRules,s.DOM_CALC_DELAY,this);}if(!I){h.debug("ObjectPageLayout :: _requestAdjustLayoutAndUxRules","delayed by "+s.DOM_CALC_DELAY+" ms because of dom modifications");}return this._oUxRulesTask.reSchedule(I,{}).catch(function(u){});};s.prototype._adjustLayoutAndUxRules=function(){var u,v;h.debug("ObjectPageLayout :: _requestAdjustLayout","refreshing ux rules");this._applyUxRules(true);this._adjustSelectedSectionByUXRules();u=this.getSelectedSection();v=this.oCore.byId(u);if(v){this._setSelectedSectionId(u);if(this.getUseIconTabBar()){this._setCurrentTabSection(v);}this._requestAdjustLayout(true).then(function(w){if(w){this._oLazyLoading.doLazyLoading();}this._adjustSelectedSectionByUXRules();u=this.getSelectedSection();if(!this._isClosestScrolledSection(u)||this._oScroller._$Container.is(":animated")){this.scrollToSection(u,null,0,false,true);}}.bind(this));}};s.prototype._isClosestScrolledSection=function(u){var v=this._$opWrapper.length>0?this._$opWrapper.scrollTop():0,P=this.iScreenHeight,w=this._getClosestScrolledSectionId(v,P);return w&&(u===w);};s.prototype._setSelectedSectionId=function(u){var v=this.getAggregation("_anchorBar"),w=u&&this._oSectionInfo[u];if(!w){return;}if(v&&w.buttonId){v.setSelectedButton(w.buttonId);this.setAssociation("selectedSection",u,true);}};s.prototype.isFirstRendering=function(){return this._bFirstRendering;};s.prototype._cleanMemory=function(){var u=this.getAggregation("_anchorBar");if(u){u._resetControl();}this._oSectionInfo={};this._aSectionBases=[];};s.prototype._registerSectionBaseInfo=function(u){this._oSectionInfo[u.getId()]={$dom:[],positionTop:0,positionTopMobile:0,buttonId:"",isSection:(u instanceof b),sectionReference:u};this._aSectionBases.push(u);};s.prototype._triggerVisibleSubSectionsEvents=function(){this._bDelayDOMBasedCalculations=false;if(this.getEnableLazyLoading()&&this._oLazyLoading){this._oLazyLoading._triggerVisibleSubSectionsEvents();}};s.prototype.scrollToSection=function(I,u,v,w,x){var y=this.oCore.byId(I),z,B,E=(sap.ui.getCore().getConfiguration().getAnimationMode()!==C.AnimationMode.none),F,G;if(!this.getDomRef()){h.warning("scrollToSection can only be used after the ObjectPage is rendered",this);return;}if(!y){h.warning("scrollToSection aborted: unknown section",I,this);return;}if(!this._oSectionInfo[I]||!y._getInternalVisible()){h.warning("scrollToSection aborted: section is hidden by UX rules",I,this);return;}if(this.bIsDestroyed){h.debug("ObjectPageLayout :: scrollToSection","scrolling canceled as page is being destroyed");return;}if(this.getUseIconTabBar()){var H=b._getClosestSection(y);var W=this._bAllContentFitsContainer,J;this._bAllContentFitsContainer=this._hasSingleVisibleFullscreenSubSection(H);this._toggleScrolling(!this._bAllContentFitsContainer);J=this._bAllContentFitsContainer!==W;if(J&&!this._bHeaderExpanded){this._snapHeader(!this._bAllContentFitsContainer);this._bSupressModifyOnScrollOnce=true;}if(this._oCurrentTabSection){this._oCurrentTabSection._allowPropagationToLoadedViews(false);}H._allowPropagationToLoadedViews(true);this._setCurrentTabSection(y);this.getAggregation("_anchorBar").setSelectedButton(this._oSectionInfo[H.getId()].buttonId);this.setAssociation("selectedSection",H.getId(),true);this._checkSubSectionVisibilityChange();}B=y instanceof c?y:this._getFirstVisibleSubSection(y);if(w){this.fireNavigate({section:b._getClosestSection(y),subSection:B});}if(this._bHeaderInTitleArea&&!this._shouldPreserveHeaderInTitleArea()&&!this._bAllContentFitsContainer){this._moveHeaderToContentArea();this._toggleHeaderTitle(false);this._bHeaderExpanded=false;this._updateToggleHeaderVisualIndicators();}v=v||0;y._expandSection();this._requestAdjustLayout(true);u=this._computeScrollDuration(u,y);var N=this._computeScrollPosition(y);if(this._sCurrentScrollId!=I||x){this._sCurrentScrollId=I;if(this._iCurrentScrollTimeout){clearTimeout(this._iCurrentScrollTimeout);if(this._$contentContainer){this._$contentContainer.parent().stop(true,false);}}if(this._bDomElementsCached){this._iCurrentScrollTimeout=setTimeout(function(){this._sCurrentScrollId=undefined;this._iCurrentScrollTimeout=undefined;}.bind(this),u);}this._preloadSectionsOnBeforeScroll(y);this.getHeaderTitle()&&this._shiftHeaderTitle();N+=v;F=E&&u;G=(this._sScrolledSubSectionId!==B.getId())&&this._$opWrapper.length&&(this._$opWrapper.get(0).scrollTop!==N);if(F&&this.getEnableLazyLoading()&&G){this._oLazyLoading.suppress();setTimeout(function(){this._oLazyLoading.resume();this._oLazyLoading.doLazyLoading();}.bind(this),u);}if(!this._bStickyAnchorBar&&this._shouldSnapHeaderOnScroll(N)){z=this._getSnapPosition();this._scrollTo(z,0);if(z===0){this._toggleHeader(true);}}this._scrollTo(N,u);}};s.prototype._hasSingleVisibleFullscreenSubSection=function(u){var v=u.getSubSections().filter(function(w){return w.getVisible()&&w._getInternalVisible()&&(w.getBlocks().length>0);});return(v.length===1)&&v[0].hasStyleClass(c.FIT_CONTAINER_CLASS);};s.prototype._computeScrollDuration=function(u,v){var w=parseInt(u);w=w>=0?w:this._iScrollToSectionDuration;if(this.getUseIconTabBar()&&((v instanceof b)||this._isFirstVisibleSectionBase(v))&&this._bStickyAnchorBar){w=0;}return w;};s.prototype._computeScrollPosition=function(u){var F=u&&(u instanceof b),I=u.getId(),v=this._bMobileScenario||F?this._oSectionInfo[I].positionTopMobile:this._oSectionInfo[I].positionTop,E=!this._bStickyAnchorBar;if(E&&this._isFirstVisibleSectionBase(u)){v=0;}return v;};s.prototype._preloadSectionsOnBeforeScroll=function(u){var I=u.getId(),v;if(!this.getEnableLazyLoading()&&this.getUseIconTabBar()){v=(u instanceof b)?u:u.getParent();this._connectModelsForSections([v]);}if(this.getEnableLazyLoading()){var w=this.getUseIconTabBar()?this._grepCurrentTabSectionBases():this._aSectionBases;v=this._oLazyLoading.getSubsectionsToPreload(w,I);if(D.system.desktop){setTimeout(function(){this._connectModelsForSections(v);}.bind(this),50);}else{this._connectModelsForSections(v);}v.forEach(function(x){this.fireEvent("subSectionEnteredViewPort",{subSection:x});},this);}};s.prototype.getScrollingSectionId=function(){return this._sScrolledSectionId;};s.prototype.setDirectScrollingToSection=function(u){this.sDirectSectionId=u;};s.prototype.getDirectScrollingToSection=function(){return this.sDirectSectionId;};s.prototype.clearDirectScrollingToSection=function(){this.sDirectSectionId=null;};s.prototype._scrollTo=function(y,u){if(this._oScroller&&this._bDomReady&&!this._bSuppressScroll){h.debug("ObjectPageLayout :: scrolling to "+y);if((u===0)&&this._shouldSnapHeaderOnScroll(y)){this._toggleHeader(true);}this._oScroller.scrollTo(0,y,u);}return this;};s.prototype._scrollBelowCollapseVisualIndicator=function(){var H=this._getHeaderContent(),$,u,v,w;if(!t(H)||!t(this._$opWrapper)){return;}$=H._getCollapseButton().getDomRef();u=$.getBoundingClientRect().height;v=this._$opWrapper[0].getBoundingClientRect().height;w=$.offsetTop+u-v;this._scrollTo(w);};s.prototype._updateMedia=function(w,u){if(!w){return;}var U=function(v){Object.keys(u).forEach(function(x){var y=u[x],E=v===y;this.toggleStyleClass(y,E);},this);}.bind(this),B=s.BREAK_POINTS;if(w<=B.PHONE){U(u.PHONE);}else if(w<=B.TABLET){U(u.TABLET);}else{U(u.DESKTOP);}};s.prototype._updateScreenHeightSectionBasesAndSpacer=function(){var u,v,w,P,x,y,z=!this._bHeaderExpanded,I,B,E,F=this.getDomRef(),U=this.getUseIconTabBar();if(!F||!this._bDomReady){return false;}h.debug("ObjectPageLayout :: _updateScreenHeightSectionBasesAndSpacer","re-evaluating dom positions");this.iScreenHeight=this._getDOMRefHeight(F);if(this.iScreenHeight===0){return;}this.iFooterHeight=this._getFooterHeight();var G=-1;this._aSectionBases.forEach(function(H){var J=this._oSectionInfo[H.getId()],$=H.$(),N,Q=false;if(!J||!$.length){return;}if(!J.isSection){G++;}J.$dom=$;var V=$.position().top;J.positionTop=Math.ceil(V);if(J.isSection){N=H.$("header");}else{N=H.$("headerTitle");}Q=N.length===0;if(!Q){J.positionTopMobile=Math.ceil(N.position().top)+N.outerHeight();}else{J.positionTopMobile=J.positionTop;}if(!this._bStickyAnchorBar&&!this._bHeaderInTitleArea){J.positionTopMobile-=this.iAnchorBarHeight;J.positionTop-=this.iAnchorBarHeight;}J.sectionReference.toggleStyleClass("sapUxAPObjectPageSubSectionPromoted",Q);if(this._bMobileScenario){var W=this.oCore.byId(H.getId()).getParent();if(W instanceof b&&W._getIsHidden()){return;}if(x){this._oSectionInfo[x].positionBottom=J.positionTop;}x=H.getId();v=H;}else{if(J.isSection){if(x){this._oSectionInfo[x].positionBottom=J.positionTop;if(P){this._oSectionInfo[P].positionBottom=J.positionTop;}}x=H.getId();P=null;}else{if(P){this._oSectionInfo[P].positionBottom=J.positionTop;}P=H.getId();v=H;}}if(!J.isSection){B=U||(H.getParent()===this._oFirstVisibleSection);I=B&&(G===0);E=H.hasStyleClass(c.FIT_CONTAINER_CLASS);H._setHeight(this._computeSubSectionHeight(I,E,J.positionTop));}},this);if(v){u=this._computeLastVisibleHeight(v);if(this._bMobileScenario&&x){this._oSectionInfo[x].positionBottom=this._oSectionInfo[x].positionTop+u;}else{if(P){this._oSectionInfo[P].positionBottom=this._oSectionInfo[P].positionTop+u;}if(x&&P){this._oSectionInfo[x].positionBottom=this._oSectionInfo[P].positionTop+u;}}y=this._bStickyAnchorBar||(G>0)||this._checkContentBottomRequiresSnap(v);if(this._bAllContentFitsContainer){y=false;}if(y&&!this._shouldPreserveHeaderInTitleArea()){z=true;}w=this._computeSpacerHeight(v,u,y,z);this._$spacer.height(w+"px");h.debug("ObjectPageLayout :: bottom spacer is now "+w+"px");m(this._oScrollContainerLastState,{iScrollableContentLength:Math.ceil(this._getScrollableContentLength()),iSpacerHeight:w});}this._updateCustomScrollerHeight(z);this._setSectionInfoIsDirty(false);return true;};s.prototype._computeSubSectionHeight=function(F,u,v){var w,x;if(!u){return"";}var I=(this._bAllContentFitsContainer)?this._bHeaderExpanded:F;w=this._getSectionsContainerHeight(!I);if(this._bAllContentFitsContainer){x=(v-this.iHeaderContentHeight)+this.iFooterHeight;w-=x;}return w+"px";};s.prototype._updateCustomScrollerHeight=function(u){if(D.system.desktop&&this.getAggregation("_customScrollBar")){var v=this._computeScrollableContentSize(u);v+=this._getStickyAreaHeight(u);this._getCustomScrollBar().setContentSize(v+"px");var w=(v>Math.ceil(this.iScreenHeight)),V=(w!==this._getCustomScrollBar().getVisible());if(V){this._getCustomScrollBar().setVisible(w);this.getHeaderTitle()&&this._shiftHeaderTitle();}}};s.prototype._computeScrollableContentSize=function(u){var v=0;if(this._$contentContainer&&this._$contentContainer.length){v=this._$contentContainer[0].scrollHeight;}if(!this._bStickyAnchorBar&&u){v-=this.iAnchorBarHeight;}if(this._bStickyAnchorBar&&!u){v+=this.iAnchorBarHeight;}return v;};s.prototype._computeLastVisibleHeight=function(u){var I=this._bStickyAnchorBar||this._bHeaderInTitleArea;var v=this._getSectionPositionTop(u,I);return this._$spacer.position().top-v;};s.prototype._getStickyAreaHeight=function(I){if(I){return this.iHeaderTitleHeightStickied+this.iAnchorBarHeight;}return this.iHeaderTitleHeight;};s.prototype._getScrollableViewportHeight=function(I){return this.getDomRef().getBoundingClientRect().height-this._getStickyAreaHeight(I);};s.prototype._getSectionsContainerHeight=function(I){var u=this._getScrollableViewportHeight(I);if(!I){u-=(this.iHeaderContentHeight+this.iAnchorBarHeight);}return u;};s.prototype._getSectionPositionTop=function(u,v){var P=Math.ceil(u.$().position().top);if(!this._bStickyAnchorBar&&!this._bHeaderInTitleArea&&v){P-=this.iAnchorBarHeight;}return P;};s.prototype._getSectionPositionBottom=function(u,v){var P=this._oSectionInfo[u.getId()].positionBottom;if(!v){P+=this.iAnchorBarHeight;}return P;};s.prototype._determineSectionBaseInternalTitleLevel=function(u){var v=this.getSectionTitleLevel(),I=u instanceof b;if(v===o.Auto){return I?o.H3:o.H4;}return I?v:s._getNextTitleLevelEntry(v);};s.prototype._shouldApplySectionTitleLevel=function(u){return u.getTitleLevel()===o.Auto;};s.prototype._checkContentBottomRequiresSnap=function(u){var v=false;return this._getSectionPositionBottom(u,v)>(this._getScrollableViewportHeight(v)+this._getSnapPosition());};s.prototype._computeSpacerHeight=function(u,v,w,x){var y,z;z=this._getScrollableViewportHeight(x);if(w){z=Math.ceil(z);v=Math.floor(v);}else{v=this._$spacer.position().top;}if(v<z){y=z-v;if(this._bMobileScenario){y+=(this._oSectionInfo[u.getId()].positionTopMobile-this._oSectionInfo[u.getId()].positionTop);}}else{y=0;}if((this.iFooterHeight>y)){y+=this.iFooterHeight;}return y;};s.prototype._isFirstVisibleSectionBase=function(u){var v,w,F,x=this.getSelectedSection(),U=this.getUseIconTabBar();if(!u||!u.getParent()){return;}v=u.getId();if(U&&(v===x)){return true;}if(U&&(u.getParent().getId()===x)){w=sap.ui.getCore().byId(x);F=this._getFirstVisibleSubSection(w);return F&&(F.getId()===v);}if(this._oFirstVisibleSection&&this._oFirstVisibleSubSection){return v===this._oFirstVisibleSection.getId()||v===this._oFirstVisibleSubSection.getId();}return false;};s.prototype._getFirstVisibleSubSection=function(u){if(!u){return;}var F;this._aSectionBases.every(function(v){if(v.getParent()&&(v.getParent().getId()===u.getId())){F=v;return false;}return true;});return F;};s.prototype._initAnchorBarScroll=function(){var u=this.oCore.byId(this.getSelectedSection()),v;this._requestAdjustLayout(true);v=u?this._computeScrollPosition(u):0;this._sScrolledSectionId="";this._sCurrentScrollId="";this._onScroll({target:{scrollTop:v}},true);};s.prototype._setAsCurrentSection=function(u){var v,w,x;if(this._sScrolledSectionId===u){return;}h.debug("ObjectPageLayout :: current section is "+u);this._sScrolledSectionId=u;v=this.getAggregation("_anchorBar");if(v&&this._getInternalAnchorBarVisible()){w=this.oCore.byId(u);x=w&&w instanceof c&&(w.getTitle().trim()===""||!w._getInternalTitleVisible()||w.getParent()._getIsHidden());if(x){u=w.getParent().getId();h.debug("ObjectPageLayout :: current section is a subSection with an empty or hidden title, selecting parent "+u);}if(w&&this._oSectionInfo[u]){v.setSelectedButton(this._oSectionInfo[u].buttonId);this.setAssociation("selectedSection",b._getClosestSection(u).getId(),true);this._setSectionsFocusValues(u);}}};s.prototype._registerOnContentResize=function(){var $=this._$contentContainer.length&&this._$contentContainer[0];if(!$){return;}if(this._iContentResizeId){R.deregister(this._iContentResizeId);}this._iContentResizeId=R.register($,this._onUpdateContentSize.bind(this));};s.prototype._onUpdateContentSize=function(E){var u;if(this._preserveHeaderStateOnScroll()){this._overridePreserveHeaderStateOnScroll();}this._adjustHeaderHeights();this._requestAdjustLayout().then(function(){u=this._$opWrapper.scrollTop();this._updateSelectionOnScroll(u);}.bind(this));};s.prototype._onUpdateScreenSize=function(E){var u=this.getHeaderTitle(),H=this._getHeaderContent(),v=E.size.width,w=E.size.height,x=E.oldSize.height,y=(w!==x),z,I=H&&H.supportsAlwaysExpanded()&&this.getAlwaysShowContentHeader();if(E.size.height===0||E.size.width===0){h.info("ObjectPageLayout :: not triggering calculations if height or width is 0");return;}if(!this._bDomReady){h.info("ObjectPageLayout :: cannot _onUpdateScreenSize before dom is ready");return;}this._oLazyLoading.setLazyLoadingParameters();setTimeout(function(){this._bMobileScenario=l.Utilities.isPhoneScenario(this._getCurrentMediaContainerRange());this._bTabletScenario=l.Utilities.isTabletScenario(this._getCurrentMediaContainerRange());if(I&&(this._bHeaderInTitleArea!=this._checkAlwaysShowContentHeader())){this.invalidate();}if(this._bHeaderInTitleArea&&this._headerBiggerThanAllowedToBeExpandedInTitleArea()){this._expandHeader(false);this._scrollTo(0,0);}if(u&&u.isDynamic()){u._onResize(v);this._updateMedia(v,s.DYNAMIC_HEADERS_MEDIA);}this._updateMedia(v,s.MEDIA);this._adjustHeaderHeights();this._requestAdjustLayout(true);if(this.getFooter()&&this.getShowFooter()){this._shiftFooter();}z=this.getSelectedSection();if((x===0)&&y&&!this._isClosestScrolledSection(z)){this.scrollToSection(z,0);}this._scrollTo(this._$opWrapper.scrollTop(),0);if((x===0)&&y&&this.getEnableLazyLoading()&&this._oLazyLoading&&!this._bDelayDOMBasedCalculations){this._oLazyLoading.doLazyLoading();}}.bind(this),this._getDOMCalculationDelay());};s.prototype._onUpdateHeaderTitleSize=function(E){if(E.size.height===0||E.size.width===0){h.info("ObjectPageLayout :: not triggering calculations if height or width is 0");return;}if(!this._bDomReady){h.info("ObjectPageLayout :: cannot _onUpdateTitleSize before dom is ready");return;}this._adjustHeaderHeights();this._requestAdjustLayout();};s.prototype._shouldSnapHeaderOnScroll=function(u){return(u>0)&&(u>=this._getSnapPosition())&&!this._shouldPreserveHeaderInTitleArea();};s.prototype._getScrollableContentLength=function(){return this._$contentContainer.length?this._getDOMRefHeight(this._$contentContainer[0]):0;};s.prototype._isContentScrolledToBottom=function(){return this._oScrollContainerLastState.iScrollableContentLength<=(this._oScrollContainerLastState.iScrollTop+this._oScrollContainerLastState.iScrollableViewportHeight);};s.prototype._isContentLengthDecreased=function(P){if(P){return((P.iScrollableContentLength>this._oScrollContainerLastState.iScrollableContentLength)&&(P.iSpacerHeight===this._oScrollContainerLastState.iSpacerHeight));}};s.prototype._canReachScrollTop=function(u,E){var v;E=E||0;v=this._oScrollContainerLastState.iScrollableContentLength+E-this._oScrollContainerLastState.iScrollableViewportHeight;return v>=u;};s.prototype._deregisterCustomEvents=function(){if(this._$opWrapper.length){this._$opWrapper.off(".OPL");}};s.prototype._deregisterScreenSizeListener=function(){if(this._iResizeId){R.deregister(this._iResizeId);this._iResizeId=null;}};s.prototype._onScroll=function(E,I){var u=Math.max(Math.ceil(E.target.scrollTop),0),$=this._$opWrapper.length&&this._$opWrapper[0],v=this._$spacer.length&&this._$spacer[0],w=v.offsetHeight,P,H=this.getHeaderTitle(),x=this._shouldSnapHeaderOnScroll(u),y=this._shouldPreserveHeaderInTitleArea(),z=false,B=this._oScrollContainerLastState;this._oScrollContainerLastState={iScrollTop:u,iScrollableContentLength:Math.ceil(this._getScrollableContentLength()),iScrollableViewportHeight:$.offsetHeight,iSpacerHeight:w};if(this._bSupressModifyOnScrollOnce){this._bSupressModifyOnScrollOnce=false;return;}if(!$||!v){return;}P=this.iScreenHeight;if(P===0){return;}if(this._getSectionInfoIsDirty()){return;}if(B&&this._isContentScrolledToBottom()&&this._isContentLengthDecreased(B)){var F=B.iScrollableContentLength-this._oScrollContainerLastState.iScrollableContentLength;if(!this._canReachScrollTop(B.iScrollTop)&&this._canReachScrollTop(B.iScrollTop,F)){var N=w+F;this._$spacer.height(N+"px");this._scrollTo(B.iScrollTop);return;}}if(x&&!y){P-=(this.iAnchorBarHeight+this.iHeaderTitleHeightStickied);}if(this._bHeaderInTitleArea&&!y){this._moveHeaderToContentArea();this._toggleHeaderTitle(false);this._bHeaderExpanded=false;this._updateToggleHeaderVisualIndicators();this._requestAdjustLayout();}if(!y&&((H&&this.getShowHeaderContent())||this.getShowAnchorBar())){this._toggleHeader(x,!!(E&&E.type==="scroll"));}if(!y){this._adjustHeaderTitleBackgroundPosition(u);}h.debug("ObjectPageLayout :: lazy loading : Scrolling at "+u,"----------------------------------------");this._updateSelectionOnScroll(u);if(this.getEnableLazyLoading()){this._oLazyLoading.lazyLoadDuringScroll(I,u,E.timeStamp,P);}if(H&&H.supportsTitleInHeaderContent()&&this.getShowHeaderContent()&&this.getShowTitleInHeaderContent()&&H.getShowTitleSelector()){if(u===0){q(document.getElementById(this.getId()+"-scroll")).css("z-index","1000");z=false;}else if(!z){z=true;q(document.getElementById(this.getId()+"-scroll")).css("z-index","0");}}};s.prototype._updateSelectionOnScroll=function(u){var P=this.iScreenHeight,v,w;if(P===0){return;}v=this._getClosestScrolledSectionId(u,P);w=this._getClosestScrolledSectionId(u,P,true);if(v){var x=this.getDirectScrollingToSection();if(v!==this._sScrolledSectionId){h.debug("ObjectPageLayout :: closest id "+v,"----------------------------------------");var x=this.getDirectScrollingToSection();if(x&&x!==v){return;}this.clearDirectScrollingToSection();this._setAsCurrentSection(v);}else if(v===this.getDirectScrollingToSection()){this.clearDirectScrollingToSection();}if(w!==this._sScrolledSubSectionId){this._sScrolledSubSectionId=w;this.fireEvent("_sectionChange",{section:this.oCore.byId(v),subSection:this.oCore.byId(w)});this.fireEvent("sectionChange",{section:this.oCore.byId(v),subSection:this.oCore.byId(w)});}}};s.prototype._getSnapPosition=function(){var u=this.iHeaderContentHeight,v=this.iHeaderTitleHeightStickied-this.iHeaderTitleHeight;if(v<s.MAX_SNAP_POSITION_OFFSET){u-=v;}return u;};s.prototype._getClosestScrolledSectionId=function(u,P,v){v=!!v;u=Math.ceil(u);var w=u+P,x,y=v||this._bMobileScenario;q.each(this._oSectionInfo,function(I,z){var B,E,F,G,H,J=this.getSelectedSection();B=this.oCore.byId(I);if(!B){return;}E=B.getParent();F=E instanceof b&&E._getIsHidden();if(this.getUseIconTabBar()&&J){H=this.oCore.byId(J);if(!H){return;}if(z.isSection&&z.sectionReference!=H){return true;}if(!z.isSection&&H.indexOfSubSection(z.sectionReference)<0){return true;}}if(z.isSection||(y&&!F)){if(!x&&(z.sectionReference._getInternalVisible()===true)){G=this._getFirstVisibleSubSection(z.sectionReference);if(z.isSection&&v&&G){x=G.getId();}else{x=I;}}if(z.isSection&&v){return true;}if(z.positionTop<=w&&u<=z.positionBottom){if(z.positionTop<=u&&z.positionBottom>=u){x=I;return false;}}}}.bind(this));return x;};s.prototype._toggleHeader=function(u,U){var H;if(u===this._bStickyAnchorBar){return;}H=this.getHeaderTitle();if(!this._shouldPreserveHeaderInTitleArea()&&!this._bHeaderInTitleArea){this._toggleHeaderTitle(!u,U);}if(!this._bStickyAnchorBar&&u){this._restoreFocusAfter(this._moveAnchorBarToTitleArea);H&&H.snap();this._bHeaderExpanded=false;this._adjustHeaderHeights();this._updateToggleHeaderVisualIndicators();}else if(this._bStickyAnchorBar&&!u){this._restoreFocusAfter(this._moveAnchorBarToContentArea);H&&H.unSnap();this._bHeaderExpanded=true;this._adjustHeaderHeights();this._updateToggleHeaderVisualIndicators();}};s.prototype._restoreFocusAfter=function(u){var v=this.oCore.byId(this.oCore.getCurrentFocusedControlId());u.call(this);if(D.system.phone!==true){if(!this.oCore.byId(this.oCore.getCurrentFocusedControlId())){v&&v.$().focus();}}return this;};s.prototype._moveAnchorBarToTitleArea=function(){this._$anchorBar.children().appendTo(this._$stickyAnchorBar);this._toggleHeaderStyleRules(true);if(this.iHeaderTitleHeight!=this.iHeaderTitleHeightStickied){this._adjustHeaderBackgroundSize();}return this;};s.prototype._moveAnchorBarToContentArea=function(){if(!this._shouldPreserveHeaderInTitleArea()){var u=this._$opWrapper.scrollTop();this._$anchorBar.css("height","auto").append(this._$stickyAnchorBar.children());this._$opWrapper.scrollTop(u);this._toggleHeaderStyleRules(false);}return this;};s.prototype._toggleHeaderStyleRules=function(u){u=!!u;var v=u?"hidden":"inherit";this._bStickyAnchorBar=u;this._$headerContent.css("overflow",v);this._$headerContent.toggleClass("sapContrastPlus",!u);this._$headerContent.toggleClass("sapUxAPObjectPageHeaderDetailsHidden",u);this._$anchorBar.css("visibility",v);if(t(this._$stickyAnchorBar)){this._$stickyAnchorBar.attr("aria-hidden",!u);}this.fireToggleAnchorBar({fixed:u});if(!u&&!this.iAnchorBarHeight){this._requestAdjustLayout();}};s.prototype.getScrollDelegate=function(){return this._oScroller;};s.prototype.setHeaderTitle=function(H,u){if(H&&typeof H.addEventDelegate==="function"){H.addEventDelegate({onAfterRendering:this._adjustHeaderHeights.bind(this)});}this.setAggregation("headerTitle",H,u);this._oObserver&&this._oObserver.disconnect();this._oObserver=new M(this._onModifyHeaderTitle.bind(this));this._oObserver.observe(H,{aggregations:["headerTitle"],properties:["backgroundDesign"]});if(H){this._createHeaderContent();}return this;};s.prototype._onModifyHeaderTitle=function(u){var H=this.getAggregation("_headerContent");H&&u.current&&H.setBackgroundDesign(u.current);};s.prototype.invalidate=function(u){if(this.getUseIconTabBar()&&u&&(u instanceof b)&&!u.isActive()&&this._oSectionInfo[u.getId()]){return;}if(this._iAfterRenderingDomReadyTimeout){clearTimeout(this._iAfterRenderingDomReadyTimeout);}a.prototype.invalidate.apply(this,arguments);};s.prototype._createHeaderContent=function(){var H=this.getHeaderTitle(),u=H&&H.supportsBackgroundDesign()&&H.getBackgroundDesign(),v=this.getAggregation("_headerContent"),w,N;var x=H?H.getCompatibleHeaderContentClass():d;if(!(v instanceof x)){w=this.getAggregation("_headerContent");if(w){w.destroy();}N=x.createInstance(this.getAggregation("headerContent"),this.getShowHeaderContent(),this._getHeaderDesign(),this.getHeaderContentPinnable(),this.getId()+"-OPHeaderContent");u&&N.setBackgroundDesign(u);this.setAggregation("_headerContent",N,true);}};s.prototype._adjustHeaderBackgroundSize=function(){var H=this.getHeaderTitle();if(H&&H.getHeaderDesign()=="Dark"){if(!this._shouldPreserveHeaderInTitleArea()){this.iTotalHeaderSize=this.iHeaderTitleHeight+this.iHeaderContentHeight;this._$headerContent.css("background-size","100% "+this.iTotalHeaderSize+"px");}else{this.iTotalHeaderSize=this.iHeaderTitleHeight-this._$stickyAnchorBar.height();this._$stickyHeaderContent.css("background-size","100% "+this.iTotalHeaderSize+"px");}H.$().css("background-size","100% "+this.iTotalHeaderSize+"px");this._adjustHeaderTitleBackgroundPosition(0);}};s.prototype._adjustHeaderTitleBackgroundPosition=function(u){var H=this.getHeaderTitle();if(H&&H.getHeaderDesign()=="Dark"){if(this._bStickyAnchorBar){H.$().css("background-position","0px "+((this.iTotalHeaderSize-this.iHeaderTitleHeightStickied)*-1)+"px");}else{if(this._shouldPreserveHeaderInTitleArea()){H.$().css("background-position","0px 0px");}else{H.$().css("background-position","0px "+(this.iHeaderTitleHeight+this.iHeaderContentHeight-this.iTotalHeaderSize-u)+"px");}}}};s.prototype._adjustHeaderHeights=function(){var u=this.getHeaderTitle(),P=true;if(u&&!u.supportsAdaptLayoutForDomElement()){P=false;}if(this._$titleArea.length>0){this.iHeaderContentHeight=this._$headerContent.length?Math.ceil(this._getDOMRefHeight(this._$headerContent[0])):0;this.iStickyHeaderContentHeight=this._$stickyHeaderContent.height();this.iAnchorBarHeight=this._bStickyAnchorBar?this._$stickyAnchorBar.outerHeight():this._$anchorBar.outerHeight();if(!this._bHeaderExpanded){this.iHeaderTitleHeightStickied=this._$titleArea.height()-this.iAnchorBarHeight;this.iHeaderTitleHeight=this._obtainExpandedTitleHeight(P);}else{this.iHeaderTitleHeight=this._$titleArea.is(":visible")?this._$titleArea.height():0;this.iHeaderTitleHeightStickied=this._obtainSnappedTitleHeight(P);}this._adjustHeaderBackgroundSize();h.info("ObjectPageLayout :: adjustHeaderHeight","headerTitleHeight: "+this.iHeaderTitleHeight+" - headerTitleStickiedHeight: "+this.iHeaderTitleHeightStickied+" - headerContentHeight: "+this.iHeaderContentHeight);}else{h.debug("ObjectPageLayout :: adjustHeaderHeight","skipped as the objectPageLayout is being rendered");}};s.prototype._appendTitleCloneToDOM=function(E){var $=this.getHeaderTitle().$(),u=$.clone();u.css({left:"-10000px",top:"-10000px",width:$.width()+"px",position:"absolute"});u.toggleClass("sapUxAPObjectPageHeaderStickied",E);u.appendTo(this._$titleArea.parent());if(E){this.getHeaderTitle()&&this.getHeaderTitle()._adaptLayoutForDomElement(u);}return u;};s.prototype._obtainSnappedTitleHeight=function(v){var u=this.getHeaderTitle(),$,H;if(!u){return 0;}if(v){$=this._appendTitleCloneToDOM(true);H=$.height();$.remove();}else if(u.snap){H=this._obtainTitleHeightViaStateChange(true);}return H;};s.prototype._obtainExpandedTitleHeight=function(v){var u=this.getHeaderTitle(),$,H;if(!u){return 0;}if(v){$=this._appendTitleCloneToDOM(false);H=$.is(":visible")?$.height()-this.iAnchorBarHeight:0;$.remove();}else if(u.unSnap){H=this._obtainTitleHeightViaStateChange(false);}return H;};s.prototype._obtainTitleHeightViaStateChange=function(u){var v=this.getHeaderTitle(),H,w=this._$sectionsContainer.height(),x,y=(u)?v.snap:v.unSnap,z=(u)?v.unSnap:v.snap;y.call(v,false);H=v.$().outerHeight();z.call(v,false);x=this._$sectionsContainer.height();this._adjustSpacerHeightUponUnsnapping(w,x);return H;};s.prototype._adjustSpacerHeightUponUnsnapping=function(u,v){var w;if(u!=v){w=this._$spacer.height()-(v-u);this._$spacer.height(w);}};s.prototype._getHeaderDesign=function(){var H=this.getHeaderTitle(),u=l.ObjectPageHeaderDesign.Light;if(H!=null){u=H.getHeaderDesign();}return u;};s.prototype._getVisibleSections=function(){return this.getSections().filter(function(u){return u.getVisible()&&u._getInternalVisible();});};s.prototype._setSectionsFocusValues=function(u){var v=this._getVisibleSections()||[],$,F='0',N='-1',w="tabindex",x,y=v[0];v.forEach(function(z){$=z.$();if(u===z.sId){$.attr(w,F);x=z;z._setSubSectionsFocusValues();}else{$.attr(w,N);z._disableSubSectionsFocus();}});if(!x&&v.length>0){y.$().attr(w,F);y._setSubSectionsFocusValues();x=y;}return x;};s.prototype.setShowHeaderContent=function(u){var v=this.getShowHeaderContent(),H;if(v!==u){if(v&&this._bHeaderInTitleArea&&!this._shouldPreserveHeaderInTitleArea()){this._moveHeaderToContentArea();this._toggleHeaderTitle(false);}this.setProperty("showHeaderContent",u);H=this._getHeaderContent();if(H){H.setProperty("visible",u);}}return this;};s.prototype._headerTitleChangeHandler=function(I){var u;if(!this.getShowTitleInHeaderContent()){return;}if(I){this._getHeaderContent()._destroyObjectImage(true);}u=this.oCore.createRenderManager();this.getRenderer()._rerenderHeaderContentArea(u,this);this._getHeaderContent().invalidate();u.destroy();};s.prototype.getHeaderContent=function(){if(!this._getHeaderContent()){return this.getAggregation("headerContent",[]);}return this._getHeaderContent().getAggregation("content",[]);};s.prototype.insertHeaderContent=function(u,I,v){if(!this._getHeaderContent()){return this.insertAggregation("headerContent",u,I,v);}return this._getHeaderContent().insertAggregation("content",u,I,v);};s.prototype.addHeaderContent=function(u,v){if(!this._getHeaderContent()){return this.addAggregation("headerContent",u,v);}return this._getHeaderContent().addAggregation("content",u,v);};s.prototype.removeAllHeaderContent=function(u){if(!this._getHeaderContent()){return this.removeAllAggregation("headerContent",u);}return this._getHeaderContent().removeAllAggregation("content",u);};s.prototype.removeHeaderContent=function(u,v){if(!this._getHeaderContent()){return this.removeAggregation("headerContent",u,v);}return this._getHeaderContent().removeAggregation("content",u,v);};s.prototype.destroyHeaderContent=function(u){if(!this._getHeaderContent()){return this.destroyAggregation("headerContent",u);}return this._getHeaderContent().destroyAggregation("content",u);};s.prototype.indexOfHeaderContent=function(u){if(!this._getHeaderContent()){return this.indexOfAggregation("headerContent",u);}return this._getHeaderContent().indexOfAggregation("content",u);};s.prototype._getHeaderContent=function(){return this.getAggregation("_headerContent");};s.prototype._connectModelsForSections=function(u){u=u||[];u.forEach(function(v){v.connectToModels();});};s.prototype._getHeightRelatedParameters=function(){return{iHeaderContentHeight:this.iHeaderContentHeight,iScreenHeight:this.iScreenHeight,iAnchorBarHeight:this.iAnchorBarHeight,iHeaderTitleHeightStickied:this.iHeaderTitleHeightStickied,iStickyHeaderContentHeight:this.iStickyHeaderContentHeight,iScrollTop:this._$opWrapper.scrollTop()};};s.prototype._hasVerticalScrollBar=function(){return(this._getCustomScrollBar().getVisible()===true);};s.prototype._shiftHeaderTitle=function(){var u=this._calculateShiftOffset(),v=u.sStyleAttribute,P=u.iMarginalsOffset;this.$().find(".sapUxAPObjectPageHeaderTitle").css("padding-"+v,P+"px");};s.prototype._isFirstSection=function(u){var v=this._getVisibleSections();if(u===v[0]){return true;}return false;};s.prototype._isValidStoredSubSectionInfo=function(){var u=this.getSelectedSection(),v=this.oCore.byId(u),w;if(!v||!this._oStoredScrolledSubSectionInfo){return false;}w=this.oCore.byId(this._oStoredScrolledSubSectionInfo.sSubSectionId);return w&&this._sectionCanBeRenderedByUXRules(w)&&(v.indexOfSubSection(w)>=0);};s.prototype._restoreScrollPosition=function(){var v=this._isValidStoredSubSectionInfo(),u;if(v){u=this._computeScrollPosition(this.oCore.byId(this._oStoredScrolledSubSectionInfo.sSubSectionId))+this._oStoredScrolledSubSectionInfo.iOffset;this._scrollTo(u,0);}else{this.scrollToSection(this.getSelectedSection(),0);}};s.prototype._storeScrollLocation=function(){if(!this.getDomRef()||!this._bDomReady||!this._oScroller){return;}var u=this._oScroller.getScrollTop(),v=this._getClosestScrolledSectionId(this._oScroller.getScrollTop(),this.iScreenHeight,true),w;if(v){w=u-this._computeScrollPosition(this.oCore.byId(v));}this._iStoredScrollTop=u;this._oStoredScrolledSubSectionInfo={sSubSectionId:v,iOffset:w};this._oCurrentTabSection=null;};s.prototype.onkeyup=function(E){var F,u;if(E.which===K.TAB){F=this.oCore.getCurrentFocusedControlId();u=F&&this.oCore.byId(F);if(u&&this._isFirstSection(u)){this._scrollTo(0,0);}}};s.prototype.setShowFooter=function(u){var v=this.setProperty("showFooter",u,true);this._toggleFooter(u);return v;};s.prototype._toggleFooter=function(u){var U,F=this.getFooter();if(!t(F)||!t(this._$footerWrapper)){return;}U=this.oCore.getConfiguration().getAnimationMode()!==C.AnimationMode.none;if(U){this._toggleFooterAnimation(u,F);}else{this._$footerWrapper.toggleClass("sapUiHidden",!u);}this._requestAdjustLayout();};s.prototype._toggleFooterAnimation=function(u,F){this._$footerWrapper.bind("webkitAnimationEnd animationend",this._onToggleFooterAnimationEnd.bind(this,F));this._bIsFooterAanimationGoing=true;if(u){this._$footerWrapper.removeClass("sapUiHidden");}F.toggleStyleClass(s.SHOW_FOOTER_CLASS_NAME,u);F.toggleStyleClass(s.HIDE_FOOTER_CLASS_NAME,!u);};s.prototype._onToggleFooterAnimationEnd=function(F){this._$footerWrapper.unbind("webkitAnimationEnd animationend");if(F.hasStyleClass(s.HIDE_FOOTER_CLASS_NAME)){this._$footerWrapper.addClass("sapUiHidden");F.removeStyleClass(s.HIDE_FOOTER_CLASS_NAME);}else{F.removeStyleClass(s.SHOW_FOOTER_CLASS_NAME);}this._bIsFooterAanimationGoing=false;};s.prototype.clone=function(){var u,H,v;Object.keys(this.mAggregations).forEach(this._cloneProxiedAggregations,this);u=a.prototype.clone.apply(this,arguments);H=this._getHeaderContent();v=u._getHeaderContent();if(v){v.destroy();}if(H){u.setAggregation("_headerContent",H.clone(),true);}return u;};s.prototype._cloneProxiedAggregations=function(u){var v=this.mAggregations[u];if(Array.isArray(v)&&v.length===0){v=this["get"+u.charAt(0).toUpperCase()+u.slice(1)]();}this.mAggregations[u]=v;};s.prototype._shouldPreserveHeaderInTitleArea=function(){return this._bPinned||this._preserveHeaderStateOnScroll()||this._checkAlwaysShowContentHeader();};s.prototype._checkAlwaysShowContentHeader=function(){return!this._hasDynamicTitle()&&!this._bMobileScenario&&!this._bTabletScenario&&this.getShowHeaderContent()&&this.getAlwaysShowContentHeader();};s.prototype._shouldOverridePreserveHeaderStateOnScroll=function(){return!D.system.desktop&&this._headerBiggerThanAllowedToBeFixed();};s.prototype._headerBiggerThanAllowedToBeFixed=function(){var u=this._getOwnHeight();return this._getEntireHeaderHeight()>s.HEADER_MAX_ALLOWED_NON_SROLLABLE_PERCENTAGE*u;};s.prototype._headerBiggerThanAllowedToBeExpandedInTitleArea=function(){return this._getEntireHeaderHeight()>=this._getOwnHeight();};s.prototype._getOwnHeight=function(){return this._getHeight(this);};s.prototype._getHeight=function(u){return!(u instanceof a)?0:u.$().outerHeight()||0;};s.prototype._getEntireHeaderHeight=function(){var u=0,H=0,v=this.getHeaderTitle(),w=this._getHeaderContent();if(t(v)){u=v.$().outerHeight();}if(t(w)){H=w.$().outerHeight();}return u+H;};s.prototype._onPinUnpinButtonPress=function(){if(this._bPinned){this._unPin();}else{this._pin();this._restorePinButtonFocus();}};s.prototype._restorePinButtonFocus=function(){var H=this._getHeaderContent();if(t(H)&&H.supportsPinUnpin()){H._focusPinButton();}};s.prototype._pin=function(){var $=this.$();if(this._bPinned){return;}this._bPinned=true;this._toggleHeaderTitle(true);this._moveAnchorBarToTitleArea();this._moveHeaderToTitleArea();this._adjustHeaderHeights();this._requestAdjustLayout();this._togglePinButtonARIAState(this._bPinned);this._updateToggleHeaderVisualIndicators();if(t($)){$.addClass("sapUxAPObjectPageLayoutHeaderPinned");}};s.prototype._unPin=function(){var $=this.$();if(!this._bPinned){return;}this._bPinned=false;this._updateToggleHeaderVisualIndicators();this._togglePinButtonARIAState(this._bPinned);if(t($)){$.removeClass("sapUxAPObjectPageLayoutHeaderPinned");}};s.prototype._togglePinButtonARIAState=function(P){var H=this._getHeaderContent();if(t(H)&&H.supportsPinUnpin()){H._updateARIAPinButtonState(P);}};s.prototype._preserveHeaderStateOnScroll=function(){return this._hasDynamicTitle()&&this.getPreserveHeaderStateOnScroll()&&!this._bHeaderBiggerThanAllowedHeight;};s.prototype._overridePreserveHeaderStateOnScroll=function(){if(!this._shouldOverridePreserveHeaderStateOnScroll()){this._bHeaderBiggerThanAllowedHeight=false;return;}this._bHeaderBiggerThanAllowedHeight=true;if(this._bHeaderExpanded){this._moveAnchorBarToContentArea();this._moveHeaderToContentArea(true);}else{this._snapHeader(true);}this._adjustHeaderHeights();this._requestAdjustLayout();};s.prototype._hasDynamicTitle=function(){var u=this.getHeaderTitle();return u&&u.isDynamic();};s.prototype._attachVisualIndicatorsPressHandlers=function(P,u){var v=this.getHeaderTitle(),H=this._getHeaderContent();if(t(v)&&!this._bAlreadyAttachedTitleIndicatorPressHandler){v.attachEvent(s.EVENTS.TITLE_VISUAL_INDICATOR_PRESS,function(){P.call(u);if(this._headerBiggerThanAllowedToBeExpandedInTitleArea()){this._scrollBelowCollapseVisualIndicator();}this._focusCollapseVisualIndicator();},this);this._bAlreadyAttachedTitleIndicatorPressHandler=true;}if(t(H)&&!this._bAlreadyAttachedHeaderIndicatorPressHandler){H.attachEvent(s.EVENTS.HEADER_VISUAL_INDICATOR_PRESS,function(){P.call(u);this._focusExpandVisualIndicator();},this);this._bAlreadyAttachedHeaderIndicatorPressHandler=true;}};s.prototype._hasVisibleDynamicTitleAndHeader=function(){var u=this.getHeaderTitle(),H=this.getHeaderContent();return t(u)&&u.isDynamic()&&u.getVisible()&&t(H)&&H.length>0;};s.prototype._hasDynamicTitleWithSnappedTitleOnMobile=function(){var u=this.getHeaderTitle();return t(u)&&u.isDynamic()&&!!u.getSnappedTitleOnMobile()&&D.system.phone;};s.prototype._updateToggleHeaderVisualIndicators=function(){var H,u,E,v=this._hasVisibleDynamicTitleAndHeader();if(!this.getToggleHeaderOnTitleClick()||!v){u=false;E=false;}else{H=this._bHeaderExpanded;u=H;E=!H&&!this._hasDynamicTitleWithSnappedTitleOnMobile();}this._toggleCollapseVisualIndicator(u);this._toggleExpandVisualIndicator(E);};s.prototype._updateTitleVisualState=function(){var u=this.getHeaderTitle(),v=this._hasVisibleDynamicTitleAndHeader()&&this.getToggleHeaderOnTitleClick()&&!this._hasDynamicTitleWithSnappedTitleOnMobile();this.$().toggleClass("sapUxAPObjectPageLayoutTitleClickEnabled",v);if(t(u)){u._toggleFocusableState(v);}};s.prototype._focusCollapseVisualIndicator=function(){var u=this._getHeaderContent();if(t(u)){u._focusCollapseButton();}};s.prototype._focusExpandVisualIndicator=function(){var u=this.getHeaderTitle();if(t(u)){u._focusExpandButton();}};s.prototype._toggleExpandVisualIndicator=function(u){var v=this.getHeaderTitle();if(t(v)){v._toggleExpandButton(u);}};s.prototype._toggleCollapseVisualIndicator=function(u){var v=this._getHeaderContent();if(t(v)){v._toggleCollapseButton(u);}};s.prototype._attachVisualIndicatorMouseOverHandlers=function(u,v,w){var H=this._getHeaderContent();if(t(H)&&!this._bAlreadyAttachedVisualIndicatorMouseOverOutHandler){H.attachEvent(s.EVENTS.VISUAL_INDICATOR_MOUSE_OVER,u,w);H.attachEvent(s.EVENTS.VISUAL_INDICATOR_MOUSE_OUT,v,w);this._bAlreadyAttachedVisualIndicatorMouseOverOutHandler=true;}};s.prototype._attachTitleMouseOverHandlers=function(u,v,w){var x=this.getHeaderTitle();if(t(x)&&!this._bAlreadyAttachedTitleMouseOverOutHandler){x.attachEvent(s.EVENTS.TITLE_MOUSE_OVER,u,w);x.attachEvent(s.EVENTS.TITLE_MOUSE_OUT,v,w);this._bAlreadyAttachedTitleMouseOverOutHandler=true;}};s.prototype._suppressScroll=function(){this._bSuppressScroll=true;};s.prototype._resumeScroll=function(){this._bSuppressScroll=false;if(this._iStoredScrollTop){this._scrollTo(this._iStoredScrollTop,0);}else{this._onScroll({target:{scrollTop:this._$opWrapper.scrollTop()}});}};s.prototype._addHoverClass=function(){var $=this.$();if($){$.addClass("sapUxAPObjectPageLayoutTitleForceHovered");}};s.prototype._removeHoverClass=function(){var $=this.$();if($){$.removeClass("sapUxAPObjectPageLayoutTitleForceHovered");}};s.prototype._getHeight=function(u){return!(u instanceof a)?0:u.$().outerHeight()||0;};s.prototype._getWidth=function(u){var v=u.getDomRef();return!(u instanceof a)?0:(v&&v.offsetWidth)||0;};s.prototype._getSectionInfoIsDirty=function(){return this.bSectionInfoIsDirty;};s.prototype._setSectionInfoIsDirty=function(u){this.bSectionInfoIsDirty=u;};s.prototype._getAriaLabelText=function(E){var H=this.getHeaderTitle(),u=H?H.getTitleText():null,v;if(H&&u){v=u+" "+s._getLibraryResourceBundle().getText(E+"_ARIA_LABEL_WITH_TITLE");}else{v=s._getLibraryResourceBundle().getText(E+"_ARIA_LABEL_WITHOUT_TITLE");}return v;};s.prototype._getFooterHeight=function(){if(this.getFooter()&&this.getShowFooter()){return this._getDOMRefHeight(this.$("footerWrapper").get(0));}return 0;};s.prototype._getDOMRefHeight=function(u){return u.parentElement?u.getBoundingClientRect().height:0;};s.prototype._updateAriaLabels=function(){var u=this.getLandmarkInfo(),v=this._getAriaLabelText("ROOT"),H=this._getAriaLabelText("HEADER"),N=this._getAriaLabelText("NAVIGATION"),w=this._getAriaLabelText("NAVTOOLBAR"),x=u&&u.getHeaderLabel(),y=u&&u.getRootLabel(),z=u&&u.getNavigationLabel();if(!y){this.$().attr("aria-label",v);}if(!x){this.$("headerTitle").attr("aria-label",H);}if(!z){this.$("anchorBar").attr("aria-label",N);this.$("stickyAnchorBar").attr("aria-label",N);}this.$("anchBar").attr("aria-label",w);};s.prototype._formatLandmarkInfo=function(u,P){if(u){var v=u["get"+P+"Role"]()||"",w=u["get"+P+"Label"]()||"";if(v===p.None){v='';}return{role:v.toLowerCase(),label:w};}return{};};s.prototype._getHeaderTag=function(u){if(u&&u.getHeaderRole()!==p.None){return s.DIV;}return s.HEADER;};s.prototype._getFooterTag=function(u){if(u&&u.getFooterRole()!==p.None){return s.DIV;}return s.FOOTER;};function t(v){if(arguments.length===1){return Array.isArray(v)?v.length>0:!!v;}return Array.prototype.slice.call(arguments).every(function(u){return t(u);});}return s;});
