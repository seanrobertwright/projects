/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/f/library","sap/f/cards/BaseContent","sap/f/cards/IconFormatter","sap/f/cards/BindingHelper","sap/f/cards/BindingResolver","sap/f/PlanningCalendarInCard","sap/f/PlanningCalendarInCardRow","sap/f/PlanningCalendarInCardLegend","sap/m/library","sap/m/PlanningCalendar","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/unified/CalendarAppointment","sap/ui/unified/DateTypeRange","sap/ui/unified/CalendarLegendItem"],function(l,B,I,a,b,P,c,d,L,e,F,f,C,D,g){"use strict";var A=l.cards.AreaType,h=L.PlanningCalendarBuiltInView;var i=B.extend("sap.f.cards.CalendarContent",{renderer:{}});i.prototype._createCalendar=function(){this._oCalendar=new P(this.getId()+"-PC",{showWeekNumbers:true,builtInViews:[h.OneMonth],rows:[new c(this.getId()+"-Row",{})],intervalSelect:function(E){this._setParameters(E,E.getParameter("startDate"));}.bind(this)});this.setAggregation("_content",this._oCalendar);this._oCalendar.attachEvent("_todayPressed",new Date(),this._setParameters);};i.prototype.init=function(){B.prototype.init.apply(this,arguments);this._createCalendar();this.fireEvent("_actionContentReady");};i.prototype.exit=function(){B.prototype.exit.apply(this,arguments);if(this._oAppointmentTemplate){this._oAppointmentTemplate.destroy();this._oAppointmentTemplate=null;}if(this._oHeaderTemplate){this._oHeaderTemplate.destroy();this._oHeaderTemplate=null;}if(this._oSpecialDateTemplate){this._oSpecialDateTemplate.destroy();this._oSpecialDateTemplate=null;}if(this._oCalendarLegendItemTemplate){this._oCalendarLegendItemTemplate.destroy();this._oCalendarLegendItemTemplate=null;}if(this._oAppointmentLegendItemTemplate){this._oAppointmentLegendItemTemplate.destroy();this._oAppointmentLegendItemTemplate=null;}if(this._oActions){this._oActions.destroy();this._oActions=null;}};i.prototype.onAfterRendering=function(){var o;if(!this._bIsDataReady){o=this.getParent();if(o.isReady()){this._setParameters();}else{o.attachEventOnce("_ready",this._setParametersInModel,this);}}};i.prototype.setConfiguration=function(o){B.prototype.setConfiguration.apply(this,arguments);if(!o){return this;}if(o.item){this._addItem(o.item);}if(o.specialDate){this._addSpecialDate(o.specialDate);}if(o.legendItem){this._addLegendItem(o.legendItem);}if(o.date){this._addDate(o.date);}if(o.maxItems){this._addMaxItems(o.maxItems);}if(o.maxLegendItems){this._addMaxLegendItems(o.maxLegendItems);}if(o.noItemsText){this._addNoItemsText(o.noItemsText);}if(o.moreItems&&o.moreItems.actions){this._oActions.setAreaType(A.Content);this._oActions.attach(o.moreItems,this._oCalendar.getRows()[0]._getMoreButton());}return this;};i.prototype._setParameters=function(E,o){var j=o?o:this._oCalendar.getStartDate(),s=new Date(j.getFullYear(),j.getMonth(),j.getDate()),k=new Date(j.getFullYear(),j.getMonth(),j.getDate()),m=this.getConfiguration&&this.getConfiguration(),n=m&&m.item&&m.item.path,M,p,q,v,t;k.setDate(k.getDate()+1);q=n?this.getModel().getProperty(n).filter(function(r){var S=new Date(r.start).getTime(),u=new Date(r.end).getTime();if((S>=s.getTime()&&S<k.getTime())||(u>=s.getTime()&&u<k.getTime())||(S<=s.getTime()&&u>k.getTime())){return r;}}):[];if(m&&typeof m.maxItems==="object"){M=m&&this.getConfiguration().maxItems&&"/"+this.getConfiguration().maxItems.binding.getPath();p=this.getModel().getProperty(M);}else{p=m&&this.getConfiguration().maxItems;}t=q.length;if(t<p){v=t;}else{v=p;}this._bIsDataReady=true;this.getModel("parameters").setProperty("/visibleItems",v);this.getModel("parameters").setProperty("/allItems",t);};i.prototype.dateFormatter=function(t){return new Date(t);};i.prototype._addItem=function(m){var j={title:m.template.title,text:m.template.text,type:m.template.type},o,k={title:m.template.title,text:m.template.text,type:m.template.type},n;if(m.template.startDate){j.startDate=a.formattedProperty(m.template.startDate,this.dateFormatter);}if(m.template.endDate){j.endDate=a.formattedProperty(m.template.endDate,this.dateFormatter);}if(m.template.icon&&m.template.icon.src){j.icon=a.formattedProperty(m.template.icon.src,function(v){return I.formatSrc(v,this._sAppId);}.bind(this));}this._oAppointmentTemplate=new C(j);o={path:m.path,template:this._oAppointmentTemplate,filters:new F({path:"visualization",operator:f.Contains,value1:"appointment"})};this._bindAggregation("appointments",this._oCalendar.getRows()[0],o);if(m.template.startDate){k.startDate=a.formattedProperty(m.template.startDate,this.dateFormatter);}if(m.template.endDate){k.endDate=a.formattedProperty(m.template.endDate,this.dateFormatter);}if(m.template.icon&&m.template.icon.src){k.icon=a.formattedProperty(m.template.icon.src,function(v){return I.formatSrc(v,this._sAppId);}.bind(this));}this._oHeaderTemplate=new C(k);n={path:m.path,template:this._oHeaderTemplate,filters:new F({path:"visualization",operator:f.Contains,value1:"blocker"})};this._bindAggregation("intervalHeaders",this._oCalendar.getRows()[0],n);};i.prototype._addSpecialDate=function(s){var S=s.template,o;if(S.startDate){S.startDate=a.formattedProperty(S.startDate,this.dateFormatter);}if(S.endDate){S.endDate=a.formattedProperty(S.endDate,this.dateFormatter);}this._oSpecialDateTemplate=new D(S);o={path:s.path,template:this._oSpecialDateTemplate};this._bindAggregation("specialDates",this._oCalendar,o);};i.prototype._addLegendItem=function(m){var j={text:m.template.text,type:m.template.type},k={text:m.template.text,type:m.template.type},o,n;this._oCalendarLegendItemTemplate=new g(j);o={path:m.path,template:this._oCalendarLegendItemTemplate,filters:new F({path:"category",operator:f.Contains,value1:"calendar"})};this._bindAggregation("items",this._oCalendar._getLegend(),o);this._oAppointmentLegendItemTemplate=new g(k);n={path:m.path,template:this._oAppointmentLegendItemTemplate,filters:new F({path:"category",operator:f.Contains,value1:"appointment"})};this._bindAggregation("appointmentItems",this._oCalendar._getLegend(),n);};i.prototype._addDate=function(t){if(b.isBindingInfo(t)){t&&this._oCalendar.bindProperty("startDate",a.formattedProperty(t,this.dateFormatter));}else{this._oCalendar.setStartDate(this.dateFormatter(t));}};i.prototype._addMaxItems=function(m){if(b.isBindingInfo(m)){m&&this._oCalendar.getRows()[0].bindProperty("visibleAppointmentsCount",m);}else{this._oCalendar.getRows()[0].setVisibleAppointmentsCount(m);}};i.prototype._addMaxLegendItems=function(m){if(b.isBindingInfo(m)){m&&this._oCalendar._getLegend().bindProperty("visibleLegendItemsCount",m);}else{this._oCalendar._getLegend().setVisibleLegendItemsCount(m);}};i.prototype._addNoItemsText=function(n){if(b.isBindingInfo(n)){n&&this._oCalendar.getRows()[0].bindProperty("noAppointmentsText",n);}else{this._oCalendar.getRows()[0].setNoAppointmentsText(n);}};return i;});
