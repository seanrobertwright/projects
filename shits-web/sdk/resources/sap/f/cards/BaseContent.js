/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Control","sap/ui/model/json/JSONModel","sap/ui/base/ManagedObjectObserver","sap/f/cards/loading/LoadingProvider"],function(C,J,M,L){"use strict";var B=C.extend("sap.f.cards.BaseContent",{metadata:{library:"sap.f",aggregations:{_content:{multiple:false,visibility:"hidden"}},events:{press:{}}},renderer:function(r,c){var s="sapFCard";var l=c.getMetadata().getLibraryName();var n=c.getMetadata().getName();var t=n.slice(l.length+1,n.length);var o=c.getParent();s+=t;r.write("<div");r.writeElementData(c);r.addClass(s);r.addClass("sapFCardBaseContent");r.writeClasses();if(o&&o.isA("sap.f.ICard")&&o.getHeight()==="auto"){var h=B.getMinHeight(t,c.getConfiguration(),c);r.addStyle("min-height",h);}r.writeStyles();r.write(">");if(t!=='AdaptiveContent'&&c.isLoading()){r.renderControl(c._oLoadingPlaceholder);}r.renderControl(c.getAggregation("_content"));r.write("</div>");}});B.prototype.init=function(){this._iWaitingEventsCount=0;this._bReady=false;this._mObservers={};this._awaitEvent("_dataReady");this._awaitEvent("_actionContentReady");this._oLoadingProvider=new L();};B.prototype.ontap=function(e){if(!e.isMarked()){this.firePress({});}};B.prototype.exit=function(){this._oServiceManager=null;this._oDataProviderFactory=null;this.destroyPlaceholder();if(this._oDataProvider){this._oDataProvider.destroy();this._oDataProvider=null;}if(this._oActions){this._oActions.destroy();this._oActions=null;}if(this._oLoadingProvider){this._oLoadingProvider.destroy();this._oLoadingProvider=null;}};B.prototype.getActions=function(){return this._oActions;};B.prototype.setActions=function(a){this._oActions=a;};B.prototype._awaitEvent=function(e){this._iWaitingEventsCount++;this.attachEventOnce(e,function(){this._iWaitingEventsCount--;if(this._iWaitingEventsCount===0){this._bReady=true;this.fireEvent("_ready");}});};B.prototype.destroy=function(){this.setAggregation("_content",null);this.setModel(null);this._iWaitingEventsCount=0;if(this._mObservers){Object.keys(this._mObservers).forEach(function(k){this._mObservers[k].disconnect();delete this._mObservers[k];},this);}return C.prototype.destroy.apply(this,arguments);};B.prototype.setConfiguration=function(c,t){this._oConfiguration=c;if(!c){return this;}this._oLoadingPlaceholder=this._oLoadingProvider.createContentPlaceholder(c,t);this._setData(c.data);return this;};B.prototype.getConfiguration=function(){return this._oConfiguration;};B.prototype._setData=function(d){var p="/";if(d&&d.path){p=d.path;}this.bindObject(p);if(this._oDataProvider){this._oDataProvider.destroy();}if(this._oDataProviderFactory){this._oDataProvider=this._oDataProviderFactory.create(d,this._oServiceManager);}this._oLoadingProvider.createLoadingState(this._oDataProvider);if(this._oDataProvider){this.setModel(new J());this._oDataProvider.attachDataChanged(function(e){this._updateModel(e.getParameter("data"));this.onDataChanged();}.bind(this));this._oDataProvider.attachError(function(e){this._handleError(e.getParameter("message"));}.bind(this));this._oDataProvider.triggerDataUpdate().then(function(){this.fireEvent("_dataReady");this.destroyPlaceholder();}.bind(this));}else{this.fireEvent("_dataReady");}};B.prototype.destroyPlaceholder=function(){if(this._oLoadingPlaceholder){this._oLoadingPlaceholder.destroy();this._oLoadingPlaceholder=null;}};B.prototype.onDataChanged=function(){};function _(a,c,b){var o=this.getBindingContext(),A=c.getAggregation(a);if(o){b.path=b.path||o.getPath();c.bindAggregation(a,b);if(this.getModel("parameters")&&A){this.getModel("parameters").setProperty("/visibleItems",A.length);}if(!this._mObservers[a]){this._mObservers[a]=new M(function(d){if(d.name===a&&(d.mutation==="insert"||d.mutation==="remove")){var A=c.getAggregation(a);var l=A?A.length:0;if(this.getModel("parameters")){this.getModel("parameters").setProperty("/visibleItems",l);}}}.bind(this));this._mObservers[a].observe(c,{aggregations:[a]});}}}B.prototype._bindAggregation=function(a,c,b){var A=a&&typeof a==="string";var d=b&&typeof b==="object";if(!A||!c||!d){return;}if(this.getBindingContext()){_.apply(this,arguments);}else{c.attachModelContextChange(_.bind(this,a,c,b));}};B.prototype.isReady=function(){return this._bReady;};B.prototype._updateModel=function(d){this.getModel().setData(d);};B.prototype._handleError=function(l){this.fireEvent("_error",{logMessage:l});};B.prototype.setServiceManager=function(s){this._oServiceManager=s;return this;};B.prototype.setDataProviderFactory=function(d){this._oDataProviderFactory=d;return this;};B.getMinHeight=function(t,c,o){var a=5,h,r=o,p=o.getParent();if(!o.getDomRef()&&p&&p.isA("sap.f.ICard")){r=p;}var i=r.$().closest(".sapUiSizeCompact").hasClass("sapUiSizeCompact");if(jQuery.isEmptyObject(c)){return"0rem";}switch(t){case"ListContent":h=B._getMinListHeight(c,i);break;case"TableContent":h=B._getMinTableHeight(c,i);break;case"TimelineContent":h=B._getMinTimelineHeight(c,i);break;case"AnalyticalContent":h=14;break;case"AnalyticsCloudContent":h=14;break;case"ObjectContent":h=0;break;default:h=0;}return(h!==0?h:a)+"rem";};B._getMinListHeight=function(c,i){var a=parseInt(c.maxItems)||0,t=c.item,I=i?2:2.75;if(!t){return 0;}if(t.description){I=5;}return a*I;};B._getMinTableHeight=function(c,i){var a=parseInt(c.maxItems)||0,r=i?2:2.75,t=i?2:2.75;return a*r+t;};B._getMinTimelineHeight=function(c,i){var a=parseInt(c.maxItems)||0,I=i?4:5;return a*I;};B.prototype.isLoading=function(){var l,c=this.getParent();l=this._oLoadingProvider;return!l.getDataProviderJSON()&&(l.getLoadingState()||c.isLoading());};return B;});
